<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta name="msvalidate.01" content="DBC34551F2DD1BA3DC0D62EE46D7448F" />
    <meta name="google-site-verification" content="DrtKc88u9uc7iptd4LyURAKBmFcOn7Kuk6HcRk_kNmo" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    
    <script data-cfasync="false">
        (function() {
            var savedTheme = localStorage.getItem('theme');
            var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            var theme = savedTheme || (prefersDark ? 'dark' : 'light');
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Retrofit security proxy to prevent XSS and code injection.">
    
    <meta name="keyword"  content="Go, Kubernetes, Elasticsearch, Python, Docker, Big Data, Artificial Intelligence, Machine Learning">
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Reverse Proxy in Golang - IMTI - Craig Johnston</title>

    <link rel="canonical" href="https://imti.co/golang-reverse-proxy/">

    
    <link rel="stylesheet" href="../css/bootstrap.min.css">

    
    <link rel="stylesheet" href="../css/hux-blog.min.css">

    
    <link rel="stylesheet" href="../css/syntax.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <link rel="stylesheet" href="../css/imti.css">

    
    <script src="../js/jquery.min.js"></script>

    
    <script src="../js/bootstrap.min.js"></script>

    
    <script src="../js/hux-blog.min.js"></script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-5984764595236029",
            enable_page_level_ads: true
        });
    </script>

    <meta name="twitter:site" content="@cjimti">
<meta name="twitter:creator" content="@cjimti">

<meta name="twitter:description" content="Retrofit security proxy to prevent XSS and code injection." />
<meta name="twitter:title" content="Reverse Proxy in Golang" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://imti.co/img/post/dentalinst_876_438.jpg" />
<meta property="og:image" content="https://imti.co/img/post/dentalinst_876_438.jpg" />



    

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/imti.co\/golang-reverse-proxy\/"
  },
  "headline": "Reverse Proxy in Golang",
  "image": ["https:\/\/imti.co\/img\/post\/dentalinst_876_438.jpg"],
  "datePublished": "2018-06-15T00:00:00Z",
  "dateModified": "2018-06-15T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Craig Johnston",
    "url": "https://imti.co/about/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "imti.co",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/imti.co\/img\/avatar-cj.jpg"
    }
  },
  "description": "Reverse proxies are standard components in many web architectures, from Nginx in front of php-fpm serving Drupal or Wordpress, to endless mixtures of load …"
}
</script>


</head>
</head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../">IMTI</a>
        </div>

        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="../">Home</a>
                    </li>
                    <li>
                        <a href="../about/">About</a>
                    </li>
                    <li>
                        <a href="https://twitter.com/cjimti">Follow</a>
                    </li>
                    

                    
                    <li>
                        <a href="javascript:void(0)" class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark/light mode">
                            <i class="fa fa-moon-o" id="theme-icon"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
            $navbar.className = " ";
            setTimeout(function(){
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header{
        background-image: url('https://imti.co/img/post/dentalinst.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="../tags/devops" title="DevOps">
                        DevOps
                        </a>
                        
                        <a class="tag" href="../tags/security" title="Security">
                        Security
                        </a>
                        
                        <a class="tag" href="../tags/golang" title="Golang">
                        Golang
                        </a>
                        
                    </div>
                    <h1>Reverse Proxy in Golang</h1>
                    <h2 class="subheading">Retrofit security proxy to prevent XSS and code injection.</h2>
                    <span  class="meta">Posted by <a href="https://twitter.com/cjimti">Craig Johnston</a> on Friday, June 15, 2018
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>Reverse proxies are standard components in many web architectures, from <a href="https://www.nginx.com/">Nginx</a> in front of <a href="https://php-fpm.org/">php-fpm</a> serving <a href="http://www.drupal.com/">Drupal</a> or <a href="https://wordpress.org/">Wordpress</a>, to endless mixtures of load balancers, security appliances, and popular firewall applications. <a href="https://www.jscape.com/blog/bid/87783/Forward-Proxy-vs-Reverse-Proxy">Reverse proxies differ from forward proxies</a> in little but their intended implementation, be it service-side or client side. The following information is useful in either context. However, I focus on a service-side architecture. Further down this article, I&rsquo;ll be going over the reasonably simple <a href="https://golang.org/">go</a> code needed to develop a basic, yet production quality proxy, but first I&rsquo;ll give you my take on why they solve so many problems and offer up my little workhorse, <a href="https://github.com/txn2/n2proxy">n2proxy</a>.</p>


<h2 id="reverse-proxies">Reverse Proxies</h2>
<p>So why do we write custom Reverse Proxies? We don&rsquo;t need to write another <a href="https://www.nginx.com/">Nginx</a> or <a href="http://www.haproxy.org/">HAProxy</a> unless we are directly in the business to do so. Reverse Proxies have the capability of providing a variety solutions beyond their common usage. Custom reverse proxies are great solutions for:</p>
<ul>
<li>Middleware logging into message queues</li>
<li>Event triggering</li>
<li>API adaptors and translators</li>
<li>Message Buffering</li>
</ul>
<p>Proxies give you complete control over the communication between a client and a service, without needing to modify either, whether it be impractical or impossible. It&rsquo;s like tapping a phone line where you don&rsquo;t just get to listen but modify the conversation itself.</p>
<h2 id="n2proxy">n2proxy</h2>
<p><img src="https://raw.githubusercontent.com/txn2/n2proxy/master/mast.jpg" alt="n2proxy"></p>
<p>I put <a href="https://github.com/txn2/n2proxy">n2proxy</a> together from a few different projects that had very different needs but the same underpinning solution. A common problem, are older or proprietary systems that lack reasonable security standards, these older sites and web apps suffer routinely from <a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)">XSS</a>, <a href="https://www.owasp.org/index.php/SQL_Injection">SQL injection</a> and many vulnerabilities to malicious data, some legacy systems very architecture prevents a fix at the source.</p>
<p><a href="https://github.com/txn2/n2proxy">n2proxy</a> is open source, so you can fork it, contribute to it or write your own just like it, or better. If you want to write your own, I&rsquo;ll be going over the source further down.</p>
<p><a href="https://github.com/txn2/n2proxy">n2proxy</a> was built to:</p>
<ul>
<li>Inspect requested URLs and ban them if they match a set of patterns</li>
<li>Inspect HTTP Post data and nullify it for any data matching a set of patterns.</li>
<li>Inspect HTTP Post and make modifications based on matched patterns.</li>
</ul>
<p><a href="https://github.com/txn2/n2proxy">n2proxy</a> is compiled and tested for Linux, MaxOs and Arm based systems (Raspberry Pi, Tinkerboard, and so on) as well as stand-alone <a href="https://www.docker.com/">Docker</a> implementations or <a href="../tag/kubernetes/">Kubernetes</a>.</p>
<p>If you are using a Mac I recommend installing <a href="https://github.com/txn2/n2proxy">n2proxy</a> with <a href="https://brew.sh/">brew</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew install txn2/tap/n2proxy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># upgrade later with</span>
</span></span><span style="display:flex;"><span>brew upgrade n2proxy
</span></span></code></pre></div><p>You need a configuration file to get started:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://raw.githubusercontent.com/txn2/n2proxy/master/cfg.yml
</span></span></code></pre></div><p>I&rsquo;ll be focusing on three main sections of the configuration. <strong>postBan</strong> for nullifying all post data when the system discovers a match, <strong>urlBan</strong> rewrites the path to &ldquo;/&rdquo; (slash) when the system discovers a match, and <strong>postFilter</strong> uses the powerful and fast <a href="https://blog.gopheracademy.com/advent-2017/using-go-templates/">go templates</a> for modifying post data in-line when the system discovers a match. <strong>postFilter</strong> uses <a href="http://masterminds.github.io/sprig/">sprig</a> with <a href="https://blog.gopheracademy.com/advent-2017/using-go-templates/">go templates</a> to provide over 70 template functions in additional to built-in functions. <strong>postFilter</strong> allows you to make nearly any type of mutation to HTTP post body data, all in the confines of a configuration file.</p>
<p><strong>Sample Configuration</strong></p>
<script src="https://gist.github.com/cjimti/e664ad48b7f356f9d5b6e66117d6b9ab.js"></script>
<p>Unfortunately <strong>postBan</strong> and <strong>urlBan</strong> might look like alien code, or someone punched their keyboard, however <a href="https://en.wikipedia.org/wiki/Regular_expression">regular expressions</a> are an implementation of highly efficient search patterns common to most programming languages. The example set is taken primarily from K. K. Mookhey, and Nilesh Burghate&rsquo;s 2004 article, <a href="https://www.symantec.com/connect/articles/detection-sql-injection-and-cross-site-scripting-attacks">Detection of SQL Injection and Cross-site Scripting Attacks</a>. This list is far from inclusive but get the point across.</p>
<p>Harmful post data and URLs can damage many legacy systems (and even Wordpress and Drupal sites that lack their monthly updates). Since <a href="https://github.com/txn2/n2proxy">n2proxy</a> is a proxy, it exists outside the application layer, there is not much it can do elegantly for the end-user on that layer, but then again an elegant response is not entirely necessary when dealing with an attacker.</p>
<p><strong>postFilter</strong> is the fun section, and if you are interested building API adaptors and translators, or rewiring the messages of that closed source <a href="https://en.wikipedia.org/wiki/Internet_of_things">IOT</a> device so it can post data conforming to the interface of some distant web server, this is the section. Although the examples show how to shuffle the letters in the word &ldquo;taco&rdquo; and uppercase any instance of &ldquo;good times&rdquo;, with <a href="https://blog.gopheracademy.com/advent-2017/using-go-templates/">go templates</a> and <a href="http://masterminds.github.io/sprig/">sprig</a> you have a clear jumping off point for considerable number of possibilities.</p>
<h2 id="running-n2proxy">Running <a href="https://github.com/txn2/n2proxy">n2proxy</a></h2>
<p>I use the command line <code>n2proxy</code> when working and testing patterns locally, however in production use I prefer using the docker container (<code>docker pull txn2/n2proxy</code>). See the following examples:</p>
<p><strong>Command Version</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>n2proxy --port<span style="color:#f92672">=</span><span style="color:#ae81ff">9099</span> --backend<span style="color:#f92672">=</span>https://www.google.com/ --cfg<span style="color:#f92672">=</span>./cfg.yml
</span></span></code></pre></div><p><strong>Docker Version</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --rm -t -v <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>pwd<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>:/n2p/ -p 9099:9099 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    txn2/n2proxy --port<span style="color:#f92672">=</span><span style="color:#ae81ff">9099</span> --cfg<span style="color:#f92672">=</span>/n2p/cfg.yml <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --backend<span style="color:#f92672">=</span>https://www.google.com/
</span></span></code></pre></div><p>The <a href="https://www.docker.com/">Docker</a> method is preferred when you need it to run in the background or survive reboots.</p>
<p><strong>Background Docker</strong></p>
<p>Naming your <a href="https://www.docker.com/">Docker</a> container is a good idea if you plan to run more than one proxy (be sure they each get their own port on the host).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --name n2p-google -d <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -v <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>pwd<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>:/n2p/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -p 9099:9099 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --restart<span style="color:#f92672">=</span>unless-stopped <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    txn2/n2proxy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --port<span style="color:#f92672">=</span><span style="color:#ae81ff">9099</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --cfg<span style="color:#f92672">=</span>/n2p/cfg.yml <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --backend<span style="color:#f92672">=</span>https://www.google.com/
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tail the logs</span>
</span></span><span style="display:flex;"><span>docker logs -f n2p-google
</span></span></code></pre></div><p>You now have <a href="https://www.google.com">https://www.google.com</a> served through <a href="https://github.com/txn2/n2proxy">n2proxy</a> to <a href="http://localhost:9099">http://localhost:9099</a> on your local workstation.</p>
<p>A Google.com proxy is a sound proof of concept, however, unless we run another HTTP proxy like <a href="https://www.charlesproxy.com/">Charles</a>. We can&rsquo;t see what Google is receiving from us. Only it&rsquo;s response.</p>
<p>Now is a good time switch over to using <a href="https://docs.postman-echo.com/">postman-echo.com</a> since it&rsquo;s very purpose is to send us back what we sent it. <a href="https://docs.postman-echo.com/">postman-echo.com</a> returns <a href="https://www.json.org/">json</a> data and therefore I highly recommend installing <strong><a href="https://www.google.com/search?q=jsonpp">jsonpp</a></strong> or <strong><a href="https://www.google.com/search?q=json_pp">json_pp</a></strong> or a number of variations, on MacOs you can use brew:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew install jsonpp
</span></span></code></pre></div><p>Now start up a new proxy pointed to <a href="https://docs.postman-echo.com/">postman-echo.com</a> as the backend.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># get a config if you don&#39;t already have one</span>
</span></span><span style="display:flex;"><span>wget https://github.com/txn2/n2proxy/blob/master/cfg.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># open a proxy to postman-echo.com on port 9090</span>
</span></span><span style="display:flex;"><span>n2proxy --port<span style="color:#f92672">=</span><span style="color:#ae81ff">9090</span> --backend<span style="color:#f92672">=</span>https://postman-echo.com/ --cfg<span style="color:#f92672">=</span>./cfg.yml
</span></span></code></pre></div><p>In a separate terminal window use <a href="https://curl.haxx.se/docs/manpage.html">curl</a> to make an HTTP post request:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s --request POST --url http://localhost:9090/post <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>--data <span style="color:#e6db74">&#39;This taco is expected to be sent back, good   times.&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>| jsonpp
</span></span></code></pre></div><p>Postman sends back what is received, and with this, we can see the correct filtering was performed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;args&#34;</span>: {},
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;files&#34;</span>: {},
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;form&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;This cato is expected to be sent back, GOODTIMES.&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;headers&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;host&#34;</span>: <span style="color:#e6db74">&#34;postman-echo.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;content-length&#34;</span>: <span style="color:#e6db74">&#34;49&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;accept&#34;</span>: <span style="color:#e6db74">&#34;*/*&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;accept-encoding&#34;</span>: <span style="color:#e6db74">&#34;gzip&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;content-type&#34;</span>: <span style="color:#e6db74">&#34;application/x-www-form-urlencoded&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;user-agent&#34;</span>: <span style="color:#e6db74">&#34;curl/7.60.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;x-forwarded-port&#34;</span>: <span style="color:#e6db74">&#34;443&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;x-forwarded-proto&#34;</span>: <span style="color:#e6db74">&#34;https&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;json&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;This cato is expected to be sent back, GOODTIMES.&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;https://postman-echo.com/post&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In the <strong>form</strong> and <strong>json</strong> sections we see the word <strong>taco</strong> became <strong>cato</strong> as a result of the <code>shuffle</code> function in the first <strong>postFilter</strong>  <code>.Match | shuffle</code> and <strong>good    times</strong> became <strong>GOODTIMES</strong> from the from the <code>upper</code> and <code>nospace</code> functions in the second <strong>postFilter</strong> <code>.Match | upper | nospace</code></p>
<p>The response from <a href="https://docs.postman-echo.com/">postman-echo.com</a> is a clear indication that rules in <strong>postFilter</strong> are functioning as intended.</p>
<p>For the remainder of this article, I&rsquo;ll be going over the essential pieces of <a href="https://golang.org/">go</a> code that are used to create <a href="https://github.com/txn2/n2proxy">n2proxy</a>.</p>
<h2 id="proxy-with-golang">Proxy with Golang</h2>
<p>The <a href="https://golang.org/">go</a> standard libraries <a href="https://golang.org/pkg/net/http/">net/http</a> and <a href="https://golang.org/pkg/net/http/httputil/">net/http/httputil</a> come with all the functionality needed for the proxy.</p>
<p>The following source code is an abstract from the file <a href="https://github.com/txn2/n2proxy/blob/master/server.go">server.go</a>, which contains the main application <a href="https://thenewstack.io/understanding-golang-packages/">package</a>.</p>
<p><strong>HTTP Server</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// server</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">proxy</span>.<span style="color:#a6e22e">handle</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">tls</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">true</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Starting proxy in plain HTTP mode.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;:&#34;</span><span style="color:#f92672">+*</span><span style="color:#a6e22e">port</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Error starting proxy: %s\n&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Starting proxy in TLS mode.&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServeTLS</span>(<span style="color:#e6db74">&#34;:&#34;</span><span style="color:#f92672">+*</span><span style="color:#a6e22e">port</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">crt</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">key</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Error starting proxyin TLS mode: %s\n&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Starting at the implementation, we see that the proxy is merely a path handler on the standard <a href="https://golang.org/">go</a> HTTP server.  The <strong>handle</strong> method on the <strong>proxy</strong> object passed all HTTP requests sent to the server beginning with <code>/</code>.</p>
<p>Using an environment variable or flag (<code>if *tls != true {</code>) we can choose between serving plain HTTP with <a href="https://golang.org/pkg/net/http/#ListenAndServe">http.ListenAndServe</a> or encrypted HTTP over TLS (HTTPS) with <a href="https://golang.org/pkg/net/http/#ListenAndServeTLS">http.ListenAndServeTLS</a>.</p>
<p>Working from the implementation up, we see the <strong>proxy</strong> object is created with three arguments: <strong>backend</strong>, <strong>cfg</strong> and <strong>logger</strong>*:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>proxy :<span style="color:#f92672">=</span> NewProxy<span style="color:#f92672">(</span>*backend, *cfg, logger<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Because I am using the command line <a href="https://golang.org/pkg/flag/">flag</a> package from <a href="https://golang.org/">go</a>, I must dereference pointers to values with a <code>*</code>, since the <code>NewProxy</code> function is expecting values.</p>
<ul>
<li><strong>backend</strong> - example: <a href="https://postman-echo.com/">https://postman-echo.com/</a></li>
<li><strong>cfg</strong> - example: ./cfg.yml</li>
<li><strong>logger</strong> - a configured <a href="https://github.com/uber-go/zap">zap</a> logger (speed is essential)</li>
</ul>
<h3 id="new-proxy">New Proxy</h3>
<p>The <code>NewProxy</code> function returns an object with a <code>handle</code> method we passed to the <a href="https://golang.org/pkg/net/http/#HandleFunc">http.HandleFunc</a> in the implementation above. Since <code>handle</code> is a method of the new proxy object created by <code>NewProxy</code> it has access to its configuration. The <code>proxy</code> object is a <a href="https://golang.org/">go</a> struct with a method called <code>handle</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Proxy</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">target</span>  <span style="color:#f92672">*</span><span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">URL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">proxy</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">httputil</span>.<span style="color:#a6e22e">ReverseProxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cfgFile</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">logger</span>  <span style="color:#f92672">*</span><span style="color:#a6e22e">zap</span>.<span style="color:#a6e22e">Logger</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">eng</span>     <span style="color:#f92672">*</span><span style="color:#a6e22e">rweng</span>.<span style="color:#a6e22e">Eng</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The core component of this proxy object is a pointer to a <a href="https://golang.org/pkg/net/http/httputil/#ReverseProxy">ReverseProxy</a> object created by the <a href="https://golang.org/pkg/net/http/httputil/">httputil</a> package&rsquo;s <a href="https://golang.org/pkg/net/http/httputil/#NewSingleHostReverseProxy">NewSingleHostReverseProxy</a> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewProxy</span>(<span style="color:#a6e22e">target</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">cfgFile</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">logger</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">zap</span>.<span style="color:#a6e22e">Logger</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Proxy</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">targetUrl</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#a6e22e">target</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Unable to parse URL: %s\n&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// create an rweng engine from a yaml configuration</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">eng</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rweng</span>.<span style="color:#a6e22e">NewEngFromYml</span>(<span style="color:#a6e22e">cfgFile</span>, <span style="color:#a6e22e">logger</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Engine failure: %s\n&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pxy</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">httputil</span>.<span style="color:#a6e22e">NewSingleHostReverseProxy</span>(<span style="color:#a6e22e">targetUrl</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">proxy</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Proxy</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">target</span>: <span style="color:#a6e22e">targetUrl</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">proxy</span>:  <span style="color:#a6e22e">pxy</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">logger</span>: <span style="color:#a6e22e">logger</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">eng</span>:    <span style="color:#a6e22e">eng</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">proxy</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Filtering and blocking is the central purpose of this proxy. The <code>handle</code> method below has access to <code>eng</code> where a method called <code>ProcessRequest</code> gets a shot at modifying the response and request data. You can think of it as a proxy within a proxy. The following code shows <strong>http.ResponseWriter</strong> and <strong>http.Request</strong> objects are sent first to <code>p.eng.ProcessRequest(w, r)</code> and finally handled by <code>p.proxy.ServeHTTP(w, r)</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Proxy</span>) <span style="color:#a6e22e">handle</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">start</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">reqPath</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">Path</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">reqMethod</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Method</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">end</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">latency</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">end</span>.<span style="color:#a6e22e">Sub</span>(<span style="color:#a6e22e">start</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#a6e22e">reqPath</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">zap</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;method&#34;</span>, <span style="color:#a6e22e">reqMethod</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">zap</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;path&#34;</span>, <span style="color:#a6e22e">reqPath</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">zap</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;time&#34;</span>, <span style="color:#a6e22e">end</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">RFC3339</span>)),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">zap</span>.<span style="color:#a6e22e">Duration</span>(<span style="color:#e6db74">&#34;latency&#34;</span>, <span style="color:#a6e22e">latency</span>),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Host</span> = <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">Host</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// process request</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">eng</span>.<span style="color:#a6e22e">ProcessRequest</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">proxy</span>.<span style="color:#a6e22e">ServeHTTP</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>If you are curious how <code>p.eng.ProcessRequest(w, r)</code> filters data check out the method <code>ProcessRequest</code> in the <a href="https://github.com/txn2/n2proxy/blob/master/rweng/rweng.go">rweng</a> source code (read/write engine). In <a href="https://github.com/txn2/n2proxy/blob/master/rweng/rweng.go">rweng</a> the function <strong>NewEngFromYml</strong> is where the <a href="https://github.com/txn2/n2proxy/blob/master/cfg.yml">yaml configuration</a> file is Unmarshaled into a configuration struct after which all <a href="http://www.rexegg.com/regex-quickstart.html">regex patterns</a> and <a href="https://blog.gopheracademy.com/advent-2017/using-go-templates/">go templates</a> are pre-compiled.</p>
<h3 id="next-steps">Next Steps</h3>
<p><strong>Middleware</strong>: The method <code>p.eng.ProcessRequest(w, r)</code> is called before <code>p.proxy.ServeHTTP(w, r)</code> and of course this would be a great place to call dynamically any number of handler middlewares. We can also inject middleware higher up in the <a href="https://golang.org/pkg/net/http/">net/http</a> package.</p>
<p><strong>Concurrency</strong>: In the <a href="https://github.com/txn2/n2proxy/blob/master/rweng/rweng.go">rweng</a> method <code>ProcessRequest</code> filters run serially, however, if dealing with a vast number of rules, a more sophisticated Fan-out, fan-in solution can chunk the rules and process them concurrently (assuming you are working on copies of data). See <a href="https://blog.golang.org/pipelines">Go Concurrency Patterns: Pipelines and cancellation</a>.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://www.charlesproxy.com/">Charles</a> HTTP proxy</li>
<li><a href="https://brew.sh/">brew</a> is the missing package manager for macOS</li>
<li><a href="http://www.haproxy.org/">haproxy</a> is a reliable, high performance TCP/HTTP load balancer</li>
<li><a href="https://www.nginx.com/">nginx</a> started as a web server / proxy and now considers itself a platform.</li>
<li><a href="https://github.com/txn2/n2proxy">n2proxy</a> for contraband filtering reverse proxy for plain HTTP and SSL.</li>
<li>The <a href="https://golang.org/">go</a> programming language.</li>
<li><a href="https://www.jscape.com/blog/bid/87783/Forward-Proxy-vs-Reverse-Proxy">Forward Proxy vs. Reverse Proxy</a></li>
<li><a href="https://en.wikipedia.org/wiki/Regular_expression">regular expressions</a></li>
<li><a href="https://www.symantec.com/connect/articles/detection-sql-injection-and-cross-site-scripting-attacks">Detection of SQL Injection and Cross-site Scripting Attacks</a></li>
<li><a href="https://blog.golang.org/pipelines">Go Concurrency Patterns: Pipelines and cancellation</a></li>
<li><a href="https://blog.gopheracademy.com/advent-2017/using-go-templates/">go templates</a></li>
<li><a href="http://masterminds.github.io/sprig/">sprig</a> - Over 70 template functions for Go’s template language.</li>
<li><a href="https://docs.postman-echo.com/">postman-echo.com</a> - test your REST clients and make sample API calls.</li>
</ul>


                <p>
                   This blog post, titled: "<span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Reverse Proxy in Golang: Retrofit security proxy to prevent XSS and code injection.</span>" by <a xmlns:cc="http://creativecommons.org/ns#" href="https://twitter.com/cjimti" property="cc:attributionName" rel="cc:attributionURL">Craig Johnston</a>, is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
                </p>

            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="../tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="../tags/ai" title="ai">
                        ai
                        </a>
                        
                        
                        
                        <a href="../tags/blockchain" title="blockchain">
                        blockchain
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/data" title="data">
                        data
                        </a>
                        
                        
                        
                        <a href="../tags/data-science" title="data science">
                        data science
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/development" title="development">
                        development
                        </a>
                        
                        
                        
                        <a href="../tags/devops" title="devops">
                        devops
                        </a>
                        
                        
                        
                        
                        
                        <a href="../tags/docker" title="docker">
                        docker
                        </a>
                        
                        
                        
                        <a href="../tags/elasticsearch" title="elasticsearch">
                        elasticsearch
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/golang" title="golang">
                        golang
                        </a>
                        
                        
                        
                        
                        
                        <a href="../tags/ingress" title="ingress">
                        ingress
                        </a>
                        
                        
                        
                        <a href="../tags/iot" title="iot">
                        iot
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/kubectl" title="kubectl">
                        kubectl
                        </a>
                        
                        
                        
                        <a href="../tags/kubefwd" title="kubefwd">
                        kubefwd
                        </a>
                        
                        
                        
                        <a href="../tags/kubernetes" title="kubernetes">
                        kubernetes
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/mcp" title="mcp">
                        mcp
                        </a>
                        
                        
                        
                        
                        
                        <a href="../tags/microservices" title="microservices">
                        microservices
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/python" title="python">
                        python
                        </a>
                        
                        
                        
                        <a href="../tags/raspberry-pi" title="raspberry pi">
                        raspberry pi
                        </a>
                        
                        
                        
                        <a href="../tags/security" title="security">
                        security
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/utils" title="utils">
                        utils
                        </a>
                        
                        
                        
                        
                        
                        
                    </div>
                </section>

                
                <hr>
                <h5>RELATED</h5>
                <ul class="list-inline">
                    
                </ul>
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="../index.xml" rel="alternate" type="application/rss+xml" title="IMTI" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:cjimti@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a href="https://twitter.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/cjimti/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                </ul>
            </div>
        </div>
    </div>
</footer>


<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<script>
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-R56SP4WLS2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R56SP4WLS2');
</script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({ theme: 'neutral' });
  mermaid.run();
</script>


<script data-cfasync="false">
(function() {
    var themeToggle = document.getElementById('theme-toggle');
    var themeIcon = document.getElementById('theme-icon');

    function getCurrentTheme() {
        return document.documentElement.getAttribute('data-theme') || 'light';
    }

    function updateIcon() {
        var currentTheme = getCurrentTheme();
        if (themeIcon) {
            if (currentTheme === 'dark') {
                themeIcon.className = 'fa fa-sun-o';
            } else {
                themeIcon.className = 'fa fa-moon-o';
            }
        }
    }

    function toggleTheme() {
        var currentTheme = getCurrentTheme();
        var newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        if (newTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        } else {
            document.documentElement.removeAttribute('data-theme');
        }

        localStorage.setItem('theme', newTheme);
        updateIcon();
    }

    updateIcon();

    if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
    }

    if (window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            if (!localStorage.getItem('theme')) {
                if (e.matches) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                }
                updateIcon();
            }
        });
    }
})();
</script>

</body>
</html>
