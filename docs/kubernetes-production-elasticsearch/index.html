<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta name="msvalidate.01" content="DBC34551F2DD1BA3DC0D62EE46D7448F" />
    <meta name="google-site-verification" content="DrtKc88u9uc7iptd4LyURAKBmFcOn7Kuk6HcRk_kNmo" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Setup a fast, custom production grade Elasticsearch cluster.">
    
    <meta name="keyword"  content="Go, Kubernetes, Elasticsearch, Python, Docker, Big Data, Artificial Intelligence, Machine Learning, Blockchain">
    <link rel="shortcut icon" href="https://imti.co/img/favicon.ico">

    <title>Production Grade Elasticsearch on Kubernetes - IMTI - Craig Johnston</title>

    <link rel="canonical" href="https://imti.co/kubernetes-production-elasticsearch/">
	
    
    <link rel="stylesheet" href="https://imti.co/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://imti.co/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="https://imti.co/css/syntax.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <link rel="stylesheet" href="/css/imti.css">

    
    <script src="https://imti.co/js/jquery.min.js"></script>
    
    
    <script src="https://imti.co/js/bootstrap.min.js"></script>
    
    
    <script src="https://imti.co/js/hux-blog.min.js"></script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-5984764595236029",
            enable_page_level_ads: true
        });
    </script>

    <meta name="twitter:site" content="@cjimti">
<meta name="twitter:creator" content="@cjimti">

<meta name="twitter:description" content="Setup a fast, custom production grade Elasticsearch cluster." />
<meta name="twitter:title" content="Production Grade Elasticsearch on Kubernetes" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://imti.co/img/post/nav_876_438.jpg" />
<meta property="og:image" content="https://imti.co/img/post/nav_876_438.jpg" />



    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/imti.co\/kubernetes-production-elasticsearch\/"
  },
  "headline": "Production Grade Elasticsearch on Kubernetes",
  "image": [
    "https:\/\/imti.co\/img\/post\/nav_876_438.jpg"
   ],
  "datePublished": "2018-07-14T00:00:00",
  "dateModified": "2018-07-14T00:00:00",
  "author": {
    "@type": "Person",
    "name": "Craig Johnston"
  },
   "publisher": {
    "@type": "Organization",
    "name": 'imti.co",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/imti.co\/img\/craig_johnston_cjimti.jpg"
    }
  },
  "description": "Installing production ready, Elasticsearch 6.2 on Kubernetes requires a hand full of simple configurations. The following guide is a high-level overview of an installation process using Elastic\u0026rsquo;s recommendations for best practices. The Github project kubernetes-elasticsearch-cluster is used for the Elastic Docker container and built to operate Elasticsearch with nodes dedicated as Master, Data, and Client\/Ingest.\nThe Docker container docker-elasticsearch, a \u0026ldquo;Ready to use, lean and highly configurable Elasticsearch container image.\u0026rdquo; by pires is sufficient for use in this guide."
}
</script>

</head></head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://imti.co/">IMTI</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://imti.co/">Home</a>
                    </li>
                    <li>
                        <a href="https://imti.co/about/">About</a>
                    </li>
                    <li>
                        <a href="https://twitter.com/cjimti">Follow</a>
                    </li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header{
        background-image: url('https://imti.co/img/post/nav.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/kubernetes" title="Kubernetes">
                        Kubernetes
                        </a>
                        
                        <a class="tag" href="/tags/elasticsearch" title="Elasticsearch">
                        Elasticsearch
                        </a>
                        
                        <a class="tag" href="/tags/data" title="Data">
                        Data
                        </a>
                        
                    </div>
                    <h1>Production Grade Elasticsearch on Kubernetes</h1>
                    <h2 class="subheading">Setup a fast, custom production grade Elasticsearch cluster.</h2>
                    <span  class="meta">Posted by <a href="https://twitter.com/cjimti">Craig Johnston</a> on Saturday, July 14, 2018
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>Installing production ready, Elasticsearch 6.2 on Kubernetes requires a hand full of simple configurations. The following guide is a high-level overview of an installation process using Elastic&rsquo;s <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html">recommendations for best practices</a>. The Github project <a href="https://github.com/pires/kubernetes-elasticsearch-cluster">kubernetes-elasticsearch-cluster</a> is used for the Elastic Docker container and built to operate Elasticsearch with nodes dedicated as Master, Data, and Client/Ingest.</p>
<p>The Docker container <a href="https://github.com/pires/docker-elasticsearch">docker-elasticsearch</a>, a &ldquo;Ready to use, lean and highly configurable Elasticsearch container image.&rdquo; by <a href="https://github.com/pires">pires</a> is sufficient for use in this guide. However, the <a href="https://github.com/txn2/k8s-es">txn2/k8s-es</a> wraps it with a few minor preset environment variables to simplify configuration. I use the docker image <a href="https://hub.docker.com/r/txn2/k8s-es/tags/">txn2/k8s-es:v6.2.3</a> in the examples below.</p>
<p>The Github repository <a href="https://github.com/pires/kubernetes-elasticsearch-cluster">kubernetes-elasticsearch-cluster</a> contains detailed documentation and configuration for using <a href="https://github.com/pires/docker-elasticsearch">docker-elasticsearch</a> with Kubernetes.</p>
<p>If you need to set up a quick, yet custom production grade cluster, check out my article <a href="/hobby-cluster/">Production Hobby Cluster</a> to get you started.</p>
<aside class="toc">
    <header>
        <h2>Contents</h2>
    </header>
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#project-namespace">Project <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Namespace</a></a></li>
        <li><a href="#rbac-for-access-and-security"><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a> for Access and Security</a></li>
        <li><a href="#services-for-communication"><a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> for Communication</a></li>
        <li><a href="#statefulset-for-data-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#data-node">Data</a> nodes</a></li>
        <li><a href="#deployment-for-master-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#master-node">Master</a> Nodes</a></li>
        <li><a href="#deployment-for-client-and-ingest-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> for Client and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">Ingest</a> Nodes</a></li>
        <li><a href="#testing">Testing</a></li>
      </ul>
    </li>
    <li><a href="#port-forwarding--local-development">Port Forwarding / Local Development</a>
      <ul>
        <li><a href="#next">Next</a></li>
      </ul>
    </li>
  </ul>
</nav>
</aside>
<div class="ad-div">
    <a href="https://amzn.to/3hAZUvx">
        <img src="/img/kubernetes_platform_development.jpg" style="padding:0; margin: 0; width: 50%; float: left"/>
    </a>

    <div style="padding-left: 15px; overflow:auto;">
        <a href="https://amzn.to/3hAZUvx">Support this blog! Buy my new book:
            <h4>Advanced Platform Development with Kubernetes</h4>
        </a>
        <h5>What You'll Learn</h5>
        <ul style="padding-bottom: 0; margin: 0">
            <li>Build data pipelines with <b>MQTT, NiFi, Logstash, MinIO, Hive, Presto, Kafka and Elasticsearch</b></li>
            <li>Leverage <b>Serverless</b> ETL with <b>OpenFaaS</b></li>
            <li>Explore <b>Blockchain</b> networking with <b>Ethereum</b></li>
            <li>Support a multi-tenant <b>Data Science</b> platform with <b>JupyterHub, MLflow and Seldon Core</b></li>
            <li>Build a <b>Multi-cloud</b>, <b>Hybrid cluster</b>, securely bridging <b>on-premise</b> and cloud-based Kubernetes nodes</li>
        </ul>
    </div>
</div>

<h3 id="project-namespace">Project <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Namespace</a></h3>
<p>In the examples below I&rsquo;ll use the namespace <strong>the-project</strong> for all the configurations. The file names are suggestions and may be adjusted to your standards.</p>
<p><code>00-namespace.yml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Namespace</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">the-project</span>
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
</code></pre></div><p>Create the namespace:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create -f 00-namespace.yml
</code></pre></div><h3 id="rbac-for-access-and-security"><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a> for Access and Security</h3>
<p>Your Kubernetes cluster should be set up to use <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a>. If you are just getting started, you may want to set up a <a href="/hobby-cluster/#permissions-rbac-role-based-access-control">permissive RBAC</a> implementation for your development cluster.</p>
<p>This <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a> step is optional and only intended as a suggestion for tighter security. If you have <a href="/hobby-cluster/#permissions-rbac-role-based-access-control">permissive RBAC</a> there is no need to create this configuration now, as the following steps do not require it.</p>
<p>Creating a <a href="/team-kubernetes-remote-access/#serviceaccount">ServiceAccount</a> called <code>sa-elasticsearch</code> for Elasticsearch in <code>the-project</code> namespace.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create serviceaccount sa-elasticsearch -n the-project
</code></pre></div><p>Next, create a <a href="/team-kubernetes-remote-access/#role-and-rolebinding">Role and RoleBinding</a> for the new <code>sa-elasticsearch</code> <a href="/team-kubernetes-remote-access/#serviceaccount">ServiceAccount</a>, it makes sense to group tease in the same configuration file.</p>
<p><code>10-rbac.yml</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
<span style="color:#f92672">rules</span>:
- <span style="color:#f92672">apiGroups</span>:
  - <span style="color:#e6db74">&#34;&#34;</span>
  <span style="color:#f92672">resources</span>:
  - <span style="color:#ae81ff">endpoints</span>
  <span style="color:#f92672">verbs</span>:
  - <span style="color:#ae81ff">get</span>
---
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
<span style="color:#f92672">roleRef</span>:
  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch</span>
<span style="color:#f92672">subjects</span>:
- <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">sa-elasticsearch</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
</code></pre></div><p>Create the <a href="/team-kubernetes-remote-access/#role-and-rolebinding">Role and RoleBinding</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create -f 10-rbac.yml
</code></pre></div><h3 id="services-for-communication"><a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> for Communication</h3>
<p>You need  Kubernetes <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> for each of the Elasticsearch node types, Master, Data and Ingest. <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> are a persistent communication bridge to a <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a>. Because Services use <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">selectors</a> to find the appropriate <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a>, they are up first. <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> are accustomed to Pods coming and going, and route to them when they are available, this happens once we add Deployments further down.</p>
<p>Combine all three Services in the same configuration file to keep things simple.</p>
<p><code>20-services.yml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project </span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch</span>
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-client</span>
  <span style="color:#f92672">ports</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">http</span>
    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">9200</span>
    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
---
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project </span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch-data</span>
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">clusterIP</span>: <span style="color:#ae81ff">None</span>
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-data</span>
  <span style="color:#f92672">ports</span>:
  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">9300</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">transport</span>
---
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project </span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch-discovery</span>
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-master</span>
  <span style="color:#f92672">ports</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">transport</span>
    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">9300</span>
    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</code></pre></div><h3 id="statefulset-for-data-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#data-node">Data</a> nodes</h3>
<p>Next, we configure a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> to manage our Elasticsearch <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#data-node">Data</a></strong> nodes (<a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pods</a>). A <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> &ldquo;manages the deployment and scaling of a set of Pods, and provides guarantees about the ordering and uniqueness of these Pods.&rdquo;</p>
<p>Since a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> creates <a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">ReplicaSets</a> and not <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a>, we need to create a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> directly for the Elasticsearch <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#data-node">data</a></strong> nodes. The <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#master-node">Master</a></strong> and <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">Ingest</a></strong> nodes use <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a>s which automatically generate <a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">ReplicaSets</a> for them.</p>
<p><code>30-statefulset-data.yml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch-data</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-data</span>
    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">elasticsearch-data</span>
  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span> <span style="color:#75715e"># scale when desired</span>
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">matchLabels</span>:
      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-data</span>
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">labels</span>:
        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-data</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">initContainers</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">init-sysctl</span>
        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.27.2</span>
        <span style="color:#f92672">command</span>:
        - <span style="color:#ae81ff">sysctl</span>
        - -<span style="color:#ae81ff">w</span>
        - <span style="color:#ae81ff">vm.max_map_count=262144</span>
        <span style="color:#f92672">securityContext</span>:
          <span style="color:#f92672">privileged</span>: <span style="color:#66d9ef">true</span>
      <span style="color:#f92672">containers</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch-data</span>
        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">txn2/k8s-es:v6.2.3</span>
        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">Always</span>
        <span style="color:#f92672">env</span>:
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NAMESPACE</span>
          <span style="color:#f92672">valueFrom</span>:
            <span style="color:#f92672">fieldRef</span>:
              <span style="color:#f92672">fieldPath</span>: <span style="color:#ae81ff">metadata.namespace</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">DISCOVERY_SERVICE</span>
          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">elasticsearch-discovery</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_NAME</span>
          <span style="color:#f92672">valueFrom</span>:
            <span style="color:#f92672">fieldRef</span>:
              <span style="color:#f92672">fieldPath</span>: <span style="color:#ae81ff">metadata.name</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">CLUSTER_NAME</span>
          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">elasticsearch</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_DATA</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;true&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_MASTER</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;false&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_INGEST</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;false&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">HTTP_ENABLE</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;false&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ES_JAVA_OPTS</span>
          <span style="color:#f92672">value</span>: -<span style="color:#ae81ff">Xms256m -Xmx256m</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">PROCESSORS</span>
          <span style="color:#f92672">valueFrom</span>:
            <span style="color:#f92672">resourceFieldRef</span>:
              <span style="color:#f92672">resource</span>: <span style="color:#ae81ff">limits.cpu</span>
        <span style="color:#f92672">resources</span>:
          <span style="color:#f92672">limits</span>:
            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">1</span>
        <span style="color:#f92672">ports</span>:
        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">9300</span>
          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">transport</span>
        <span style="color:#f92672">volumeMounts</span>:
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch-data-storage</span>
          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/data</span>
  <span style="color:#f92672">volumeClaimTemplates</span>:
  - <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch-data-storage</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">rook-block</span>
      <span style="color:#f92672">accessModes</span>: [ <span style="color:#ae81ff">ReadWriteOnce ]</span>
      <span style="color:#f92672">resources</span>:
        <span style="color:#f92672">requests</span>:
          <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">2Gi # small for dev / testing</span>
</code></pre></div><h3 id="deployment-for-master-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#master-node">Master</a> Nodes</h3>
<p>The <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#master-node">Master</a></strong> Elasticsearch nodes are &ldquo;responsible for lightweight cluster-wide actions such as creating or deleting an index, tracking which nodes are part of the cluster, and deciding which shards to allocate to which nodes. It is important for cluster health to have a stable master node.&rdquo;</p>
<p><code>40-deployment-master.yml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch-master</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-master</span>
    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span> <span style="color:#75715e"># scale as desired (see NUMBER_OF_MASTERS below)</span>
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">matchLabels</span>:
      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-master</span>
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">labels</span>:
        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-master</span>
        <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">initContainers</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">init-sysctl</span>
        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.27.2</span>
        <span style="color:#f92672">command</span>:
        - <span style="color:#ae81ff">sysctl</span>
        - -<span style="color:#ae81ff">w</span>
        - <span style="color:#ae81ff">vm.max_map_count=262144</span>
        <span style="color:#f92672">securityContext</span>:
          <span style="color:#f92672">privileged</span>: <span style="color:#66d9ef">true</span>
      <span style="color:#f92672">containers</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch-master</span>
        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">txn2/k8s-es:v6.2.3</span>
        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">Always</span>
        <span style="color:#f92672">env</span>:
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NAMESPACE</span>
          <span style="color:#f92672">valueFrom</span>:
            <span style="color:#f92672">fieldRef</span>:
              <span style="color:#f92672">fieldPath</span>: <span style="color:#ae81ff">metadata.namespace</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_NAME</span>
          <span style="color:#f92672">valueFrom</span>:
            <span style="color:#f92672">fieldRef</span>:
              <span style="color:#f92672">fieldPath</span>: <span style="color:#ae81ff">metadata.name</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">DISCOVERY_SERVICE</span>
          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">elasticsearch-discovery</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">CLUSTER_NAME</span>
          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">elasticsearch</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NUMBER_OF_MASTERS</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;2&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_MASTER</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;true&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_INGEST</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;false&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_DATA</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;false&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">HTTP_ENABLE</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;false&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ES_JAVA_OPTS</span>
          <span style="color:#f92672">value</span>: -<span style="color:#ae81ff">Xms256m -Xmx256m</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">PROCESSORS</span>
          <span style="color:#f92672">valueFrom</span>:
            <span style="color:#f92672">resourceFieldRef</span>:
              <span style="color:#f92672">resource</span>: <span style="color:#ae81ff">limits.cpu</span>
        <span style="color:#f92672">resources</span>:
          <span style="color:#f92672">limits</span>:
            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">1</span>
        <span style="color:#f92672">ports</span>:
        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">9300</span>
          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">transport</span>
        <span style="color:#f92672">volumeMounts</span>:
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">storage</span>
          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/data</span>
      <span style="color:#f92672">volumes</span>:
      - <span style="color:#f92672">emptyDir</span>:
          <span style="color:#f92672">medium</span>: <span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;storage&#34;</span>
</code></pre></div><h3 id="deployment-for-client-and-ingest-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> for Client and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">Ingest</a> Nodes</h3>
<p>For the sake of simplicity, we use our <strong>client</strong> nodes for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">ingest</a> and queries. These can easily be separated out once you have determined your load model. Separate <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">Ingest</a></strong> nodes allow you to &ldquo;pre-process documents before the actual document indexing happens. The ingest node intercepts bulk and index requests, it applies transformations, and it then passes the documents back to the index or bulk APIs.&rdquo; By default, Elasticsearch nodes allow <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">ingest</a>, so clients remain in this default mode.</p>
<p><code>60-deployment-client.yml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch-client</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-client</span>
    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span> <span style="color:#75715e"># scale as desired</span>
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">matchLabels</span>:
      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-client</span>
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">labels</span>:
        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">elasticsearch-client</span>
        <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">initContainers</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">init-sysctl</span>
        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.27.2</span>
        <span style="color:#f92672">command</span>:
        - <span style="color:#ae81ff">sysctl</span>
        - -<span style="color:#ae81ff">w</span>
        - <span style="color:#ae81ff">vm.max_map_count=262144</span>
        <span style="color:#f92672">securityContext</span>:
          <span style="color:#f92672">privileged</span>: <span style="color:#66d9ef">true</span>
      <span style="color:#f92672">containers</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">elasticsearch-client</span>
        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">txn2/k8s-es:v6.2.3</span>
        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">Always</span>
        <span style="color:#f92672">env</span>:
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NAMESPACE</span>
          <span style="color:#f92672">valueFrom</span>:
            <span style="color:#f92672">fieldRef</span>:
              <span style="color:#f92672">fieldPath</span>: <span style="color:#ae81ff">metadata.namespace</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_NAME</span>
          <span style="color:#f92672">valueFrom</span>:
            <span style="color:#f92672">fieldRef</span>:
              <span style="color:#f92672">fieldPath</span>: <span style="color:#ae81ff">metadata.name</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">DISCOVERY_SERVICE</span>
          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">elasticsearch-discovery</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">CLUSTER_NAME</span>
          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">elasticsearch</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_MASTER</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;false&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NETWORK_HOST</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;0.0.0.0&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_INGEST</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;true&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">NODE_DATA</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;false&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">HTTP_ENABLE</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;true&#34;</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ES_JAVA_OPTS</span>
          <span style="color:#f92672">value</span>: -<span style="color:#ae81ff">Xms256m -Xmx256m</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">PROCESSORS</span>
          <span style="color:#f92672">valueFrom</span>:
            <span style="color:#f92672">resourceFieldRef</span>:
              <span style="color:#f92672">resource</span>: <span style="color:#ae81ff">limits.cpu</span>
        <span style="color:#f92672">resources</span>:
          <span style="color:#f92672">limits</span>:
            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">1</span>
        <span style="color:#f92672">ports</span>:
        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">9200</span>
          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">http</span>
        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">9300</span>
          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">transport</span>
        <span style="color:#f92672">volumeMounts</span>:
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">storage</span>
          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/data</span>
      <span style="color:#f92672">volumes</span>:
      - <span style="color:#f92672">emptyDir</span>:
          <span style="color:#f92672">medium</span>: <span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;storage&#34;</span>
</code></pre></div><h3 id="testing">Testing</h3>
<p>Use <code>kubectl exec</code> to open a terminal into a Pod in <code>the-project</code> namespace and use <code>curl</code> to test the new Elasticsearch cluster.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl exec -it SOME_POD sh -n the-project 
</code></pre></div><p>Retrieve Elasticsearch cluster stats:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X GET <span style="color:#e6db74">&#34;elasticsearch:9200/_cluster/stats?human&amp;pretty&#34;</span>
</code></pre></div><p>Example output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;_nodes&#34;</span> : {
    <span style="color:#f92672">&#34;total&#34;</span> : <span style="color:#ae81ff">4</span>,
    <span style="color:#f92672">&#34;successful&#34;</span> : <span style="color:#ae81ff">4</span>,
    <span style="color:#f92672">&#34;failed&#34;</span> : <span style="color:#ae81ff">0</span>
  },
  <span style="color:#f92672">&#34;cluster_name&#34;</span> : <span style="color:#e6db74">&#34;elasticsearch&#34;</span>,
  <span style="color:#f92672">&#34;timestamp&#34;</span> : <span style="color:#ae81ff">1531724609367</span>,
  <span style="color:#f92672">&#34;status&#34;</span> : <span style="color:#e6db74">&#34;green&#34;</span>,
  <span style="color:#f92672">&#34;indices&#34;</span> : {
    <span style="color:#f92672">&#34;count&#34;</span> : <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;shards&#34;</span> : { },
    <span style="color:#f92672">&#34;docs&#34;</span> : {
      <span style="color:#f92672">&#34;count&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;deleted&#34;</span> : <span style="color:#ae81ff">0</span>
    },
    <span style="color:#f92672">&#34;store&#34;</span> : {
      <span style="color:#f92672">&#34;size&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;size_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>
    },
    <span style="color:#f92672">&#34;fielddata&#34;</span> : {
      <span style="color:#f92672">&#34;memory_size&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;memory_size_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;evictions&#34;</span> : <span style="color:#ae81ff">0</span>
    },
    <span style="color:#f92672">&#34;query_cache&#34;</span> : {
      <span style="color:#f92672">&#34;memory_size&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;memory_size_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;total_count&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;hit_count&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;miss_count&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;cache_size&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;cache_count&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;evictions&#34;</span> : <span style="color:#ae81ff">0</span>
    },
    <span style="color:#f92672">&#34;completion&#34;</span> : {
      <span style="color:#f92672">&#34;size&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;size_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>
    },
    <span style="color:#f92672">&#34;segments&#34;</span> : {
      <span style="color:#f92672">&#34;count&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;memory&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;memory_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;terms_memory&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;terms_memory_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;stored_fields_memory&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;stored_fields_memory_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;term_vectors_memory&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;term_vectors_memory_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;norms_memory&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;norms_memory_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;points_memory&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;points_memory_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;doc_values_memory&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;doc_values_memory_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;index_writer_memory&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;index_writer_memory_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;version_map_memory&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;version_map_memory_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;fixed_bit_set&#34;</span> : <span style="color:#e6db74">&#34;0b&#34;</span>,
      <span style="color:#f92672">&#34;fixed_bit_set_memory_in_bytes&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;max_unsafe_auto_id_timestamp&#34;</span> : <span style="color:#ae81ff">-9223372036854775808</span>,
      <span style="color:#f92672">&#34;file_sizes&#34;</span> : { }
    }
  },
  <span style="color:#f92672">&#34;nodes&#34;</span> : {
    <span style="color:#f92672">&#34;count&#34;</span> : {
      <span style="color:#f92672">&#34;total&#34;</span> : <span style="color:#ae81ff">4</span>,
      <span style="color:#f92672">&#34;data&#34;</span> : <span style="color:#ae81ff">1</span>,
      <span style="color:#f92672">&#34;coordinating_only&#34;</span> : <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;master&#34;</span> : <span style="color:#ae81ff">2</span>,
      <span style="color:#f92672">&#34;ingest&#34;</span> : <span style="color:#ae81ff">1</span>
    },
    <span style="color:#f92672">&#34;versions&#34;</span> : [
      <span style="color:#e6db74">&#34;6.2.3&#34;</span>
    ],
    <span style="color:#f92672">&#34;os&#34;</span> : {
      <span style="color:#f92672">&#34;available_processors&#34;</span> : <span style="color:#ae81ff">22</span>,
      <span style="color:#f92672">&#34;allocated_processors&#34;</span> : <span style="color:#ae81ff">4</span>,
      <span style="color:#f92672">&#34;names&#34;</span> : [
        {
          <span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;Linux&#34;</span>,
          <span style="color:#f92672">&#34;count&#34;</span> : <span style="color:#ae81ff">4</span>
        }
      ],
      <span style="color:#f92672">&#34;mem&#34;</span> : {
        <span style="color:#f92672">&#34;total&#34;</span> : <span style="color:#e6db74">&#34;37.1gb&#34;</span>,
        <span style="color:#f92672">&#34;total_in_bytes&#34;</span> : <span style="color:#ae81ff">39837057024</span>,
        <span style="color:#f92672">&#34;free&#34;</span> : <span style="color:#e6db74">&#34;8.4gb&#34;</span>,
        <span style="color:#f92672">&#34;free_in_bytes&#34;</span> : <span style="color:#ae81ff">9092431872</span>,
        <span style="color:#f92672">&#34;used&#34;</span> : <span style="color:#e6db74">&#34;28.6gb&#34;</span>,
        <span style="color:#f92672">&#34;used_in_bytes&#34;</span> : <span style="color:#ae81ff">30744625152</span>,
        <span style="color:#f92672">&#34;free_percent&#34;</span> : <span style="color:#ae81ff">23</span>,
        <span style="color:#f92672">&#34;used_percent&#34;</span> : <span style="color:#ae81ff">77</span>
      }
    },
    <span style="color:#f92672">&#34;process&#34;</span> : {
      <span style="color:#f92672">&#34;cpu&#34;</span> : {
        <span style="color:#f92672">&#34;percent&#34;</span> : <span style="color:#ae81ff">0</span>
      },
      <span style="color:#f92672">&#34;open_file_descriptors&#34;</span> : {
        <span style="color:#f92672">&#34;min&#34;</span> : <span style="color:#ae81ff">173</span>,
        <span style="color:#f92672">&#34;max&#34;</span> : <span style="color:#ae81ff">179</span>,
        <span style="color:#f92672">&#34;avg&#34;</span> : <span style="color:#ae81ff">175</span>
      }
    },
    <span style="color:#f92672">&#34;jvm&#34;</span> : {
      <span style="color:#f92672">&#34;max_uptime&#34;</span> : <span style="color:#e6db74">&#34;1.7h&#34;</span>,
      <span style="color:#f92672">&#34;max_uptime_in_millis&#34;</span> : <span style="color:#ae81ff">6414192</span>,
      <span style="color:#f92672">&#34;versions&#34;</span> : [
        {
          <span style="color:#f92672">&#34;version&#34;</span> : <span style="color:#e6db74">&#34;1.8.0_151&#34;</span>,
          <span style="color:#f92672">&#34;vm_name&#34;</span> : <span style="color:#e6db74">&#34;OpenJDK 64-Bit Server VM&#34;</span>,
          <span style="color:#f92672">&#34;vm_version&#34;</span> : <span style="color:#e6db74">&#34;25.151-b12&#34;</span>,
          <span style="color:#f92672">&#34;vm_vendor&#34;</span> : <span style="color:#e6db74">&#34;Oracle Corporation&#34;</span>,
          <span style="color:#f92672">&#34;count&#34;</span> : <span style="color:#ae81ff">4</span>
        }
      ],
      <span style="color:#f92672">&#34;mem&#34;</span> : {
        <span style="color:#f92672">&#34;heap_used&#34;</span> : <span style="color:#e6db74">&#34;418.3mb&#34;</span>,
        <span style="color:#f92672">&#34;heap_used_in_bytes&#34;</span> : <span style="color:#ae81ff">438676024</span>,
        <span style="color:#f92672">&#34;heap_max&#34;</span> : <span style="color:#e6db74">&#34;990mb&#34;</span>,
        <span style="color:#f92672">&#34;heap_max_in_bytes&#34;</span> : <span style="color:#ae81ff">1038090240</span>
      },
      <span style="color:#f92672">&#34;threads&#34;</span> : <span style="color:#ae81ff">79</span>
    },
    <span style="color:#f92672">&#34;fs&#34;</span> : {
      <span style="color:#f92672">&#34;total&#34;</span> : <span style="color:#e6db74">&#34;533gb&#34;</span>,
      <span style="color:#f92672">&#34;total_in_bytes&#34;</span> : <span style="color:#ae81ff">572367089664</span>,
      <span style="color:#f92672">&#34;free&#34;</span> : <span style="color:#e6db74">&#34;498.7gb&#34;</span>,
      <span style="color:#f92672">&#34;free_in_bytes&#34;</span> : <span style="color:#ae81ff">535527632896</span>,
      <span style="color:#f92672">&#34;available&#34;</span> : <span style="color:#e6db74">&#34;471.5gb&#34;</span>,
      <span style="color:#f92672">&#34;available_in_bytes&#34;</span> : <span style="color:#ae81ff">506362122240</span>
    },
    <span style="color:#f92672">&#34;plugins&#34;</span> : [ ],
    <span style="color:#f92672">&#34;network_types&#34;</span> : {
      <span style="color:#f92672">&#34;transport_types&#34;</span> : {
        <span style="color:#f92672">&#34;netty4&#34;</span> : <span style="color:#ae81ff">4</span>
      },
      <span style="color:#f92672">&#34;http_types&#34;</span> : {
        <span style="color:#f92672">&#34;netty4&#34;</span> : <span style="color:#ae81ff">4</span>
      }
    }
  }
}
</code></pre></div><h2 id="port-forwarding--local-development">Port Forwarding / Local Development</h2>
<p>Check out <a href="https://github.com/txn2/kubefwd">kubefwd</a> for a simple command line utility that bulk forwards services of one or more namespaces to your local workstation.</p>
<h3 id="next">Next</h3>
<ul>
<li>Setup <a href="/kibana-kubernetes/">Kibana on Kubernetes</a> for data exploration and visualization.</li>
<li>Process <a href="/post-json-elasticsearch-kubernetes/">High Traffic JSON Data into Elasticsearch on Kubernetes</a>.</li>
</ul>


                <p>
                   This blog post, titled: "<span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Production Grade Elasticsearch on Kubernetes: Setup a fast, custom production grade Elasticsearch cluster.</span>" by <a xmlns:cc="http://creativecommons.org/ns#" href="https://twitter.com/cjimti" property="cc:attributionName" rel="cc:attributionURL">Craig Johnston</a>, is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
                </p>

                <h5>SUPPORT</h5>
                <p>
                    Order my new Kubernetes book: <a href="https://amzn.to/34D56v6">Advanced Platform Development with Kubernetes: Enabling Data Management, the Internet of Things, Blockchain, and Machine Learning</a>
                </p>
                <script type="text/javascript">
                  amzn_assoc_tracking_id = "imti-20";
                  amzn_assoc_ad_mode = "manual";
                  amzn_assoc_ad_type = "smart";
                  amzn_assoc_marketplace = "amazon";
                  amzn_assoc_region = "US";
                  amzn_assoc_design = "enhanced_links";
                  amzn_assoc_asins = "1484256107";
                  amzn_assoc_placement = "adunit";
                  amzn_assoc_linkid = "14a9d8b8d1b0bd44e9256e0e0a948015";
                </script>
                <script src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US"></script>

                
                <hr>
                <h5>SHARE</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_share_toolbox"></div></li>
                </ul>

                <h5>FOLLOW</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_follow_toolbox"></div></li>
                </ul>

            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/blockchain" title="blockchain">
                        blockchain
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/data" title="data">
                        data
                        </a>
                        
                        
                        
                        <a href="/tags/data-science" title="data-science">
                        data-science
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/development" title="development">
                        development
                        </a>
                        
                        
                        
                        <a href="/tags/devops" title="devops">
                        devops
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                        docker
                        </a>
                        
                        
                        
                        <a href="/tags/elasticsearch" title="elasticsearch">
                        elasticsearch
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/golang" title="golang">
                        golang
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/ingress" title="ingress">
                        ingress
                        </a>
                        
                        
                        
                        <a href="/tags/iot" title="iot">
                        iot
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kubectl" title="kubectl">
                        kubectl
                        </a>
                        
                        
                        
                        <a href="/tags/kubernetes" title="kubernetes">
                        kubernetes
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/microservices" title="microservices">
                        microservices
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/python" title="python">
                        python
                        </a>
                        
                        
                        
                        <a href="/tags/raspberry-pi" title="raspberry-pi">
                        raspberry-pi
                        </a>
                        
                        
                        
                        <a href="/tags/security" title="security">
                        security
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/utils" title="utils">
                        utils
                        </a>
                        
                        
                        
                        
                        
                        
                    </div>
                </section>

                
                <hr>
                <h5>RELATED</h5>
                <ul class="list-inline">
                    
                </ul>
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="IMTI" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:cjimti@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a href="https://twitter.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/cjimti/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                </ul>

                
                
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b905a667cf4d77c"></script>



    
        
        
    





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-78786435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
