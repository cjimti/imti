<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta name="google-site-verification" content="" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="I lead a talented team of software development and creative engineers, covering many industries looking to collect, analyze, move, buffer, queue, process and present data in significant ways. My expertise and that of my team revolve around microservices, artificial intelligence, algorithms, machine learning and blockchain technologies.">
    
    <meta name="keyword"  content="Go, Kubernetes, Elasticsearch, Python, Docker, Big Data, Artificial Intelligence, Machine Learning, Blockchain">
    <link rel="shortcut icon" href="https://imti.co/img/favicon.ico">

    <title>Production Grade Elasticsearch on Kubernetes - IMTI - Craig Johnston</title>

    <link rel="canonical" href="https://imti.co/kubernetes-production-elasticsearch/">
	
    
    <link rel="stylesheet" href="https://imti.co/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://imti.co/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="https://imti.co/css/syntax.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <link rel="stylesheet" href="/css/imti.css">

    
    <script src="https://imti.co/js/jquery.min.js"></script>
    
    
    <script src="https://imti.co/js/bootstrap.min.js"></script>
    
    
    <script src="https://imti.co/js/hux-blog.min.js"></script>

    <meta name="twitter:site" content="@cjimti">
<meta name="twitter:creator" content="@cjimti">

<meta name="twitter:description" content="Installing production ready, Elasticsearch 6.2 on Kubernetes requires a hand full of simple configurations. The following guide is a high-level overview of an installation process using Elastic&rsquo;s recommendations for best practices. The Github project kubernetes-elasticsearch-cluster is used for the Elastic Docker container and built to operate Elasticsearch with nodes dedicated as Master, Data, and Client/Ingest.
The Docker container docker-elasticsearch, a &ldquo;Ready to use, lean and highly configurable Elasticsearch container image." />
<meta name="twitter:title" content="Production Grade Elasticsearch on Kubernetes" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://imti.co/img/post/nav_876_438.jpg" />
<meta property="og:image" content="https://imti.co/img/post/nav_876_438.jpg" />



    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://imti.co/kubernetes-production-elasticsearch/"
  },
  "headline": "Production Grade Elasticsearch on Kubernetes",
  "image": [
    "https://imti.co/img/post/nav_876_438.jpg"
   ],
  "datePublished": "2018-07-14T00:00:00",
  "dateModified": "2018-07-14T00:00:00",
  "author": {
    "@type": "Person",
    "name": "Craig Johnston"
  },
   "publisher": {
    "@type": "Organization",
    "name": 'imti.co",
    "logo": {
      "@type": "ImageObject",
      "url": "https://imti.co/img/craig_johnston_cjimti.jpg"
    }
  },
  "description": "Installing production ready, Elasticsearch 6.2 on Kubernetes requires a hand full of simple configurations. The following guide is a high-level overview of an installation process using Elastic&rsquo;s recommendations for best practices. The Github project kubernetes-elasticsearch-cluster is used for the Elastic Docker container and built to operate Elasticsearch with nodes dedicated as Master, Data, and Client/Ingest.
The Docker container docker-elasticsearch, a &ldquo;Ready to use, lean and highly configurable Elasticsearch container image."
}
</script>

</head></head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://imti.co/">IMTI</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://imti.co/">Home</a>
                    </li>
                    <li>
                        <a href="https://imti.co/about/">About</a>
                    </li>
                    <li>
                        <a href="https://twitter.com/cjimti">Follow</a>
                    </li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header{
        background-image: url('https://imti.co/img/post/nav.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/kubernetes" title="Kubernetes">
                        Kubernetes
                        </a>
                        
                        <a class="tag" href="/tags/elasticsearch" title="Elasticsearch">
                        Elasticsearch
                        </a>
                        
                        <a class="tag" href="/tags/data" title="Data">
                        Data
                        </a>
                        
                    </div>
                    <h1>Production Grade Elasticsearch on Kubernetes</h1>
                    <h2 class="subheading">Setup a fast, custom production grade Elasticsearch cluster.</h2>
                    <span  class="meta">Posted by Craig Johnston on Saturday, July 14, 2018
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h5>SHARE</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_share_toolbox"></div></li>
                </ul>

                

<p>Installing production ready, Elasticsearch 6.2 on Kubernetes requires a hand full of simple configurations. The following guide is a high-level overview of an installation process using Elastic&rsquo;s <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html">recommendations for best practices</a>. The Github project <a href="https://github.com/pires/kubernetes-elasticsearch-cluster">kubernetes-elasticsearch-cluster</a> is used for the Elastic Docker container and built to operate Elasticsearch with nodes dedicated as Master, Data, and Client/Ingest.</p>

<p>The Docker container <a href="https://github.com/pires/docker-elasticsearch">docker-elasticsearch</a>, a &ldquo;Ready to use, lean and highly configurable Elasticsearch container image.&rdquo; by <a href="https://github.com/pires">pires</a> is sufficient for use in this guide. However, the <a href="https://github.com/txn2/k8s-es">txn2/k8s-es</a> wraps it with a few minor preset environment variables to simplify configuration. I use the docker image <a href="https://hub.docker.com/r/txn2/k8s-es/tags/">txn2/k8s-es:v6.2.3</a> in the examples below.</p>

<p>The Github repository <a href="https://github.com/pires/kubernetes-elasticsearch-cluster">kubernetes-elasticsearch-cluster</a> contains detailed documentation and configuration for using <a href="https://github.com/pires/docker-elasticsearch">docker-elasticsearch</a> with Kubernetes.</p>

<p>If you need to set up a quick, yet custom production grade cluster, check out my article <a href="/hobby-cluster/">Production Hobby Cluster</a> to get you started.</p>

<aside class="toc">
    <header>
        <h2>Contents</h2>
    </header>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#project-namespace">Project <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Namespace</a></a></li>
<li><a href="#rbac-for-access-and-security"><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a> for Access and Security</a></li>
<li><a href="#services-for-communication"><a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> for Communication</a></li>
<li><a href="#statefulset-for-data-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#data-node">Data</a> nodes</a></li>
<li><a href="#deployment-for-master-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#master-node">Master</a> Nodes</a></li>
<li><a href="#deployment-for-client-and-ingest-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> for Client and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">Ingest</a> Nodes</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#next">Next</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
</aside>

<h3 id="project-namespace">Project <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Namespace</a></h3>

<p>In the examples below I&rsquo;ll use the namespace <strong>the-project</strong> for all the configurations. The file names are suggestions and may be adjusted to your standards.</p>

<p><code>00-namespace.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Namespace
metadata:
  name: the-project
  labels:
    env: dev
</code></pre>

<p>Create the namespace:</p>

<pre><code class="language-bash">kubectl create -f 00-namespace.yml
</code></pre>

<h3 id="rbac-for-access-and-security"><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a> for Access and Security</h3>

<p>Your Kubernetes cluster should be set up to use <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a>. If you are just getting started, you may want to set up a <a href="/hobby-cluster/#permissions-rbac-role-based-access-control">permissive RBAC</a> implementation for your development cluster.</p>

<p>This <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a> step is optional and only intended as a suggestion for tighter security. If you have <a href="/hobby-cluster/#permissions-rbac-role-based-access-control">permissive RBAC</a> there is no need to create this configuration now, as the following steps do not require it.</p>

<p>Creating a <a href="/team-kubernetes-remote-access/#serviceaccount">ServiceAccount</a> called <code>sa-elasticsearch</code> for Elasticsearch in <code>the-project</code> namespace.</p>

<pre><code class="language-bash">kubectl create serviceaccount sa-elasticsearch -n the-project
</code></pre>

<p>Next, create a <a href="/team-kubernetes-remote-access/#role-and-rolebinding">Role and RoleBinding</a> for the new <code>sa-elasticsearch</code> <a href="/team-kubernetes-remote-access/#serviceaccount">ServiceAccount</a>, it makes sense to group tease in the same configuration file.</p>

<p><code>10-rbac.yml</code></p>

<pre><code class="language-yaml">---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: elasticsearch
  namespace: the-project
  labels:
    env: dev
rules:
- apiGroups:
  - &quot;&quot;
  resources:
  - endpoints
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: elasticsearch
  namespace: the-project
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: elasticsearch
subjects:
- kind: ServiceAccount
  name: sa-elasticsearch
  namespace: the-project
</code></pre>

<p>Create the <a href="/team-kubernetes-remote-access/#role-and-rolebinding">Role and RoleBinding</a>:</p>

<pre><code class="language-bash">kubectl create -f 10-rbac.yml
</code></pre>

<h3 id="services-for-communication"><a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> for Communication</h3>

<p>You need  Kubernetes <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> for each of the Elasticsearch node types, Master, Data and Ingest. <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> are a persistent communication bridge to a <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a>. Because Services use <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">selectors</a> to find the appropriate <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a>, they are up first. <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> are accustomed to Pods coming and going, and route to them when they are available, this happens once we add Deployments further down.</p>

<p>Combine all three Services in the same configuration file to keep things simple.</p>

<p><code>20-services.yml</code>:</p>

<pre><code class="language-yaml">---
apiVersion: v1
kind: Service
metadata:
  namespace: the-project 
  name: elasticsearch
  labels:
    env: dev
spec:
  type: ClusterIP
  selector:
    app: elasticsearch-client
  ports:
  - name: http
    port: 9200
    protocol: TCP
---
apiVersion: v1
kind: Service
metadata:
  namespace: the-project 
  name: elasticsearch-data
  labels:
    env: dev
spec:
  clusterIP: None
  selector:
    app: elasticsearch-data
  ports:
  - port: 9300
    name: transport
---
apiVersion: v1
kind: Service
metadata:
  namespace: the-project 
  name: elasticsearch-discovery
  labels:
    env: dev
spec:
  selector:
    app: elasticsearch-master
  ports:
  - name: transport
    port: 9300
    protocol: TCP
</code></pre>

<h3 id="statefulset-for-data-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#data-node">Data</a> nodes</h3>

<p>Next, we configure a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> to manage our Elasticsearch <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#data-node">Data</a></strong> nodes (<a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pods</a>). A <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> &ldquo;manages the deployment and scaling of a set of Pods, and provides guarantees about the ordering and uniqueness of these Pods.&rdquo;</p>

<p>Since a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> creates <a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">ReplicaSets</a> and not <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a>, we need to create a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> directly for the Elasticsearch <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#data-node">data</a></strong> nodes. The <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#master-node">Master</a></strong> and <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">Ingest</a></strong> nodes use <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a>s which automatically generate <a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">ReplicaSets</a> for them.</p>

<p><code>30-statefulset-data.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: elasticsearch-data
  namespace: the-project
  labels:
    app: elasticsearch-data
    env: dev
spec:
  serviceName: elasticsearch-data
  replicas: 1 # scale when desired
  selector:
    matchLabels:
      app: elasticsearch-data
  template:
    metadata:
      labels:
        app: elasticsearch-data
    spec:
      initContainers:
      - name: init-sysctl
        image: busybox:1.27.2
        command:
        - sysctl
        - -w
        - vm.max_map_count=262144
        securityContext:
          privileged: true
      containers:
      - name: elasticsearch-data
        image: txn2/k8s-es:v6.2.3
        imagePullPolicy: Always
        env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: DISCOVERY_SERVICE
          value: elasticsearch-discovery
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: CLUSTER_NAME
          value: elasticsearch
        - name: NODE_DATA
          value: &quot;true&quot;
        - name: NODE_MASTER
          value: &quot;false&quot;
        - name: NODE_INGEST
          value: &quot;false&quot;
        - name: HTTP_ENABLE
          value: &quot;false&quot;
        - name: ES_JAVA_OPTS
          value: -Xms256m -Xmx256m
        - name: PROCESSORS
          valueFrom:
            resourceFieldRef:
              resource: limits.cpu
        resources:
          limits:
            cpu: 1
        ports:
        - containerPort: 9300
          name: transport
        volumeMounts:
        - name: elasticsearch-data-storage
          mountPath: /data
  volumeClaimTemplates:
  - metadata:
      name: elasticsearch-data-storage
    spec:
      storageClassName: rook-block
      accessModes: [ ReadWriteOnce ]
      resources:
        requests:
          storage: 2Gi # small for dev / testing
</code></pre>

<h3 id="deployment-for-master-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#master-node">Master</a> Nodes</h3>

<p>The <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-node.html#master-node">Master</a></strong> Elasticsearch nodes are &ldquo;responsible for lightweight cluster-wide actions such as creating or deleting an index, tracking which nodes are part of the cluster, and deciding which shards to allocate to which nodes. It is important for cluster health to have a stable master node.&rdquo;</p>

<p><code>40-deployment-master.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: elasticsearch-master
  namespace: the-project
  labels:
    app: elasticsearch-master
    env: dev
spec:
  replicas: 2 # scale as desired (see NUMBER_OF_MASTERS below)
  selector:
    matchLabels:
      app: elasticsearch-master
  template:
    metadata:
      labels:
        app: elasticsearch-master
        env: dev
    spec:
      initContainers:
      - name: init-sysctl
        image: busybox:1.27.2
        command:
        - sysctl
        - -w
        - vm.max_map_count=262144
        securityContext:
          privileged: true
      containers:
      - name: elasticsearch-master
        image: txn2/k8s-es:v6.2.3
        imagePullPolicy: Always
        env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: DISCOVERY_SERVICE
          value: elasticsearch-discovery
        - name: CLUSTER_NAME
          value: elasticsearch
        - name: NUMBER_OF_MASTERS
          value: &quot;2&quot;
        - name: NODE_MASTER
          value: &quot;true&quot;
        - name: NODE_INGEST
          value: &quot;false&quot;
        - name: NODE_DATA
          value: &quot;false&quot;
        - name: HTTP_ENABLE
          value: &quot;false&quot;
        - name: ES_JAVA_OPTS
          value: -Xms256m -Xmx256m
        - name: PROCESSORS
          valueFrom:
            resourceFieldRef:
              resource: limits.cpu
        resources:
          limits:
            cpu: 1
        ports:
        - containerPort: 9300
          name: transport
        volumeMounts:
        - name: storage
          mountPath: /data
      volumes:
      - emptyDir:
          medium: &quot;&quot;
        name: &quot;storage&quot;
</code></pre>

<h3 id="deployment-for-client-and-ingest-nodes"><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> for Client and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">Ingest</a> Nodes</h3>

<p>For the sake of simplicity, we use our <strong>client</strong> nodes for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">ingest</a> and queries. These can easily be separated out once you have determined your load model. Separate <strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">Ingest</a></strong> nodes allow you to &ldquo;pre-process documents before the actual document indexing happens. The ingest node intercepts bulk and index requests, it applies transformations, and it then passes the documents back to the index or bulk APIs.&rdquo; By default, Elasticsearch nodes allow <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/ingest.html">ingest</a>, so clients remain in this default mode.</p>

<p><code>60-deployment-client.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: elasticsearch-client
  namespace: the-project
  labels:
    app: elasticsearch-client
    env: dev
spec:
  replicas: 1 # scale as desired
  selector:
    matchLabels:
      app: elasticsearch-client
  template:
    metadata:
      labels:
        app: elasticsearch-client
        env: dev
    spec:
      initContainers:
      - name: init-sysctl
        image: busybox:1.27.2
        command:
        - sysctl
        - -w
        - vm.max_map_count=262144
        securityContext:
          privileged: true
      containers:
      - name: elasticsearch-client
        image: txn2/k8s-es:v6.2.3
        imagePullPolicy: Always
        env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: DISCOVERY_SERVICE
          value: elasticsearch-discovery
        - name: CLUSTER_NAME
          value: elasticsearch
        - name: NODE_MASTER
          value: &quot;false&quot;
        - name: NETWORK_HOST
          value: &quot;0.0.0.0&quot;
        - name: NODE_INGEST
          value: &quot;true&quot;
        - name: NODE_DATA
          value: &quot;false&quot;
        - name: HTTP_ENABLE
          value: &quot;true&quot;
        - name: ES_JAVA_OPTS
          value: -Xms256m -Xmx256m
        - name: PROCESSORS
          valueFrom:
            resourceFieldRef:
              resource: limits.cpu
        resources:
          limits:
            cpu: 1
        ports:
        - containerPort: 9200
          name: http
        - containerPort: 9300
          name: transport
        volumeMounts:
        - name: storage
          mountPath: /data
      volumes:
      - emptyDir:
          medium: &quot;&quot;
        name: &quot;storage&quot;
</code></pre>

<h3 id="testing">Testing</h3>

<p>Use <code>kubectl exec</code> to open a terminal into a Pod in <code>the-project</code> namespace and use <code>curl</code> to test the new Elasticsearch cluster.</p>

<pre><code class="language-bash">kubectl exec -it SOME_POD sh -n the-project 
</code></pre>

<p>Retrieve Elasticsearch cluster stats:</p>

<pre><code class="language-bash">curl -X GET &quot;elasticsearch:9200/_cluster/stats?human&amp;pretty&quot;
</code></pre>

<p>Example output:</p>

<pre><code class="language-json">{
  &quot;_nodes&quot; : {
    &quot;total&quot; : 4,
    &quot;successful&quot; : 4,
    &quot;failed&quot; : 0
  },
  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,
  &quot;timestamp&quot; : 1531724609367,
  &quot;status&quot; : &quot;green&quot;,
  &quot;indices&quot; : {
    &quot;count&quot; : 0,
    &quot;shards&quot; : { },
    &quot;docs&quot; : {
      &quot;count&quot; : 0,
      &quot;deleted&quot; : 0
    },
    &quot;store&quot; : {
      &quot;size&quot; : &quot;0b&quot;,
      &quot;size_in_bytes&quot; : 0
    },
    &quot;fielddata&quot; : {
      &quot;memory_size&quot; : &quot;0b&quot;,
      &quot;memory_size_in_bytes&quot; : 0,
      &quot;evictions&quot; : 0
    },
    &quot;query_cache&quot; : {
      &quot;memory_size&quot; : &quot;0b&quot;,
      &quot;memory_size_in_bytes&quot; : 0,
      &quot;total_count&quot; : 0,
      &quot;hit_count&quot; : 0,
      &quot;miss_count&quot; : 0,
      &quot;cache_size&quot; : 0,
      &quot;cache_count&quot; : 0,
      &quot;evictions&quot; : 0
    },
    &quot;completion&quot; : {
      &quot;size&quot; : &quot;0b&quot;,
      &quot;size_in_bytes&quot; : 0
    },
    &quot;segments&quot; : {
      &quot;count&quot; : 0,
      &quot;memory&quot; : &quot;0b&quot;,
      &quot;memory_in_bytes&quot; : 0,
      &quot;terms_memory&quot; : &quot;0b&quot;,
      &quot;terms_memory_in_bytes&quot; : 0,
      &quot;stored_fields_memory&quot; : &quot;0b&quot;,
      &quot;stored_fields_memory_in_bytes&quot; : 0,
      &quot;term_vectors_memory&quot; : &quot;0b&quot;,
      &quot;term_vectors_memory_in_bytes&quot; : 0,
      &quot;norms_memory&quot; : &quot;0b&quot;,
      &quot;norms_memory_in_bytes&quot; : 0,
      &quot;points_memory&quot; : &quot;0b&quot;,
      &quot;points_memory_in_bytes&quot; : 0,
      &quot;doc_values_memory&quot; : &quot;0b&quot;,
      &quot;doc_values_memory_in_bytes&quot; : 0,
      &quot;index_writer_memory&quot; : &quot;0b&quot;,
      &quot;index_writer_memory_in_bytes&quot; : 0,
      &quot;version_map_memory&quot; : &quot;0b&quot;,
      &quot;version_map_memory_in_bytes&quot; : 0,
      &quot;fixed_bit_set&quot; : &quot;0b&quot;,
      &quot;fixed_bit_set_memory_in_bytes&quot; : 0,
      &quot;max_unsafe_auto_id_timestamp&quot; : -9223372036854775808,
      &quot;file_sizes&quot; : { }
    }
  },
  &quot;nodes&quot; : {
    &quot;count&quot; : {
      &quot;total&quot; : 4,
      &quot;data&quot; : 1,
      &quot;coordinating_only&quot; : 0,
      &quot;master&quot; : 2,
      &quot;ingest&quot; : 1
    },
    &quot;versions&quot; : [
      &quot;6.2.3&quot;
    ],
    &quot;os&quot; : {
      &quot;available_processors&quot; : 22,
      &quot;allocated_processors&quot; : 4,
      &quot;names&quot; : [
        {
          &quot;name&quot; : &quot;Linux&quot;,
          &quot;count&quot; : 4
        }
      ],
      &quot;mem&quot; : {
        &quot;total&quot; : &quot;37.1gb&quot;,
        &quot;total_in_bytes&quot; : 39837057024,
        &quot;free&quot; : &quot;8.4gb&quot;,
        &quot;free_in_bytes&quot; : 9092431872,
        &quot;used&quot; : &quot;28.6gb&quot;,
        &quot;used_in_bytes&quot; : 30744625152,
        &quot;free_percent&quot; : 23,
        &quot;used_percent&quot; : 77
      }
    },
    &quot;process&quot; : {
      &quot;cpu&quot; : {
        &quot;percent&quot; : 0
      },
      &quot;open_file_descriptors&quot; : {
        &quot;min&quot; : 173,
        &quot;max&quot; : 179,
        &quot;avg&quot; : 175
      }
    },
    &quot;jvm&quot; : {
      &quot;max_uptime&quot; : &quot;1.7h&quot;,
      &quot;max_uptime_in_millis&quot; : 6414192,
      &quot;versions&quot; : [
        {
          &quot;version&quot; : &quot;1.8.0_151&quot;,
          &quot;vm_name&quot; : &quot;OpenJDK 64-Bit Server VM&quot;,
          &quot;vm_version&quot; : &quot;25.151-b12&quot;,
          &quot;vm_vendor&quot; : &quot;Oracle Corporation&quot;,
          &quot;count&quot; : 4
        }
      ],
      &quot;mem&quot; : {
        &quot;heap_used&quot; : &quot;418.3mb&quot;,
        &quot;heap_used_in_bytes&quot; : 438676024,
        &quot;heap_max&quot; : &quot;990mb&quot;,
        &quot;heap_max_in_bytes&quot; : 1038090240
      },
      &quot;threads&quot; : 79
    },
    &quot;fs&quot; : {
      &quot;total&quot; : &quot;533gb&quot;,
      &quot;total_in_bytes&quot; : 572367089664,
      &quot;free&quot; : &quot;498.7gb&quot;,
      &quot;free_in_bytes&quot; : 535527632896,
      &quot;available&quot; : &quot;471.5gb&quot;,
      &quot;available_in_bytes&quot; : 506362122240
    },
    &quot;plugins&quot; : [ ],
    &quot;network_types&quot; : {
      &quot;transport_types&quot; : {
        &quot;netty4&quot; : 4
      },
      &quot;http_types&quot; : {
        &quot;netty4&quot; : 4
      }
    }
  }
}
</code></pre>

<h3 id="next">Next</h3>

<ul>
<li>Setup <a href="/kibana-kubernetes/">Kibana on Kubernetes</a> for data exploration and visualization.</li>
<li>Process <a href="/post-json-elasticsearch-kubernetes/">High Traffic JSON Data into Elasticsearch on Kubernetes</a>.</li>
</ul>


                
                <hr>
                <h5>SHARE</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_share_toolbox"></div></li>
                </ul>

                <h5>FOLLOW</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_follow_toolbox"></div></li>
                </ul>

            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/data" title="Data">
                        Data
                        </a>
                        
                        
                        
                        <a href="/tags/data-science" title="Data Science">
                        Data Science
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/devops" title="DevOps">
                        DevOps
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/docker" title="Docker">
                        Docker
                        </a>
                        
                        
                        
                        <a href="/tags/elasticsearch" title="Elasticsearch">
                        Elasticsearch
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/golang" title="Golang">
                        Golang
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/ingress" title="Ingress">
                        Ingress
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kubernetes" title="Kubernetes">
                        Kubernetes
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/microservices" title="Microservices">
                        Microservices
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/python" title="Python">
                        Python
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/security" title="Security">
                        Security
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/utils" title="Utils">
                        Utils
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kubectl" title="kubectl">
                        kubectl
                        </a>
                        
                        
                        
                        
                        
                        
                    </div>
                </section>

                
                <hr>
                <h5>RELATED</h5>
                <ul class="list-inline">
                    
                </ul>
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="IMTI" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:cjimti@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a href="https://twitter.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/cjimti/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                </ul>
		<p class="copyright text-muted">
            Copyright &copy; <a href="https://www.linkedin.com/in/cjimti/">Craig Johnston</a> , 2018
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b905a667cf4d77c"></script>



    
        
        
    





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-78786435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
