<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta name="msvalidate.01" content="DBC34551F2DD1BA3DC0D62EE46D7448F" />
    <meta name="google-site-verification" content="DrtKc88u9uc7iptd4LyURAKBmFcOn7Kuk6HcRk_kNmo" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Getting started with Elasticsearch">
    
    <meta name="keyword"  content="Go, Kubernetes, Elasticsearch, Python, Docker, Big Data, Artificial Intelligence, Machine Learning, Blockchain">
    <link rel="shortcut icon" href="https://imti.co/img/favicon.ico">

    <title>Elasticsearch Essential Queries - IMTI - Craig Johnston</title>

    <link rel="canonical" href="https://imti.co/elasticsearch-essential-queries/">
	
    
    <link rel="stylesheet" href="https://imti.co/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://imti.co/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="https://imti.co/css/syntax.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <link rel="stylesheet" href="/css/imti.css">

    
    <script src="https://imti.co/js/jquery.min.js"></script>
    
    
    <script src="https://imti.co/js/bootstrap.min.js"></script>
    
    
    <script src="https://imti.co/js/hux-blog.min.js"></script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-5984764595236029",
            enable_page_level_ads: true
        });
    </script>

    <meta name="twitter:site" content="@cjimti">
<meta name="twitter:creator" content="@cjimti">

<meta name="twitter:description" content="Getting started with Elasticsearch" />
<meta name="twitter:title" content="Elasticsearch Essential Queries" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://imti.co/img/post/net_876_438.jpg" />
<meta property="og:image" content="https://imti.co/img/post/net_876_438.jpg" />



    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/imti.co\/elasticsearch-essential-queries\/"
  },
  "headline": "Elasticsearch Essential Queries",
  "image": [
    "https:\/\/imti.co\/img\/post\/net_876_438.jpg"
   ],
  "datePublished": "2018-07-26T00:00:00",
  "dateModified": "2018-07-26T00:00:00",
  "author": {
    "@type": "Person",
    "name": "Craig Johnston"
  },
   "publisher": {
    "@type": "Organization",
    "name": 'imti.co",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/imti.co\/img\/craig_johnston_cjimti.jpg"
    }
  },
  "description": "The following is an overview for querying Elasticsearch. Over the years I have tried to assemble developer notes for myself and my team on a variety of platforms, languages and frameworks, a type of cheat-sheet but with context, not a comprehensive how-to, but a decent 15-minute overview of the features we are most likely to implement in a given iteration.\nExplore the Elasticsearch official documentation: Search in Depth.\n Contents   Motivation Following Along with Elasticsearch and Kubernetes Vocabulary Basic CRUD API  Delete an Index Create an Index Create or Update a Document (Upsert) Get a Document   Mappings, Types and Metadata  Get Mapping Create a Mapping   Searching Range Filtering Aggregations  Counts Averages, Minimums and Maximums Percentile Percent by Rank Percent by Rank Interval   Resources     Support this blog!"
}
</script>

</head></head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://imti.co/">IMTI</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://imti.co/">Home</a>
                    </li>
                    <li>
                        <a href="https://imti.co/about/">About</a>
                    </li>
                    <li>
                        <a href="https://twitter.com/cjimti">Follow</a>
                    </li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header{
        background-image: url('https://imti.co/img/post/net.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/elasticsearch" title="Elasticsearch">
                        Elasticsearch
                        </a>
                        
                        <a class="tag" href="/tags/data" title="Data">
                        Data
                        </a>
                        
                    </div>
                    <h1>Elasticsearch Essential Queries</h1>
                    <h2 class="subheading">Getting started with Elasticsearch</h2>
                    <span  class="meta">Posted by <a href="https://twitter.com/cjimti">Craig Johnston</a> on Thursday, July 26, 2018
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>The following is an overview for querying <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a>. Over the years I have tried to assemble developer notes for myself and my team on a variety of platforms, languages and frameworks, a type of cheat-sheet but with context, not a comprehensive how-to, but a decent 15-minute overview of the features we are most likely to implement in a given iteration.</p>
<p>Explore the <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/search-in-depth.html">Elasticsearch official documentation</a>: <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/search-in-depth.html">Search in Depth</a>.</p>
<aside class="toc">
    <header>
        <h2>Contents</h2>
    </header>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#motivation">Motivation</a></li>
    <li><a href="#following-along-with-elasticsearch-and-kubernetes">Following Along with <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> and <a href="https://kubernetes.io/">Kubernetes</a></a></li>
    <li><a href="#vocabulary">Vocabulary</a></li>
    <li><a href="#basic-crud-api">Basic CRUD API</a>
      <ul>
        <li><a href="#delete-an-index">Delete an Index</a></li>
        <li><a href="#create-an-index">Create an Index</a></li>
        <li><a href="#create-or-update-a-document-upsert">Create or Update a Document (Upsert)</a></li>
        <li><a href="#get-a-document">Get a Document</a></li>
      </ul>
    </li>
    <li><a href="#mappings-types-and-metadata">Mappings, Types and Metadata</a>
      <ul>
        <li><a href="#get-mapping">Get Mapping</a></li>
        <li><a href="#create-a-mapping">Create a Mapping</a></li>
      </ul>
    </li>
    <li><a href="#searching">Searching</a></li>
    <li><a href="#range">Range</a></li>
    <li><a href="#filtering">Filtering</a></li>
    <li><a href="#aggregations">Aggregations</a>
      <ul>
        <li><a href="#counts">Counts</a></li>
        <li><a href="#averages-minimums-and-maximums">Averages, Minimums and Maximums</a></li>
        <li><a href="#percentile">Percentile</a></li>
        <li><a href="#percent-by-rank">Percent by Rank</a></li>
        <li><a href="#percent-by-rank-interval">Percent by Rank Interval</a></li>
      </ul>
    </li>
    <li><a href="#resources">Resources</a></li>
  </ul>
</nav>
</aside>
<div class="ad-div">
    <a href="https://amzn.to/3hAZUvx">
        <img src="/img/kubernetes_platform_development.jpg" style="padding:0; margin: 0; width: 50%; float: left"/>
    </a>

    <div style="padding-left: 15px; overflow:auto;">
        <a href="https://amzn.to/3hAZUvx">Support this blog! Buy my new book:
            <h4>Advanced Platform Development with Kubernetes</h4>
        </a>
        <h5>What You'll Learn</h5>
        <ul style="padding-bottom: 0; margin: 0">
            <li>Build data pipelines with <b>MQTT, NiFi, Logstash, MinIO, Hive, Presto, Kafka and Elasticsearch</b></li>
            <li>Leverage <b>Serverless</b> ETL with <b>OpenFaaS</b></li>
            <li>Explore <b>Blockchain</b> networking with <b>Ethereum</b></li>
            <li>Support a multi-tenant <b>Data Science</b> platform with <b>JupyterHub, MLflow and Seldon Core</b></li>
            <li>Build a <b>Multi-cloud</b>, <b>Hybrid cluster</b>, securely bridging <b>on-premise</b> and cloud-based Kubernetes nodes</li>
        </ul>
    </div>
</div>

<h2 id="motivation">Motivation</h2>
<p>My team and I work with a lot of SQL-based data, from MySQL, SQLite and even our large Cassandra cluster, however, our reporting systems are built on <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a>. Transitioning our thinking from SQL to the <a href="https://blog.parse.ly/post/1691/lucene/">Lucene</a> syntax on occasion requires hitting the docs. However, most technical documentation is either for getting started or gives you every variation of every feature, which is great when you are neck deep and need a specific problem solved.</p>
<h2 id="following-along-with-elasticsearch-and-kubernetes">Following Along with <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> and <a href="https://kubernetes.io/">Kubernetes</a></h2>
<p>Many of the examples I use in the range and filtering examples below are a result of setting up a reference implementation for supporting the ingestion of <a href="/post-json-elasticsearch-kubernetes/">High Traffic JSON Data into Elasticsearch on Kubernetes</a>. If you followed that guide, you could run against a similar set of data.</p>
<p>If you want to set up a production-grade Kubernetes and Elastic cluster, I recommend checking out my <a href="/hobby-cluster/">Production Hobby Cluster</a> guide, followed by <a href="/team-kubernetes-remote-access/">Kubernetes Team Access, RBAC for developers and QA</a>, <a href="/kubernetes-production-elasticsearch/">Production Grade Elasticsearch on Kubernetes</a>, <a href="/kibana-kubernetes/">Kibana on Kubernetes</a> and finally <a href="/post-json-elasticsearch-kubernetes/">High Traffic JSON Data into Elasticsearch on Kubernetes</a>.</p>
<p>In a few hours, you can have a highly-available, horizontally scalable, big data solution, ready for enterprise style experiments, and with some domain-aware tuning, a full production system.</p>
<p>Below, I access the Elasticsearch API through my local port 9200. You can <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html">install Elasticsearch</a> directly on your workstation, or <a href="https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/">port-forward services from a Kubernetes cluster</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl port-forward svc/elasticsearch 9200:9200 -n the-project
</code></pre></div><h2 id="vocabulary">Vocabulary</h2>
<p>Elasticsearch inherits the <a href="https://blog.parse.ly/post/1691/lucene/">Lucene</a> vocabulary, and so it&rsquo;s best not to think of namespaces, tables, rows, and columns. Elasticsearch is built around <strong>indexes</strong>, that index a collection of <strong>documents</strong> grouped by <strong>type</strong>. Documents have <strong>fields</strong> which point to values and have an assigned data type. Elasticsearch indexes also contain <strong>inverted indexes</strong>, mapping field values to document ids.</p>
<ul>
<li>An <strong>index</strong> is a collection of <strong>documents</strong>.</li>
<li>A <strong>document</strong> is a record in an <strong>index</strong>.</li>
<li>A <strong>field</strong>s are <strong>typed</strong> elements of a document.</li>
<li><strong>Term</strong>s are the values from the <strong>index</strong> documents use as keys for an <strong>inverted index</strong>.</li>
<li>An <strong>inverted index</strong> maps <strong>terms</strong> to <strong>document</strong> ids.</li>
</ul>
<p>With <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> it is common to split indexes by date for time-series data. Indexes with names like <code>payments-20180801</code>, <code>payments-20180802</code>, <code>payments-20180803</code> can be queried together with a wildcard, for instance, queries needing to search all payments for August may reference the index <code>payments-201808-*</code>.</p>
<h2 id="basic-crud-api">Basic CRUD API</h2>
<p>Elasticsearch implements a <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a> API with the <a href="https://www.restapitutorial.com/lessons/httpmethods.html">HTTP verbs</a> <strong>GET</strong> for read operations, <strong>PUT</strong> for update or replace, and <strong>DELETE</strong> to remove a document.</p>
<p><img src="/images/content/elastic-query.png" alt=""></p>
<h3 id="delete-an-index">Delete an Index</h3>
<p>Delete an index named <code>example</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X DELETE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  http://localhost:9200/example
</code></pre></div><p>If the index existed we get back:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;acknowledged&#34;</span>: <span style="color:#66d9ef">true</span>
}
</code></pre></div><p>If the index did not exist we would get:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;error&#34;</span>: {
        <span style="color:#f92672">&#34;root_cause&#34;</span>: [
            {
                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;index_not_found_exception&#34;</span>,
                <span style="color:#f92672">&#34;reason&#34;</span>: <span style="color:#e6db74">&#34;no such index&#34;</span>,
                <span style="color:#f92672">&#34;index_uuid&#34;</span>: <span style="color:#e6db74">&#34;_na_&#34;</span>,
                <span style="color:#f92672">&#34;resource.type&#34;</span>: <span style="color:#e6db74">&#34;index_or_alias&#34;</span>,
                <span style="color:#f92672">&#34;resource.id&#34;</span>: <span style="color:#e6db74">&#34;example&#34;</span>,
                <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#e6db74">&#34;example&#34;</span>
            }
        ],
        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;index_not_found_exception&#34;</span>,
        <span style="color:#f92672">&#34;reason&#34;</span>: <span style="color:#e6db74">&#34;no such index&#34;</span>,
        <span style="color:#f92672">&#34;index_uuid&#34;</span>: <span style="color:#e6db74">&#34;_na_&#34;</span>,
        <span style="color:#f92672">&#34;resource.type&#34;</span>: <span style="color:#e6db74">&#34;index_or_alias&#34;</span>,
        <span style="color:#f92672">&#34;resource.id&#34;</span>: <span style="color:#e6db74">&#34;example&#34;</span>,
        <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#e6db74">&#34;example&#34;</span>
    },
    <span style="color:#f92672">&#34;status&#34;</span>: <span style="color:#ae81ff">404</span>
}
</code></pre></div><p>Keep in mind that although there is no consequence in issuing a <strong>DELETE</strong> for something that does not exist, Elasticsearch returns a <strong>&ldquo;status&rdquo;: 404</strong>.</p>
<h3 id="create-an-index">Create an Index</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X PUT <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  http://localhost:9200/example
</code></pre></div><h3 id="create-or-update-a-document-upsert">Create or Update a Document (Upsert)</h3>
<p>A PUT command creates or overwrites a document if given an existing document id.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X PUT <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  http://localhost:9200/example/test/123 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{
</span><span style="color:#e6db74">    &#34;testId&#34;: &#34;123&#34;,
</span><span style="color:#e6db74">    &#34;description&#34;: &#34;This is a test&#34;
</span><span style="color:#e6db74">}&#39;</span>
</code></pre></div><h3 id="get-a-document">Get a Document</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X GET <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  http://localhost:9200/example/test/123
</code></pre></div><p>Returns:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;_index&#34;</span>: <span style="color:#e6db74">&#34;example&#34;</span>,
    <span style="color:#f92672">&#34;_type&#34;</span>: <span style="color:#e6db74">&#34;test&#34;</span>,
    <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;123&#34;</span>,
    <span style="color:#f92672">&#34;_version&#34;</span>: <span style="color:#ae81ff">3</span>,
    <span style="color:#f92672">&#34;found&#34;</span>: <span style="color:#66d9ef">true</span>,
    <span style="color:#f92672">&#34;_source&#34;</span>: {
        <span style="color:#f92672">&#34;testId&#34;</span>: <span style="color:#e6db74">&#34;123&#34;</span>,
        <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;This is a test&#34;</span>
    }
}
</code></pre></div><p>The <strong>_source</strong> sections stores the fields associated with a document.</p>
<h2 id="mappings-types-and-metadata">Mappings, Types and Metadata</h2>
<p>For more advanced searching filtering you need to know the types of values stored for a document along with the various index mappings.</p>
<h3 id="get-mapping">Get Mapping</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X GET <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  http://localhost:9200/example/_mapping
</code></pre></div><p>In this simple <strong>example</strong> index both <strong>testId</strong> and <strong>description</strong> are of <strong>&ldquo;type&rdquo;: &ldquo;text&rdquo;</strong>. Elasticsearch is indexing the first 256 characters of both fields as a keyword.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;example&#34;</span>: {
        <span style="color:#f92672">&#34;mappings&#34;</span>: {
            <span style="color:#f92672">&#34;test&#34;</span>: {
                <span style="color:#f92672">&#34;properties&#34;</span>: {
                    <span style="color:#f92672">&#34;description&#34;</span>: {
                        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;text&#34;</span>,
                        <span style="color:#f92672">&#34;fields&#34;</span>: {
                            <span style="color:#f92672">&#34;keyword&#34;</span>: {
                                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;keyword&#34;</span>,
                                <span style="color:#f92672">&#34;ignore_above&#34;</span>: <span style="color:#ae81ff">256</span>
                            }
                        }
                    },
                    <span style="color:#f92672">&#34;testId&#34;</span>: {
                        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;text&#34;</span>,
                        <span style="color:#f92672">&#34;fields&#34;</span>: {
                            <span style="color:#f92672">&#34;keyword&#34;</span>: {
                                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;keyword&#34;</span>,
                                <span style="color:#f92672">&#34;ignore_above&#34;</span>: <span style="color:#ae81ff">256</span>
                            }
                        }
                    }
                }
            }
        }
    }
}
</code></pre></div><h3 id="create-a-mapping">Create a Mapping</h3>
<p>Create the index <strong>example2</strong> along with a mapping:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X PUT <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  http://localhost:9200/example2 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{
</span><span style="color:#e6db74">  &#34;mappings&#34;: {
</span><span style="color:#e6db74">    &#34;test&#34;: { 
</span><span style="color:#e6db74">      &#34;properties&#34;: { 
</span><span style="color:#e6db74">        &#34;description&#34;: { &#34;type&#34;: &#34;text&#34;  }, 
</span><span style="color:#e6db74">        &#34;TestId&#34;:      { &#34;type&#34;: &#34;integer&#34; }
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">  }
</span><span style="color:#e6db74">}&#39;</span>
</code></pre></div><p>For the complete, see the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.3/mapping-types.html">official documentation on field datatypes for mapping</a>.</p>
<h2 id="searching">Searching</h2>
<p>In the following examples assume the following example JSON snippets are  POSTed to <code>http://localhost:9200/wx-rtbeat-%2A/_search</code>. The <strong>%2A</strong> is a URL encoded * (wildcard) allowing us to query all indexes starting with <strong>wx-rtbeat-</strong>.</p>
<p>Returning all documents with the field <strong>rxtxMsg.payload.currently.summary</strong> mathing the term <strong>&ldquo;Partly Cloudy&rdquo;</strong></p>
<p><code>POST http://localhost:9200/wx-rtbeat-%2A/_search</code></p>
<p>Post body:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;query&#34;</span>: {
    <span style="color:#f92672">&#34;match&#34;</span> : {
      <span style="color:#f92672">&#34;rxtxMsg.payload.currently.summary&#34;</span> : <span style="color:#e6db74">&#34;Partly Cloudy&#34;</span>
    }
  }
}
</code></pre></div><h2 id="range">Range</h2>
<p>Return all documents whose <strong>@timestamp</strong> is greater than or equal to 24 hours ago:</p>
<p><code>POST http://localhost:9200/wx-rtbeat-%2A/_search</code></p>
<p>Post body:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;query&#34;</span>: {
    <span style="color:#f92672">&#34;range&#34;</span> : {
      <span style="color:#f92672">&#34;@timestamp&#34;</span> : {
        <span style="color:#f92672">&#34;gte&#34;</span> : <span style="color:#e6db74">&#34;now-24h&#34;</span>
      }
    }
  }
}
</code></pre></div><p>If you are interested only in the number of matches, you can limit the size of returned documents to <strong>0</strong></p>
<p><code>POST http://localhost:9200/wx-rtbeat-%2A/_search</code></p>
<p>Post body:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;size&#34;</span>:<span style="color:#ae81ff">0</span>,
  <span style="color:#f92672">&#34;query&#34;</span>: {
    <span style="color:#f92672">&#34;range&#34;</span> : {
      <span style="color:#f92672">&#34;@timestamp&#34;</span> : {
        <span style="color:#f92672">&#34;gte&#34;</span> : <span style="color:#e6db74">&#34;now-24h&#34;</span>
      }
    }
  }
}
</code></pre></div><h2 id="filtering">Filtering</h2>
<p>The <strong>bool</strong> operator allows you to return any documents where the sub-conditions are true. In this case, we only implement one condition, a <strong>filter</strong>, however, that filter has an array of conditions.</p>
<p>In addition to the <strong>query</strong> the return fields are limited to those defined in <strong>&quot;_source&rdquo;</strong>.</p>
<p>The following returns all documents in the last 72 hours where the summary is &ldquo;Partly Cloudy&rdquo; and the temperature is greater than or equal to 60 and less than or equal to 71.</p>
<p><code>POST http://localhost:9200/wx-rtbeat-%2A/_search</code></p>
<p>Post body:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;query&#34;</span>: {
    <span style="color:#f92672">&#34;bool&#34;</span>: {
      <span style="color:#f92672">&#34;filter&#34;</span>: [
        { <span style="color:#f92672">&#34;range&#34;</span> : { <span style="color:#f92672">&#34;@timestamp&#34;</span> : { <span style="color:#f92672">&#34;gte&#34;</span> : <span style="color:#e6db74">&#34;now-72h&#34;</span> } } },
        { <span style="color:#f92672">&#34;term&#34;</span>: { <span style="color:#f92672">&#34;rxtxMsg.payload.currently.summary&#34;</span>: <span style="color:#e6db74">&#34;Partly Cloudy&#34;</span> } },
        { <span style="color:#f92672">&#34;range&#34;</span> : { <span style="color:#f92672">&#34;rxtxMsg.payload.currently.temperature&#34;</span> : { <span style="color:#f92672">&#34;gte&#34;</span> : <span style="color:#ae81ff">60</span>, <span style="color:#f92672">&#34;lte&#34;</span> : <span style="color:#ae81ff">71</span> } } }
      ]
    }
  },
  <span style="color:#f92672">&#34;_source&#34;</span>: [
    <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.time&#34;</span>,
    <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.temperature&#34;</span>,
    <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.humidity&#34;</span>,
    <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.pressure&#34;</span>,
    <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.windSpeed&#34;</span>,
    <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.summary&#34;</span>
  ]
}
</code></pre></div><h2 id="aggregations">Aggregations</h2>
<p>Below are examples of basic <strong>counts</strong>, <strong>averages</strong>, <strong>minimums</strong> and <strong>maximums</strong> along with histograms for <strong>percentile</strong> and <strong>percent rank</strong>. See the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html">Official documentation on aggregations</a> for a deeper understanding.</p>
<h3 id="counts">Counts</h3>
<p>Using the <strong>aggs</strong> condition, we can get document counts on all the terms for <strong>summary</strong> with additional filtering on <strong>temperature</strong> being greater-than or equal to 60.</p>
<p>Note that the <strong>&ldquo;size&rdquo;</strong> is set to <strong>0</strong> since we are not interested in returning any documents.</p>
<p><code>POST http://localhost:9200/wx-rtbeat-%2A/_search</code></p>
<p>Post body:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;size&#34;</span>: <span style="color:#ae81ff">0</span>,
  <span style="color:#f92672">&#34;aggs&#34;</span>: {
    <span style="color:#f92672">&#34;types&#34;</span>: {
      <span style="color:#f92672">&#34;terms&#34;</span>: {
        <span style="color:#f92672">&#34;field&#34;</span>: <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.summary&#34;</span>
      }
    }
  },
  <span style="color:#f92672">&#34;query&#34;</span>: {
    <span style="color:#f92672">&#34;bool&#34;</span>: {
      <span style="color:#f92672">&#34;must&#34;</span>: {
        <span style="color:#f92672">&#34;match_all&#34;</span>: {}
      },
      <span style="color:#f92672">&#34;filter&#34;</span>: {
        <span style="color:#f92672">&#34;range&#34;</span>: {
          <span style="color:#f92672">&#34;rxtxMsg.payload.currently.temperature&#34;</span>: {
            <span style="color:#f92672">&#34;gte&#34;</span>: <span style="color:#ae81ff">60</span>
          }
        }
      }
    }
  }
}
</code></pre></div><p>Example Output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;took&#34;</span>: <span style="color:#ae81ff">13</span>,
  <span style="color:#f92672">&#34;timed_out&#34;</span>: <span style="color:#66d9ef">false</span>,
  <span style="color:#f92672">&#34;_shards&#34;</span>: {
    <span style="color:#f92672">&#34;total&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;successful&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;skipped&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;failed&#34;</span>: <span style="color:#ae81ff">0</span>
  },
  <span style="color:#f92672">&#34;hits&#34;</span>: {
    <span style="color:#f92672">&#34;total&#34;</span>: <span style="color:#ae81ff">6632</span>,
    <span style="color:#f92672">&#34;max_score&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;hits&#34;</span>: []
  },
  <span style="color:#f92672">&#34;aggregations&#34;</span>: {
    <span style="color:#f92672">&#34;types&#34;</span>: {
      <span style="color:#f92672">&#34;doc_count_error_upper_bound&#34;</span>: <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;sum_other_doc_count&#34;</span>: <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;buckets&#34;</span>: [
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;Clear&#34;</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">4871</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;Partly Cloudy&#34;</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">1523</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;Mostly Cloudy&#34;</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">238</span>
        }
      ]
    }
  }
}
</code></pre></div><h3 id="averages-minimums-and-maximums">Averages, Minimums and Maximums</h3>
<p>To demonstrate averages, minimums, and maximums, I use a nested <strong>agg</strong> condition.</p>
<p>The following returns a count for each term used in the <strong>summary</strong> field, along with the average, minimum and maximum temperature for that group.</p>
<p><code>POST http://localhost:9200/wx-rtbeat-%2A/_search</code></p>
<p>Post body:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;size&#34;</span>: <span style="color:#ae81ff">0</span>,
  <span style="color:#f92672">&#34;aggs&#34;</span>: {
    <span style="color:#f92672">&#34;types&#34;</span>: {
      <span style="color:#f92672">&#34;terms&#34;</span>: {
        <span style="color:#f92672">&#34;field&#34;</span>: <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.summary&#34;</span>
      },
      <span style="color:#f92672">&#34;aggs&#34;</span>: {
        <span style="color:#f92672">&#34;avg_temp&#34;</span>: {
          <span style="color:#f92672">&#34;avg&#34;</span>: {
            <span style="color:#f92672">&#34;field&#34;</span>: <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.temperature&#34;</span>
          }
        },
        <span style="color:#f92672">&#34;max_temp&#34;</span>: {
          <span style="color:#f92672">&#34;max&#34;</span>: {
            <span style="color:#f92672">&#34;field&#34;</span>: <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.temperature&#34;</span>
          }
        },
        <span style="color:#f92672">&#34;min_temp&#34;</span>: {
          <span style="color:#f92672">&#34;min&#34;</span>: {
            <span style="color:#f92672">&#34;field&#34;</span>: <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.temperature&#34;</span>
          }
        }
      }
    }
  },
  <span style="color:#f92672">&#34;query&#34;</span>: {
    <span style="color:#f92672">&#34;range&#34;</span>: {
      <span style="color:#f92672">&#34;@timestamp&#34;</span>: {
        <span style="color:#f92672">&#34;gte&#34;</span>: <span style="color:#e6db74">&#34;now-24h&#34;</span>
      }
    }
  }
}
</code></pre></div><p>Example output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;took&#34;</span>: <span style="color:#ae81ff">13</span>,
  <span style="color:#f92672">&#34;timed_out&#34;</span>: <span style="color:#66d9ef">false</span>,
  <span style="color:#f92672">&#34;_shards&#34;</span>: {
    <span style="color:#f92672">&#34;total&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;successful&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;skipped&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;failed&#34;</span>: <span style="color:#ae81ff">0</span>
  },
  <span style="color:#f92672">&#34;hits&#34;</span>: {
    <span style="color:#f92672">&#34;total&#34;</span>: <span style="color:#ae81ff">718</span>,
    <span style="color:#f92672">&#34;max_score&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;hits&#34;</span>: []
  },
  <span style="color:#f92672">&#34;aggregations&#34;</span>: {
    <span style="color:#f92672">&#34;types&#34;</span>: {
      <span style="color:#f92672">&#34;doc_count_error_upper_bound&#34;</span>: <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;sum_other_doc_count&#34;</span>: <span style="color:#ae81ff">0</span>,
      <span style="color:#f92672">&#34;buckets&#34;</span>: [
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;Clear&#34;</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">409</span>,
          <span style="color:#f92672">&#34;avg_temp&#34;</span>: {
            <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#ae81ff">81.81280562347189</span>
          },
          <span style="color:#f92672">&#34;min_temp&#34;</span>: {
            <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#ae81ff">71.6875</span>
          },
          <span style="color:#f92672">&#34;max_temp&#34;</span>: {
            <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#ae81ff">88.75</span>
          }
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;Partly Cloudy&#34;</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">192</span>,
          <span style="color:#f92672">&#34;avg_temp&#34;</span>: {
            <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#ae81ff">71.58528645833333</span>
          },
          <span style="color:#f92672">&#34;min_temp&#34;</span>: {
            <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#ae81ff">68.1875</span>
          },
          <span style="color:#f92672">&#34;max_temp&#34;</span>: {
            <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#ae81ff">79.1875</span>
          }
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;Mostly Cloudy&#34;</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">117</span>,
          <span style="color:#f92672">&#34;avg_temp&#34;</span>: {
            <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#ae81ff">69.40331196581197</span>
          },
          <span style="color:#f92672">&#34;min_temp&#34;</span>: {
            <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#ae81ff">68.5</span>
          },
          <span style="color:#f92672">&#34;max_temp&#34;</span>: {
            <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#ae81ff">71</span>
          }
        }
      ]
    }
  }
}
</code></pre></div><h3 id="percentile">Percentile</h3>
<p>Obtaining the temperature field of our data in a series of percentiles requires creating a percentiles aggregator, this is merely wrapping the <strong>&ldquo;percentiles&rdquo;</strong> operator in a custom object. In this case I name the object <strong>&ldquo;pct_temp&rdquo;</strong>, however and name would suffice.</p>
<p><code>POST http://localhost:9200/wx-rtbeat-%2A/_search</code></p>
<p>Post body:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;size&#34;</span>: <span style="color:#ae81ff">0</span>,
  <span style="color:#f92672">&#34;aggs&#34;</span>: {
    <span style="color:#f92672">&#34;pct_temp&#34;</span>: {
      <span style="color:#f92672">&#34;percentiles&#34;</span>: {
        <span style="color:#f92672">&#34;field&#34;</span>: <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.temperature&#34;</span>,
        <span style="color:#f92672">&#34;percents&#34;</span>: [
          <span style="color:#ae81ff">1</span>,
          <span style="color:#ae81ff">5</span>,
          <span style="color:#ae81ff">25</span>,
          <span style="color:#ae81ff">50</span>,
          <span style="color:#ae81ff">75</span>,
          <span style="color:#ae81ff">95</span>,
          <span style="color:#ae81ff">99</span>
        ]
      }
    }
  },
  <span style="color:#f92672">&#34;query&#34;</span>: {
    <span style="color:#f92672">&#34;range&#34;</span>: {
      <span style="color:#f92672">&#34;@timestamp&#34;</span>: {
        <span style="color:#f92672">&#34;gte&#34;</span>: <span style="color:#e6db74">&#34;now-24h&#34;</span>
      }
    }
  }
}
</code></pre></div><p>Example output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;took&#34;</span>: <span style="color:#ae81ff">15</span>,
  <span style="color:#f92672">&#34;timed_out&#34;</span>: <span style="color:#66d9ef">false</span>,
  <span style="color:#f92672">&#34;_shards&#34;</span>: {
    <span style="color:#f92672">&#34;total&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;successful&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;skipped&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;failed&#34;</span>: <span style="color:#ae81ff">0</span>
  },
  <span style="color:#f92672">&#34;hits&#34;</span>: {
    <span style="color:#f92672">&#34;total&#34;</span>: <span style="color:#ae81ff">718</span>,
    <span style="color:#f92672">&#34;max_score&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;hits&#34;</span>: []
  },
  <span style="color:#f92672">&#34;aggregations&#34;</span>: {
    <span style="color:#f92672">&#34;pct_temp&#34;</span>: {
      <span style="color:#f92672">&#34;values&#34;</span>: {
        <span style="color:#f92672">&#34;1.0&#34;</span>: <span style="color:#ae81ff">68.25</span>,
        <span style="color:#f92672">&#34;5.0&#34;</span>: <span style="color:#ae81ff">68.5625</span>,
        <span style="color:#f92672">&#34;25.0&#34;</span>: <span style="color:#ae81ff">69.95982142857143</span>,
        <span style="color:#f92672">&#34;50.0&#34;</span>: <span style="color:#ae81ff">75.80357142857143</span>,
        <span style="color:#f92672">&#34;75.0&#34;</span>: <span style="color:#ae81ff">84.00483630952382</span>,
        <span style="color:#f92672">&#34;95.0&#34;</span>: <span style="color:#ae81ff">87.625</span>,
        <span style="color:#f92672">&#34;99.0&#34;</span>: <span style="color:#ae81ff">88.614375</span>
      }
    }
  }
}
</code></pre></div><h3 id="percent-by-rank">Percent by Rank</h3>
<p>Below, I use <strong>&ldquo;percentile_ranks&rdquo;</strong> to bucket the temperatures into four categories of interest.</p>
<p><code>POST http://localhost:9200/wx-rtbeat-%2A/_search</code></p>
<p>Post body:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;size&#34;</span>: <span style="color:#ae81ff">0</span>,
  <span style="color:#f92672">&#34;aggs&#34;</span>: {
    <span style="color:#f92672">&#34;pct_temp&#34;</span>: {
      <span style="color:#f92672">&#34;percentile_ranks&#34;</span>: {
        <span style="color:#f92672">&#34;field&#34;</span>: <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.temperature&#34;</span>,
        <span style="color:#f92672">&#34;values&#34;</span>: [
          <span style="color:#ae81ff">60</span>,
          <span style="color:#ae81ff">70</span>,
          <span style="color:#ae81ff">75</span>,
          <span style="color:#ae81ff">80</span>
        ],
        <span style="color:#f92672">&#34;hdr&#34;</span>: {
          <span style="color:#f92672">&#34;number_of_significant_value_digits&#34;</span>: <span style="color:#ae81ff">2</span>
        }
      }
    }
  },
  <span style="color:#f92672">&#34;query&#34;</span>: {
    <span style="color:#f92672">&#34;range&#34;</span>: {
      <span style="color:#f92672">&#34;@timestamp&#34;</span>: {
        <span style="color:#f92672">&#34;gte&#34;</span>: <span style="color:#e6db74">&#34;now-24h&#34;</span>
      }
    }
  }
}
</code></pre></div><p>Example output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;took&#34;</span>: <span style="color:#ae81ff">13</span>,
  <span style="color:#f92672">&#34;timed_out&#34;</span>: <span style="color:#66d9ef">false</span>,
  <span style="color:#f92672">&#34;_shards&#34;</span>: {
    <span style="color:#f92672">&#34;total&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;successful&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;skipped&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;failed&#34;</span>: <span style="color:#ae81ff">0</span>
  },
  <span style="color:#f92672">&#34;hits&#34;</span>: {
    <span style="color:#f92672">&#34;total&#34;</span>: <span style="color:#ae81ff">718</span>,
    <span style="color:#f92672">&#34;max_score&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;hits&#34;</span>: []
  },
  <span style="color:#f92672">&#34;aggregations&#34;</span>: {
    <span style="color:#f92672">&#34;pct_temp&#34;</span>: {
      <span style="color:#f92672">&#34;values&#34;</span>: {
        <span style="color:#f92672">&#34;60.0&#34;</span>: <span style="color:#ae81ff">0</span>,
        <span style="color:#f92672">&#34;70.0&#34;</span>: <span style="color:#ae81ff">29.526462395543174</span>,
        <span style="color:#f92672">&#34;75.0&#34;</span>: <span style="color:#ae81ff">49.02506963788301</span>,
        <span style="color:#f92672">&#34;80.0&#34;</span>: <span style="color:#ae81ff">63.50974930362117</span>
      }
    }
  }
}
</code></pre></div><h3 id="percent-by-rank-interval">Percent by Rank Interval</h3>
<p>I use <strong>&ldquo;interval&rdquo;</strong> to automatically generate rank buckets based on the value range. Intervals make building histograms easy when you have dynamic data that should not be scaled.</p>
<p><code>POST http://localhost:9200/wx-rtbeat-%2A/_search</code></p>
<p>Post body:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;size&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;aggs&#34;</span>: {
        <span style="color:#f92672">&#34;temps&#34;</span>: {
            <span style="color:#f92672">&#34;histogram&#34;</span>: {
                <span style="color:#f92672">&#34;field&#34;</span>: <span style="color:#e6db74">&#34;rxtxMsg.payload.currently.temperature&#34;</span>,
                <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">2</span>
            }
        }
    },
    <span style="color:#f92672">&#34;query&#34;</span>: {
        <span style="color:#f92672">&#34;range&#34;</span> : {
            <span style="color:#f92672">&#34;@timestamp&#34;</span> : {
                <span style="color:#f92672">&#34;gte&#34;</span> : <span style="color:#e6db74">&#34;now-24h&#34;</span>
            }
        }
    }
}
</code></pre></div><p>Example output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;took&#34;</span>: <span style="color:#ae81ff">11</span>,
  <span style="color:#f92672">&#34;timed_out&#34;</span>: <span style="color:#66d9ef">false</span>,
  <span style="color:#f92672">&#34;_shards&#34;</span>: {
    <span style="color:#f92672">&#34;total&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;successful&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;skipped&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;failed&#34;</span>: <span style="color:#ae81ff">0</span>
  },
  <span style="color:#f92672">&#34;hits&#34;</span>: {
    <span style="color:#f92672">&#34;total&#34;</span>: <span style="color:#ae81ff">718</span>,
    <span style="color:#f92672">&#34;max_score&#34;</span>: <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;hits&#34;</span>: []
  },
  <span style="color:#f92672">&#34;aggregations&#34;</span>: {
    <span style="color:#f92672">&#34;temps&#34;</span>: {
      <span style="color:#f92672">&#34;buckets&#34;</span>: [
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">68</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">173</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">70</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">77</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">72</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">69</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">74</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">43</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">76</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">31</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">78</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">51</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">80</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">44</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">82</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">48</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">84</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">53</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">86</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">104</span>
        },
        {
          <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#ae81ff">88</span>,
          <span style="color:#f92672">&#34;doc_count&#34;</span>: <span style="color:#ae81ff">25</span>
        }
      ]
    }
  }
}
</code></pre></div><p>The example data is powered by the <a href="https://darksky.net/dev">Dark Sky API</a>. If you are interested in gathering your own weather data, check out my article <a href="/post-json-elasticsearch-kubernetes/">High Traffic JSON Data into Elasticsearch on Kubernetes</a>.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a></li>
<li>How to <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html">install Elasticsearch</a></li>
<li><a href="/kubernetes-production-elasticsearch/">Production Grade Elasticsearch on Kubernetes</a></li>
<li><a href="/post-json-elasticsearch-kubernetes/">High Traffic JSON Data into Elasticsearch on Kubernetes</a></li>
<li>Elasticsearch <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/search-in-depth.html">Search in Depth</a> documentation</li>
<li>Elasticsearch <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.3/mapping-types.html">data types</a> for mapping indexes</li>
<li>Elasticsearch <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html">Aggregations</a></li>
</ul>


                <p>
                   This blog post, titled: "<span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Elasticsearch Essential Queries: Getting started with Elasticsearch</span>" by <a xmlns:cc="http://creativecommons.org/ns#" href="https://twitter.com/cjimti" property="cc:attributionName" rel="cc:attributionURL">Craig Johnston</a>, is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
                </p>

                <h5>SUPPORT</h5>
                <p>
                    Order my new Kubernetes book: <a href="https://amzn.to/34D56v6">Advanced Platform Development with Kubernetes: Enabling Data Management, the Internet of Things, Blockchain, and Machine Learning</a>
                </p>
                <script type="text/javascript">
                  amzn_assoc_tracking_id = "imti-20";
                  amzn_assoc_ad_mode = "manual";
                  amzn_assoc_ad_type = "smart";
                  amzn_assoc_marketplace = "amazon";
                  amzn_assoc_region = "US";
                  amzn_assoc_design = "enhanced_links";
                  amzn_assoc_asins = "1484256107";
                  amzn_assoc_placement = "adunit";
                  amzn_assoc_linkid = "14a9d8b8d1b0bd44e9256e0e0a948015";
                </script>
                <script src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US"></script>

                
                <hr>
                <h5>SHARE</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_share_toolbox"></div></li>
                </ul>

                <h5>FOLLOW</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_follow_toolbox"></div></li>
                </ul>

            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/blockchain" title="blockchain">
                        blockchain
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/data" title="data">
                        data
                        </a>
                        
                        
                        
                        <a href="/tags/data-science" title="data-science">
                        data-science
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/development" title="development">
                        development
                        </a>
                        
                        
                        
                        <a href="/tags/devops" title="devops">
                        devops
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                        docker
                        </a>
                        
                        
                        
                        <a href="/tags/elasticsearch" title="elasticsearch">
                        elasticsearch
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/golang" title="golang">
                        golang
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/ingress" title="ingress">
                        ingress
                        </a>
                        
                        
                        
                        <a href="/tags/iot" title="iot">
                        iot
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kubectl" title="kubectl">
                        kubectl
                        </a>
                        
                        
                        
                        <a href="/tags/kubernetes" title="kubernetes">
                        kubernetes
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/microservices" title="microservices">
                        microservices
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/python" title="python">
                        python
                        </a>
                        
                        
                        
                        <a href="/tags/raspberry-pi" title="raspberry-pi">
                        raspberry-pi
                        </a>
                        
                        
                        
                        <a href="/tags/security" title="security">
                        security
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/utils" title="utils">
                        utils
                        </a>
                        
                        
                        
                        
                        
                        
                    </div>
                </section>

                
                <hr>
                <h5>RELATED</h5>
                <ul class="list-inline">
                    
                </ul>
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="IMTI" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:cjimti@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a href="https://twitter.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/cjimti/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                </ul>

                
                
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b905a667cf4d77c"></script>



    
        
        
    





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-78786435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
