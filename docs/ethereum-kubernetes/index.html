<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta name="google-site-verification" content="DrtKc88u9uc7iptd4LyURAKBmFcOn7Kuk6HcRk_kNmo" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Deploy a Private Ethereum Blockchain on a Custom Kubernetes Cluster.">
    
    <meta name="keyword"  content="Go, Kubernetes, Elasticsearch, Python, Docker, Big Data, Artificial Intelligence, Machine Learning, Blockchain">
    <link rel="shortcut icon" href="https://imti.co/img/favicon.ico">

    <title>Ethereum Blockchain on Kubernetes - IMTI - Craig Johnston</title>

    <link rel="canonical" href="https://imti.co/ethereum-kubernetes/">
	
    
    <link rel="stylesheet" href="https://imti.co/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://imti.co/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="https://imti.co/css/syntax.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <link rel="stylesheet" href="/css/imti.css">

    
    <script src="https://imti.co/js/jquery.min.js"></script>
    
    
    <script src="https://imti.co/js/bootstrap.min.js"></script>
    
    
    <script src="https://imti.co/js/hux-blog.min.js"></script>

    <meta name="twitter:site" content="@cjimti">
<meta name="twitter:creator" content="@cjimti">

<meta name="twitter:description" content="Deploy a Private Ethereum Blockchain on a Custom Kubernetes Cluster." />
<meta name="twitter:title" content="Ethereum Blockchain on Kubernetes" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://imti.co/img/post/kubeeth_876_438.jpg" />
<meta property="og:image" content="https://imti.co/img/post/kubeeth_876_438.jpg" />



    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://imti.co/ethereum-kubernetes/"
  },
  "headline": "Ethereum Blockchain on Kubernetes",
  "image": [
    "https://imti.co/img/post/kubeeth_876_438.jpg"
   ],
  "datePublished": "2018-09-04T00:00:00",
  "dateModified": "2018-09-04T00:00:00",
  "author": {
    "@type": "Person",
    "name": "Craig Johnston"
  },
   "publisher": {
    "@type": "Organization",
    "name": 'imti.co",
    "logo": {
      "@type": "ImageObject",
      "url": "https://imti.co/img/craig_johnston_cjimti.jpg"
    }
  },
  "description": "Blockchain technologies have been made famous by Cryptocurrencies such as Bitcoin and Ethereum. However, the concepts behind Blockchain are fore more reaching than their support for cryptocurrency. Blockchain technologies now support any digital asset, from signal data to complex messaging, to the execution of business logic through code. Blockchain technologies are rapidly forming a new decentralized internet of transactions.
Kubernetes is an efficient and productive platform for the configuration, deployment, and management of private blockchains."
}
</script>

</head></head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://imti.co/">IMTI</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://imti.co/">Home</a>
                    </li>
                    <li>
                        <a href="https://imti.co/about/">About</a>
                    </li>
                    <li>
                        <a href="https://twitter.com/cjimti">Follow</a>
                    </li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header{
        background-image: url('https://imti.co/img/post/kubeeth.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/ethereum" title="Ethereum">
                        Ethereum
                        </a>
                        
                        <a class="tag" href="/tags/kubernetes" title="Kubernetes">
                        Kubernetes
                        </a>
                        
                        <a class="tag" href="/tags/blockchain" title="Blockchain">
                        Blockchain
                        </a>
                        
                    </div>
                    <h1>Ethereum Blockchain on Kubernetes</h1>
                    <h2 class="subheading">Deploy a Private Ethereum Blockchain on a Custom Kubernetes Cluster.</h2>
                    <span  class="meta">Posted by Craig Johnston on Tuesday, September 4, 2018
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h5>SHARE</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_share_toolbox"></div></li>
                </ul>

                

<p>Blockchain technologies have been made famous by Cryptocurrencies such as Bitcoin and Ethereum. However, the concepts behind <a href="http://imti.co/blockchain/">Blockchain</a> are fore more reaching than their support for cryptocurrency. Blockchain technologies now support any digital asset, from signal data to complex messaging, to the execution of business logic through code. Blockchain technologies are rapidly forming a new decentralized internet of transactions.</p>

<p><a href="https://kubernetes.io/">Kubernetes</a> is an efficient and productive platform for the configuration, deployment, and management of private blockchains. Blockchain technology is intended to provide a decentralized transaction ledger, making it a perfect fit for the distributed nature of Kubernetes Pod deployments. The Kubernetes network infrastructure provides the necessary elements for security, scalability and fault tolerance needed for private or protected Blockchains.</p>

<p>Ethereum is a Cryptocurrency as well as a platform. <a href="https://www.ethereum.org/">Ethereum</a> &ldquo;is a decentralized platform that runs smart contracts: applications that run exactly as programmed without any possibility of downtime, censorship, fraud or third-party interference.&rdquo;</p>

<h2 id="setting-up-ethereum-on-kubernetes">Setting up Ethereum on Kubernetes</h2>

<p>In my opinion, the best way to learn and understand the capabilities of this technology is by implementing your own private <strong>production ready</strong> Blockchain. Beginner tutorials often get you up and running on a local workstation leaving out important production implementation details; other quick start guides use package managers like Helm that do all the work for you. However, both these approaches leave gaps, either in understanding how to migrate and scale into a production system in the case of local development or the case of package managers hiding implementation details and limiting configuration options.</p>

<p>The following is an idiomatic Kubernetes setup. Providing and describing each configuration step in leveraging the Kubernetes core concept of declarative state configuration.</p>

<p>The transaction and miner nodes run the official <a href="https://hub.docker.com/r/ethereum/client-go/">ethereum/client-go:release-1.8</a> Docker containers.</p>

<aside class="toc">
    <header>
        <h2>Contents</h2>
    </header>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#setting-up-ethereum-on-kubernetes">Setting up Ethereum on Kubernetes</a>
<ul>
<li><a href="#bare-metal-custom-kubernetes">Bare Metal / Custom Kubernetes</a></li>
<li><a href="#resource-organization-namespaces">Resource Organization / Namespaces</a></li>
<li><a href="#private-blockchain-network-topology">Private Blockchain Network Topology</a></li>
<li><a href="#bootnode">Bootnode</a>
<ul>
<li><a href="#bootnode-service">Bootnode Service</a></li>
<li><a href="#bootnode-deployment">Bootnode Deployment</a></li>
</ul></li>
<li><a href="#bootnode-registrar">Bootnode Registrar</a>
<ul>
<li><a href="#bootnode-registrar-service">Bootnode Registrar Service</a></li>
<li><a href="#bootnode-registrar-deployment">Bootnode Registrar Deployment</a></li>
</ul></li>
<li><a href="#ethstats-dashboard">Ethstats Dashboard</a>
<ul>
<li><a href="#ethstats-dashboard-service">Ethstats Dashboard Service</a></li>
<li><a href="#ethstats-dashboard-secret">Ethstats Dashboard Secret</a></li>
<li><a href="#ethstats-dashboard-deployment">Ethstats Dashboard Deployment</a></li>
<li><a href="#ethstats-dashboard-ingress">Ethstats Dashboard Ingress</a></li>
</ul></li>
<li><a href="#geth-configuration">Geth Configuration</a>
<ul>
<li><a href="#ethereum-genesis-block">Ethereum Genesis Block</a></li>
<li><a href="#geth-configmap">Geth ConfigMap</a></li>
</ul></li>
<li><a href="#geth-miner-nodes">Geth Miner Nodes</a>
<ul>
<li><a href="#geth-miner-secret">Geth Miner Secret</a></li>
<li><a href="#geth-miner-deployment">Geth Miner Deployment</a></li>
</ul></li>
<li><a href="#geth-transaction-nodes">Geth Transaction Nodes</a>
<ul>
<li><a href="#geth-transaction-nodes-service">Geth Transaction Nodes Service</a></li>
<li><a href="#geth-transaction-nodes-deployment">Geth Transaction Nodes Deployment</a></li>
</ul></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#additional-resources">Additional Resources</a></li>
</ul></li>
</ul>
</nav>
</aside>

<h3 id="bare-metal-custom-kubernetes">Bare Metal / Custom Kubernetes</h3>

<p>This guide builds a private Ethereum Blockchain on a custom Kubernetes cluster and avoids vendor lock-in or vendor specific instructions. If you don&rsquo;t already have a cluster, I recommend setting up a <a href="https://imti.co/hobby-cluster/">production ready Kubernetes hobby cluster</a>.</p>

<h3 id="resource-organization-namespaces">Resource Organization / Namespaces</h3>

<p><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Namespaces</a> in Kubernetes allow you to separate <a href="https://kubernetes.io/docs/concepts/services-networking/service/">services</a> or projects into logical groups. In this guide, I use the fictional namespace <strong>the-project</strong>. Applications within the namespace can easily find each other by their Service name. Networking within a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a> uses internal DNS to locate a service by its name (or name.namespace).</p>

<p><a href="https://imti.co/team-kubernetes-remote-access/">RBAC</a> or Role Based Access Control for a <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Namespaces</a> offers a suitable solution to securing the configuration and operation of private blockchain to a group of external users or systems. See <a href="https://imti.co/team-kubernetes-remote-access/">Kubernetes Team Access - RBAC for developers and QA</a> for details on Namespace-based security.</p>

<h3 id="private-blockchain-network-topology">Private Blockchain Network Topology</h3>

<p>The articles <a href="https://www.microsoft.com/developerblog/2018/02/09/using-helm-deploy-blockchain-kubernetes/">Using Helm to Deploy Blockchain to Kubernetes</a> and <a href="https://www.microsoft.com/developerblog/2018/06/01/creating-private-ethereum-consortium-kubernetes/">Building a Private Ethereum Consortium</a> on Microsoft&rsquo;s Developer Blog offer some great illustrations of this private Blockchain setup, following implementation is a deconstruction of the referenced Helm Chart.</p>

<h3 id="bootnode">Bootnode</h3>

<p>A <strong>bootnode</strong> is a &ldquo;Stripped down version of our Ethereum client implementation that only takes part in the network node discovery protocol, but does not run any of the higher level application protocols. It can be used as a lightweight bootstrap node to aid in finding peers in private networks.&rdquo;</p>

<h4 id="bootnode-service">Bootnode Service</h4>

<p>The <strong>Bootnode Service</strong> provides the endpoints <code>eth-bootnode:30301</code> and <code>eth-bootnode:8080</code> to Pod with the selector <strong>eth-bootnode</strong> defined further down in the <strong>Bootnode Deployment</strong>.</p>

<p>Create the file <code>110-bootnode-service.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: eth-bootnode
  namespace: the-project
  labels:
    app: eth-bootnode
spec:
  selector:
    app: eth-bootnode
  clusterIP: None
  ports:
  - name: discovery
    port: 30301
    protocol: UDP
  - name: http
    port: 8080
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./110-bootnode-service.yml
</code></pre>

<h4 id="bootnode-deployment">Bootnode Deployment</h4>

<p>Bootnode Pods use the official <strong><a href="https://hub.docker.com/r/ethereum/client-go/">ethereum/client-go</a></strong> Docker container, in this case, version <strong>alltools-release-1.8</strong>. Bootnode Pods start with an initialization container (initContainers section) named <strong>genkey</strong>. The genkey init container run the command <code>bootnode --genkey=/etc/bootnode/node.key</code>.</p>

<blockquote>
<p>As can be seen the bootnode asks for a key. Each ethereum node, including a bootnode, is identified by an enode identifier. These identifiers are derived from a key. Therefore you will need to give the bootnode such key. Since we currently don&rsquo;t have one, we can instruct the bootnode to generate a key (and store it in a file) before it starts.</p>
</blockquote>

<p>Once the <strong>genkey</strong> init container has completed the Bootnode Pod run two containers, <strong>bootnode</strong> on port <strong>30301/UDP</strong> is the running bootnode and <strong>bootnode-server</strong> is a simple command-line web server that responds on port <strong>8080/TCP</strong> with the Ethereum node address.</p>

<p>The following is an example response from the <strong>bootnode-server</strong> exposed by the service added above (ellipses added for brevity):</p>

<pre><code class="language-bash">curl eth-bootnode:8080
enode://e01bcec287...ceb1a7ada4f@192.168.108.136:30301
</code></pre>

<p>Create the file <code>120-bootnode-deployment.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: eth-bootnode
  namespace: the-project
  labels:
    app: eth-bootnode
spec:
  replicas: 2
  revisionHistoryLimit: 1
  selector:
    matchLabels:
      app: eth-bootnode
  template:
    metadata:
      labels:
        app: eth-bootnode
    spec:
      containers:
      - name: bootnode
        image: ethereum/client-go:alltools-release-1.8
        imagePullPolicy: IfNotPresent
        resources:
          limits:
            cpu: &quot;.5&quot;
          requests:
            cpu: &quot;0.25&quot;
        command: [&quot;/bin/sh&quot;]
        args:
        - &quot;-c&quot;
        - &quot;bootnode --nodekey=/etc/bootnode/node.key --verbosity=4&quot;
        volumeMounts:
        - name: data
          mountPath: /etc/bootnode
        ports:
        - name: discovery
          containerPort: 30301
          protocol: UDP
      - name: bootnode-server
        image: ethereum/client-go:alltools-release-1.8
        imagePullPolicy: IfNotPresent
        command: [&quot;/bin/sh&quot;]
        args:
        - &quot;-c&quot;
        - &quot;while [ 1 ]; do echo -e \&quot;HTTP/1.1 200 OK\n\nenode://$(bootnode -writeaddress --nodekey=/etc/bootnode/node.key)@$(POD_IP):30301\&quot; | nc -l -v -p 8080 || break; done;&quot;
        volumeMounts:
        - name: data
          mountPath: /etc/bootnode
        env:
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        ports:
        - containerPort: 8080
      initContainers:
      - name: genkey
        image: ethereum/client-go:alltools-release-1.8
        imagePullPolicy: IfNotPresent
        command: [&quot;/bin/sh&quot;]
        args:
        - &quot;-c&quot;
        - &quot;bootnode --genkey=/etc/bootnode/node.key&quot;
        volumeMounts:
        - name: data
          mountPath: /etc/bootnode
      volumes:
      - name: data
        emptyDir: {}
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./120-bootnode-deployment.yml
</code></pre>

<h3 id="bootnode-registrar">Bootnode Registrar</h3>

<p><a href="https://github.com/jpoon/bootnode-registrar">bootnode-registrar</a> is a &ldquo;Registrar for Geth Bootnodes. bootnode-registrar resolves a DNS address record to a enode addresses that can then be consumed by geth &ndash;bootnodes=<enodes>.&rdquo; written by <a href="http://jasonpoon.ca/">Jason Poon</a>.</p>

<p>Later on in this configuration the <strong>miner</strong> and <strong>tx</strong> Pods initialize by calling the <strong>eth-bootnode-registrar:80</strong> service to receive a comma-separated list of bootnodes as Ethereum node address.</p>

<p>An example response from this services (ellipses added for brevity):</p>

<pre><code class="language-plain">enode://e01bc...672ceb1a7ada4f@192.168.108.136:30301,enode://a5f65...d7c9e356d@192.168.59.1:30301
</code></pre>

<h4 id="bootnode-registrar-service">Bootnode Registrar Service</h4>

<p>Create the file <code>130-bootnode-registrar-service.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: eth-bootnode-registrar
  namespace: the-project
  labels:
    app: eth-bootnode-registrar
spec:
  selector:
    app: eth-bootnode-registrar
  type: ClusterIP
  ports:
  - port: 80
    targetPort: 9898
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./130-bootnode-registrar-service.yml
</code></pre>

<h4 id="bootnode-registrar-deployment">Bootnode Registrar Deployment</h4>

<p>The Bootnode Registrar Deployment uses the <a href="https://github.com/jpoon/bootnode-registrar">bootnode-registrar</a> container. <a href="https://github.com/jpoon/bootnode-registrar">bootnode-registrar</a> is open source and you can quickly build a custom container with the provided <a href="https://github.com/jpoon/bootnode-registrar/blob/master/Dockerfile">Dockerfile</a>. In this configuration uses the pre-built container provided.</p>

<p>If you are using a custom namespace be sure to change the <strong>BOOTNODE_SERVICE</strong> environment variable to the namespace you are using: &ldquo;eth-bootnode.<strong>the-project</strong>.svc.cluster.local&rdquo;.</p>

<p>The <a href="https://github.com/jpoon/bootnode-registrar">bootnode-registrar</a> Pod runs a single Docker container named <code>bootnode-registrar</code>, running the <code>jpoon/bootnode-registrar:v1.0.0</code> image from Docker hub.</p>

<p>Create the file <code>140-bootnode-registrar-deployment.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: eth-bootnode-registrar
  namespace: the-project
  labels:
    app: eth-bootnode-registrar
spec:
  replicas: 1
  revisionHistoryLimit: 1
  selector:
    matchLabels:
      app: eth-bootnode-registrar
  template:
    metadata:
      labels:
        app: eth-bootnode-registrar
    spec:
      containers:
      - name: bootnode-registrar
        image: jpoon/bootnode-registrar:v1.0.0
        imagePullPolicy: IfNotPresent
        env:
        - name: BOOTNODE_SERVICE
          value: &quot;eth-bootnode.the-project.svc.cluster.local&quot;
        ports:
        - containerPort: 9898
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./140-bootnode-registrar-deployment.yml
</code></pre>

<h3 id="ethstats-dashboard">Ethstats Dashboard</h3>

<p>The <a href="https://github.com/cubedro/eth-netstats">eth-netstats</a> project provides an incredible dashboard interface for monitoring Ethereum nodes. <a href="https://github.com/cubedro/eth-netstats">eth-netstats</a> consumes stats provided by the Ethereum <a href="https://github.com/ethereum/go-ethereum/wiki/geth">geth</a> nodes. <a href="https://github.com/ethereum/go-ethereum/wiki/geth">Geth</a> is the command line interface for running a full Ethereum node implemented in Go and deployed as <strong>miner</strong> and <strong>tx</strong></p>

<p><a href="/ethereum-ethstats/"><img src="/img/post/ethstats.jpg" alt="Ethstats Dashboard" /></a></p>

<p>Read the article <a href="/ethereum-ethstats/">Ethereum Ethstats / Describing the metrics.</a> if you are new to Blockchain or Ethereum terminology. In the article, I review essential metrics and their meaning.</p>

<h4 id="ethstats-dashboard-service">Ethstats Dashboard Service</h4>

<p>Create the file <code>210-ethstats-service.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: eth-ethstats
  namespace: the-project
  labels:
    app: eth-ethstats
spec:
  selector:
    app: eth-ethstats
  type: ClusterIP
  ports:
  - port: 80
    targetPort: http
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./210-ethstats-service.yml
</code></pre>

<h4 id="ethstats-dashboard-secret">Ethstats Dashboard Secret</h4>

<p>The <a href="https://github.com/ethereum/go-ethereum/wiki/geth">geth</a> nodes pass their Hostname and a shared password to Ethstats.  A Kubernetes Secret stores the password as base64 encoded string.</p>

<p>You can create a password on MacOs or Linux terminals by piping a string to the command base64, or you can use the site <a href="https://www.base64decode.org/">base64decode.org</a> to create a base64 encoded string.</p>

<p>Create Ethstats API Password:</p>

<pre><code class="language-bash"> echo -n 'changeme' | base64
 Y2hhbmdlbWU=
</code></pre>

<p>The following Secret <code>eth-ethstats</code> is mounted by Ethstats and the <a href="https://github.com/ethereum/go-ethereum/wiki/geth">geth</a> node Pods further down this guide.</p>

<p>Create the file <code>220-ethstats-secret.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Secret
metadata:
  name: eth-ethstats
  namespace: the-project
  labels:
    app: eth-ethstats
type: Opaque
data:
  # &quot;changeme&quot;
  WS_SECRET: &quot;Y2hhbmdlbWU=&quot;
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./220-ethstats-secret.yml
</code></pre>

<h4 id="ethstats-dashboard-deployment">Ethstats Dashboard Deployment</h4>

<p>The Ethstats dashboard Deployment uses the Docker <a href="https://hub.docker.com/r/ethereumex/eth-stats-dashboard/">ethereumex/eth-stats-dashboard container</a> from <a href="https://github.com/EthereumEx">Ethereum Expertise</a>. The container uses the environment variable <strong>WS_SECRET</strong> to set the password the Ethereum nodes use in calling to report their stats.  The <strong>eth-ethstats</strong> Secret created above defines the password.</p>

<p>Create the file <code>230-ethstats-deployment.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: eth-ethstats
  namespace: the-project
  labels:
    app: eth-ethstats
spec:
  replicas: 1
  revisionHistoryLimit: 1
  selector:
    matchLabels:
      app: eth-ethstats
  template:
    metadata:
      labels:
        app: eth-ethstats
    spec:
      containers:
      - name: ethstats
        image: ethereumex/eth-stats-dashboard:latest
        imagePullPolicy: IfNotPresent
        ports:
        - name: http
          containerPort: 3000
        env:
        - name: WS_SECRET
          valueFrom:
            secretKeyRef:
              name: eth-ethstats
              key: WS_SECRET
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./230-ethstats-deployment.yml
</code></pre>

<p><a href="https://hub.docker.com/r/ethereumex/eth-stats-dashboard/">ethereumex/eth-stats-dashboard container</a></p>

<h4 id="ethstats-dashboard-ingress">Ethstats Dashboard Ingress</h4>

<p>To access the Ethstats Dashboard from outside of the cluster, you need to have <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> configured on your cluster. If you do not have an <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> controller installed, I suggest reading <a href="https://imti.co/web-cluster-ingress/">Ingress on Custom Kubernetes</a> for a quick guide on setting up <strong><a href="https://kubernetes.github.io/ingress-nginx/">ingress-nginx</a></strong>.</p>

<p>The example below uses the secret <strong>imti-dev-production-tls</strong> to provide an SSL cert. <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a> is a free, automated, and open Certificate Authority and a simple way to get up and running on a custom Kubernetes cluster. I suggest reading <a href="https://imti.co/lets-encrypt-kubernetes/">Let&rsquo;s Encrypt, Kubernetes</a> to get up and running quickly with SSL.</p>

<p>Lastly, the following Ingress configuration uses annotations to specify a Basic Auth password from the secret <strong>imti-basic-auth</strong>, if you are new to Basic Auth on Kubernetes Ingress I suggest reading <a href="https://imti.co/kubernetes-ingress-basic-auth/">Basic Auth on Kubernetes Ingress</a>, which gives clear instructions for generating a secret that can be used with <strong><a href="https://kubernetes.github.io/ingress-nginx/">ingress-nginx</a></strong>.</p>

<p>Create the file <code>240-ethstats-ingress.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: eth-ethstats
  namespace: the-project
  labels:
    app: eth-ethstats
  annotations:
    nginx.ingress.kubernetes.io/auth-type: basic
    nginx.ingress.kubernetes.io/auth-secret: imti-basic-auth
    nginx.ingress.kubernetes.io/auth-realm: &quot;Authentication Required&quot;
spec:
  rules:
  - host: ethstats.dcp.dev.d4l.cloud
    http:
      paths:
      - backend:
          serviceName: eth-ethstats
          servicePort: 80
        path: /
  tls:
  - hosts:
    - ethstats.eth.imti.co
    secretName: imti-dev-production-tls
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./240-ethstats-ingress.yml
</code></pre>

<h3 id="geth-configuration">Geth Configuration</h3>

<p><a href="https://github.com/ethereum/go-ethereum/wiki/geth">Geth</a> is the command line interface for running a full ethereum node implemented in Go. <a href="https://github.com/ethereum/go-ethereum/wiki/geth">Geth</a> is used to mine Eth, transfer funds between addresses, create contracts and send transactions, explore block history and many other operations.</p>

<p>The following configurations use <a href="https://github.com/ethereum/go-ethereum/wiki/geth">Geth</a> to initialize the new private blockchain, configure miners and operate transaction only nodes.</p>

<h4 id="ethereum-genesis-block">Ethereum Genesis Block</h4>

<p>Read <a href="https://arvanaghi.com/blog/explaining-the-genesis-block-in-ethereum/">Explaining the Genesis Block in Ethereum</a> for a better understanding of the Ethereum Genesis Block.</p>

<p><a href="https://github.com/ethereum/go-ethereum/wiki/geth">Geth</a> nodes initialize themselves and start the new private blockchain with the first block (Ethereum Genesis Block) defined in the key <code>genesis.json</code>.</p>

<p>You should customize the value <strong>networkid</strong> in the ConfigMap and the <strong>&ldquo;chainId&rdquo;</strong> in the <code>genesis.json</code>. Ethereum nodes must have the same genesis block and networkid to join a network. Large <strong>networkid</strong>s typically indicate private networks.</p>

<h4 id="geth-configmap">Geth ConfigMap</h4>

<p>The <a href="https://github.com/ethereum/go-ethereum/wiki/geth">Geth</a> miner and transaction pods mount the Geth ConfigMap created here.</p>

<p>Along with customizing the <strong>networkid</strong>/<strong>chainId</strong>, you may also add Ethereum accounts to fund when the Genesis Block gets created. These can be any addresses you like. Use <a href="https://metamask.io/">MetaMask</a> or <a href="https://www.myetherwallet.com/">MyEtherWallet</a> for an easy way to manage accounts or <a href="https://github.com/ethereum/go-ethereum/wiki/Installing-Geth">install Geth</a> on your local workstation and type <code>geth account new</code> to create some new accounts.</p>

<p>This private network has a limited number of miners running with restricted CPU access, so we want to keep the difficulty low.</p>

<p>Read the <a href="https://github.com/ethereum/go-ethereum/wiki/Private-network">official documentation on private networks</a> configuration for more details on choosing a network id and creating the Genesis Block.</p>

<p>Create the file <code>310-geth-configmap.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: eth-geth
  namespace: the-project
  labels:
    app: eth-geth
data:
  networkid: &quot;8189450821&quot;
  genesis.json: |-
    {
        &quot;config&quot;: {
            &quot;chainId&quot;: 8189450821,
            &quot;homesteadBlock&quot;: 0,
            &quot;eip150Block&quot;: 0,
            &quot;eip155Block&quot;: 0,
            &quot;eip158Block&quot;: 0
        },
        &quot;difficulty&quot;: &quot;0x400&quot;,
        &quot;gasLimit&quot;: &quot;2000000&quot;,
        &quot;nonce&quot;   : &quot;0x0000000000000000&quot;,
        &quot;alloc&quot;: {
          &quot;0x58917D55dA991da576F148FD7E3E05a34666988b&quot;: { &quot;balance&quot;: &quot;100000000000000000000&quot; },
          &quot;0x29bb385cF8ae4Cc49dBd10CcdA5e3d591D831527&quot;: { &quot;balance&quot;: &quot;200000000000000000000&quot; },
          &quot;0xf1c9C9a1Ba591588147c2A729c470D8AFA91a04d&quot;: { &quot;balance&quot;: &quot;300000000000000000000&quot; }
        }
    }
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./310-geth-configmap.yml
</code></pre>

<h3 id="geth-miner-nodes">Geth Miner Nodes</h3>

<p>The following configuration deploys three <a href="https://github.com/ethereum/go-ethereum/wiki/geth">Geth</a> miner nodes that share a <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> used for creating their coinbase accounts.</p>

<h4 id="geth-miner-secret">Geth Miner Secret</h4>

<p>A Kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> is used to store a common password each miner uses for creating an Ethereum account funded by block creation rewards; this is called the coinbase. This password is used to unlock the associated Ethereum account to transfer Eth gained from the minder nodes to other accounts. However, the coinbase may be configured for each miner can at any time.</p>

<p>You can create a password on MacOs or Linux terminals by piping a string to the command base64, or you can use the site <a href="https://www.base64decode.org/">base64decode.org</a> to create a base64 encoded string.</p>

<p>Create Ethstats API Password:</p>

<pre><code class="language-bash"> echo -n 'password' | base64
 cGFzc3dvcmQ=
</code></pre>

<p>Create the file <code>320-geth-miner-secret.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Secret
metadata:
  name: eth-geth-miner
  namespace: the-project
  labels:
    app: eth-geth-miner
type: Opaque
data:
  # echo -n 'password' | base64
  accountsecret: &quot;cGFzc3dvcmQ=&quot;
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./320-geth-miner-secret.yml
</code></pre>

<h4 id="geth-miner-deployment">Geth Miner Deployment</h4>

<p>This configuration starts with three miner Pods but can easily be scaled. Pods consist of one main container named <strong>geth-miner</strong> and two initialization containers named <strong>init-genesis</strong> and <strong>eth-geth-miner</strong>.</p>

<p>The pods request a minimum CPU allotment of 0.25 cores and maximum of 1.</p>

<p>Create the file <code>330-geth-miner-deployment.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: eth-geth-miner
  namespace: the-project
  labels:
    app: eth-geth-miner
spec:
  replicas: 3
  revisionHistoryLimit: 1
  selector:
    matchLabels:
      app: eth-geth-miner
  template:
    metadata:
      labels:
        app: eth-geth-miner
    spec:
      containers:
      - name: geth-miner
        image: ethereum/client-go:release-1.8
        imagePullPolicy: IfNotPresent
        resources:
          limits:
            cpu: &quot;.5&quot;
          requests:
            cpu: &quot;0.25&quot;
        command: [&quot;/bin/sh&quot;]
        args:
        - &quot;-c&quot;
        - &quot;geth --bootnodes=`cat /root/.ethereum/bootnodes` --mine --etherbase=0 --networkid=${NETWORK_ID} --ethstats=${HOSTNAME}:${ETHSTATS_SECRET}@${ETHSTATS_SVC} --verbosity=5&quot;
        env:
        - name: ETHSTATS_SVC
          value: eth-ethstats.dcp
        - name: ETHSTATS_SECRET
          valueFrom:
            secretKeyRef:
              name: eth-ethstats
              key: WS_SECRET
        - name: NETWORK_ID
          valueFrom:
            configMapKeyRef:
              name: eth-geth
              key: networkid
        ports:
        - name: discovery-udp
          containerPort: 30303
          protocol: UDP
        - name: discovery-tcp
          containerPort: 30303
        volumeMounts:
        - name: data
          mountPath: /root/.ethereum
      initContainers:
      - name: init-genesis
        image: ethereum/client-go:release-1.8
        imagePullPolicy: IfNotPresent
        args:
        - &quot;init&quot;
        - &quot;/var/geth/genesis.json&quot;
        volumeMounts:
        - name: data
          mountPath: /root/.ethereum
        - name: config
          mountPath: /var/geth
      - name: create-account
        image: ethereum/client-go:release-1.8
        imagePullPolicy: IfNotPresent
        command: [&quot;/bin/sh&quot;]
        args:
        - &quot;-c&quot;
        - &quot;printf '$(ACCOUNT_SECRET)\n$(ACCOUNT_SECRET)\n' | geth account new&quot;
        env:
        - name: ACCOUNT_SECRET
          valueFrom:
            secretKeyRef:
              name: eth-geth-miner
              key: accountsecret
        volumeMounts:
        - name: data
          mountPath: /root/.ethereum
      - name: get-bootnodes
        image: ethereum/client-go:release-1.8
        imagePullPolicy: IfNotPresent
        command: [&quot;/bin/sh&quot;]
        args:
        - &quot;-c&quot;
        - |-
          apk add --no-cache curl;
          CNT=0;
          echo &quot;retreiving bootnodes from $BOOTNODE_REGISTRAR_SVC&quot;
          while [ $CNT -le 90 ]
          do
            curl -m 5 -s $BOOTNODE_REGISTRAR_SVC | xargs echo -n &gt;&gt; /geth/bootnodes;
            if [ -s /geth/bootnodes ]
            then
              cat /geth/bootnodes;
              exit 0;
            fi;

            echo &quot;no bootnodes found. retrying $CNT...&quot;;
            sleep 2 || break;
            CNT=$((CNT+1));
          done;
          echo &quot;WARNING. unable to find bootnodes. continuing but geth may not be able to find any peers.&quot;;
          exit 0;
        env:
        - name: BOOTNODE_REGISTRAR_SVC
          value: eth-bootnode-registrar
        volumeMounts:
        - name: data
          mountPath: /geth
      volumes:
      - name: data
        emptyDir: {}
      - name: config
        configMap:
          name: eth-geth
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./330-geth-miner-deployment.yml
</code></pre>

<h3 id="geth-transaction-nodes">Geth Transaction Nodes</h3>

<p>Geth Transaction Nodes <strong>eth-geth-tx</strong> are only used to create transactions on the private blockchain.</p>

<h4 id="geth-transaction-nodes-service">Geth Transaction Nodes Service</h4>

<p>Access to Geth Transaction Nodes is through a <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a> named <strong>eth-geth-tx</strong> on ports 8545 and 8546.</p>

<p>Create the file <code>410-geth-tx-service.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: eth-geth-tx
  namespace: the-project
  labels:
    app: eth-geth-tx
spec:
  selector:
    app: eth-geth-tx
  type: ClusterIP
  ports:
  - name: rpc
    port: 8545
  - name: ws
    port: 8546
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./410-geth-tx-service.yml
</code></pre>

<h4 id="geth-transaction-nodes-deployment">Geth Transaction Nodes Deployment</h4>

<p>Issuing transactions on the private Blockchain occur through a set of two Geth Transaction Nodes; these Pods are setup similar to miners running the official <a href="https://hub.docker.com/r/ethereum/client-go/">ethereum/client-go:release-1.8</a>. Geth Transaction Node consist of one main container named <strong>geth-tx</strong> and two initialization containers <strong>init-genesis</strong> and <strong>get-bootnodes</strong>.</p>

<p>Create the file <code>420-geth-tx-deployment.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: eth-geth-tx
  namespace: the-project
  labels:
    app: eth-geth-tx
spec:
  replicas: 2
  selector:
    matchLabels:
      app: eth-geth-tx
  template:
    metadata:
      labels:
        app: eth-geth-tx
    spec:
      containers:
      - name: geth-tx
        image: ethereum/client-go:release-1.8
        imagePullPolicy: IfNotPresent
        command: [&quot;/bin/sh&quot;]
        args:
        - &quot;-c&quot;
        - &quot;geth --bootnodes=`cat /root/.ethereum/bootnodes` --rpc --rpcapi=eth,net,web3 --rpccorsdomain='*' --ws --networkid=${NETWORK_ID} --ethstats=${HOSTNAME}:${ETHSTATS_SECRET}@${ETHSTATS_SVC} --verbosity=5&quot;
        env:
        - name: ETHSTATS_SVC
          value: eth-ethstats.dcp
        - name: ETHSTATS_SECRET
          valueFrom:
            secretKeyRef:
              name: eth-ethstats
              key: WS_SECRET
        - name: NETWORK_ID
          valueFrom:
            configMapKeyRef:
              name: eth-geth
              key: networkid
        ports:
        - name: rpc
          containerPort: 8545
        - name: ws
          containerPort: 8546
        - name: discovery-udp
          containerPort: 30303
          protocol: UDP
        - name: discovery-tcp
          containerPort: 30303
        volumeMounts:
        - name: data
          mountPath: /root/.ethereum
      initContainers:
      - name: init-genesis
        image: ethereum/client-go:release-1.8
        imagePullPolicy: IfNotPresent
        args:
        - &quot;init&quot;
        - &quot;/var/geth/genesis.json&quot;
        volumeMounts:
        - name: data
          mountPath: /root/.ethereum
        - name: config
          mountPath: /var/geth
      - name: get-bootnodes
        image: ethereum/client-go:release-1.8
        imagePullPolicy: IfNotPresent
        command: [&quot;/bin/sh&quot;]
        args:
        - &quot;-c&quot;
        - |-
          apk add --no-cache curl;
          CNT=0;
          echo &quot;retreiving bootnodes from $BOOTNODE_REGISTRAR_SVC&quot;
          while [ $CNT -le 90 ]
          do
            curl -m 5 -s $BOOTNODE_REGISTRAR_SVC | xargs echo -n &gt;&gt; /geth/bootnodes;
            if [ -s /geth/bootnodes ]
            then
              cat /geth/bootnodes;
              exit 0;
            fi;

            echo &quot;no bootnodes found. retrying $CNT...&quot;;
            sleep 2 || break;
            CNT=$((CNT+1));
          done;
          echo &quot;WARNING. unable to find bootnodes. continuing but geth may not be able to find any peers.&quot;;
          exit 0;
        env:
        - name: BOOTNODE_REGISTRAR_SVC
          value: eth-bootnode-registrar.dcp
        volumeMounts:
        - name: data
          mountPath: /geth
      volumes:
      - name: data
        emptyDir: {}
      - name: config
        configMap:
          name: eth-geth
</code></pre>

<p>Apply the configuration:</p>

<pre><code class="language-bash">kubectl create -f ./420-geth-tx-deployment.yml
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>Depending on your difficulty and resources it may take 10-20 minutes to mine your first block in this private chain. However, the difficulty is automatically adjusted, and you may begin to mine blocks at around 20-30 seconds on average.</p>

<h2 id="additional-resources">Additional Resources</h2>

<ul>
<li><a href="https://github.com/ethereum/go-ethereum/wiki/Private-network">go-ethereum Private-network</a> Github Wiki</li>
<li><a href="https://metamask.io/">MetaMask</a> Ethereum account management</li>
</ul>


                
                <hr>
                <h5>SHARE</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_share_toolbox"></div></li>
                </ul>

                <h5>FOLLOW</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_follow_toolbox"></div></li>
                </ul>

            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/data" title="Data">
                        Data
                        </a>
                        
                        
                        
                        <a href="/tags/data-science" title="Data Science">
                        Data Science
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/devops" title="DevOps">
                        DevOps
                        </a>
                        
                        
                        
                        <a href="/tags/development" title="Development">
                        Development
                        </a>
                        
                        
                        
                        <a href="/tags/docker" title="Docker">
                        Docker
                        </a>
                        
                        
                        
                        <a href="/tags/elasticsearch" title="Elasticsearch">
                        Elasticsearch
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/golang" title="Golang">
                        Golang
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/ingress" title="Ingress">
                        Ingress
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kubernetes" title="Kubernetes">
                        Kubernetes
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/microservices" title="Microservices">
                        Microservices
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/python" title="Python">
                        Python
                        </a>
                        
                        
                        
                        <a href="/tags/raspberry-pi" title="Raspberry Pi">
                        Raspberry Pi
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/security" title="Security">
                        Security
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/utils" title="Utils">
                        Utils
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kubectl" title="kubectl">
                        kubectl
                        </a>
                        
                        
                        
                        
                        
                        
                    </div>
                </section>

                
                <hr>
                <h5>RELATED</h5>
                <ul class="list-inline">
                    
                </ul>
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="IMTI" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:cjimti@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a href="https://twitter.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/cjimti/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                </ul>
		<p class="copyright text-muted">
            Copyright &copy; <a href="https://www.linkedin.com/in/cjimti/">Craig Johnston</a> , 2018
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b905a667cf4d77c"></script>



    
        
        
    





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-78786435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
