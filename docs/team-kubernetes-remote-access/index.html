<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta name="msvalidate.01" content="DBC34551F2DD1BA3DC0D62EE46D7448F" />
    <meta name="google-site-verification" content="DrtKc88u9uc7iptd4LyURAKBmFcOn7Kuk6HcRk_kNmo" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Role Based Access Control">
    
    <meta name="keyword"  content="Go, Kubernetes, Elasticsearch, Python, Docker, Big Data, Artificial Intelligence, Machine Learning, Blockchain">
    <link rel="shortcut icon" href="https://imti.co/img/favicon.ico">

    <title>Kubernetes Team Access - RBAC for developers and QA - IMTI - Craig Johnston</title>

    <link rel="canonical" href="https://imti.co/team-kubernetes-remote-access/">
	
    
    <link rel="stylesheet" href="https://imti.co/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://imti.co/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="https://imti.co/css/syntax.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <link rel="stylesheet" href="/css/imti.css">

    
    <script src="https://imti.co/js/jquery.min.js"></script>
    
    
    <script src="https://imti.co/js/bootstrap.min.js"></script>
    
    
    <script src="https://imti.co/js/hux-blog.min.js"></script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-5984764595236029",
            enable_page_level_ads: true
        });
    </script>

    <meta name="twitter:site" content="@cjimti">
<meta name="twitter:creator" content="@cjimti">

<meta name="twitter:description" content="Role Based Access Control" />
<meta name="twitter:title" content="Kubernetes Team Access - RBAC for developers and QA" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://imti.co/img/post/switchboard_876_438.jpg" />
<meta property="og:image" content="https://imti.co/img/post/switchboard_876_438.jpg" />



    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://imti.co/team-kubernetes-remote-access/"
  },
  "headline": "Kubernetes Team Access - RBAC for developers and QA",
  "image": [
    "https://imti.co/img/post/switchboard_876_438.jpg"
   ],
  "datePublished": "2018-07-10T00:00:00",
  "dateModified": "2018-07-10T00:00:00",
  "author": {
    "@type": "Person",
    "name": "Craig Johnston"
  },
   "publisher": {
    "@type": "Organization",
    "name": 'imti.co",
    "logo": {
      "@type": "ImageObject",
      "url": "https://imti.co/img/craig_johnston_cjimti.jpg"
    }
  },
  "description": "RBAC (Role Based Access Control) allows our Kubernetes clusters to provide the development team better visibility and access into the development, staging and production environments than it has have ever had in the past. Developers using the command line tool kubectl, can explore the network topology of running microservices, tail live server logs, proxy local ports directly to services or even execute shells into running pods.
Kubernetes and GitlabCI are the central components of our DevOps toolchain and have increased our productivity by many multiples over the traditional approaches of the past."
}
</script>

</head></head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://imti.co/">IMTI</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://imti.co/">Home</a>
                    </li>
                    <li>
                        <a href="https://imti.co/about/">About</a>
                    </li>
                    <li>
                        <a href="https://twitter.com/cjimti">Follow</a>
                    </li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header{
        background-image: url('https://imti.co/img/post/switchboard.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/kubernetes" title="Kubernetes">
                        Kubernetes
                        </a>
                        
                        <a class="tag" href="/tags/devops" title="DevOps">
                        DevOps
                        </a>
                        
                        <a class="tag" href="/tags/security" title="Security">
                        Security
                        </a>
                        
                        <a class="tag" href="/tags/kubectl" title="kubectl">
                        kubectl
                        </a>
                        
                    </div>
                    <h1>Kubernetes Team Access - RBAC for developers and QA</h1>
                    <h2 class="subheading">Role Based Access Control</h2>
                    <span  class="meta">Posted by Craig Johnston on Tuesday, July 10, 2018
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h5>SHARE</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_share_toolbox"></div></li>
                </ul>

                

<p>RBAC (Role Based Access Control) allows our Kubernetes clusters to provide the development team better visibility and access into the development, staging and production environments than it has have ever had in the past. Developers using the command line tool <strong><a href="https://kubernetes.io/docs/reference/kubectl/kubectl/">kubectl</a></strong>, can explore the network topology of running <a href="/microservices/">microservices</a>, tail live server logs, proxy local ports directly to services or even execute shells into running pods.</p>

<p><a href="/gitlabci-golang-microservices/">Kubernetes and GitlabCI</a> are the central components of our DevOps toolchain and have increased our productivity by many multiples over the traditional approaches of the past.</p>

<p>If you don&rsquo;t already have a Kubernetes cluster up and running, then I highly suggest you read my article <a href="/hobby-cluster/">Production Hobby Cluster</a> to get you up and running in a custom, vendor-neutral production capable cluster.</p>

<blockquote>
<p>TLDR: If you are reading this article because you received a <strong>token</strong> and the URL of a cluster from your Kubernetes administrator, you can skip ahead to the section <a href="#accessing-a-remote-kubernetes-cluster">Accessing a Remote Kubernetes Cluster</a>.</p>
</blockquote>

<aside class="toc">
    <header>
        <h2>Contents</h2>
    </header>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#our-clusters-overview">Our Clusters (Overview)</a></li>
<li><a href="#cluster-setup">Cluster Setup</a>
<ul>
<li><a href="#example-microservice">Example Microservice</a>
<ul>
<li><a href="#namespace">Namespace</a></li>
<li><a href="#deployment">Deployment</a></li>
<li><a href="#service">Service</a></li>
<li><a href="#ingress">Ingress</a></li>
</ul></li>
<li><a href="#setup-remote-access">Setup Remote Access</a>
<ul>
<li><a href="#serviceaccount">ServiceAccount</a></li>
<li><a href="#role-and-rolebinding">Role and RoleBinding</a></li>
</ul></li>
</ul></li>
<li><a href="#accessing-a-remote-kubernetes-cluster">Accessing a Remote Kubernetes Cluster</a>
<ul>
<li><a href="#add-a-cluster-to-kubectl">Add a Cluster to <code>kubectl</code></a></li>
<li><a href="#add-user-credentials-to-kubectl">Add User (credentials) to <code>kubectl</code></a></li>
<li><a href="#add-a-context-to-kubectl">Add a Context to <code>kubectl</code></a></li>
</ul></li>
<li><a href="#resources">Resources</a></li>
</ul></li>
</ul>
</nav>
</aside>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5984764595236029"
     data-ad-slot="7730310582"></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<h2 id="our-clusters-overview">Our Clusters (Overview)</h2>

<p>Development and staging environments share a cluster across many clients and projects. On the production front, more extensive projects and clients get a dedicated cluster, and smaller projects might share a cluster.</p>

<p>We use Kubernetes <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespaces</a> to separate clients. All of our security revolves around <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespaces</a>, and when <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a> is set up correctly, a context in which access granted to a developer can only operate and view within the assigned namespace.</p>

<p>We grant developers read-level access to one common developer account per <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a> on the development cluster. We tighten access to some resources on production.</p>

<p>We create a separate deployment account for our continuous integration/deployment solution, see my article, <a href="/gitlabci-golang-microservices/">A Microservices Workflow with Golang and Gitlab CI</a> to get a high-level view of our toolchain and how it integrates cleanly with Kubernetes <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a> security model.</p>

<h2 id="cluster-setup">Cluster Setup</h2>

<p>These cluster setup steps assume you are a cluster administrator if you are only looking to set up <a href="https://kubernetes.io/docs/reference/kubectl/kubectl/">kubectl</a> access on your local workstation to an existing cluster skip ahead to the section: <a href="#accessing-a-remote-kubernetes-cluster">Accessing a Remote Kubernetes Cluster</a>, otherwise I suggestion that you set up a <a href="/hobby-cluster/">Production Hobby Cluster</a> to help you follow along.</p>

<h3 id="example-microservice">Example Microservice</h3>

<p>You can skip the following steps and head directly to <a href="#setup-remote-access">Setup Remote Access</a> if you already have a <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a> with projects you plan to provide remote access <a href="https://kubernetes.io/docs/reference/kubectl/kubectl/">kubectl</a>.</p>

<p>To demonstrate team access control we need some pods running in the namespace <code>the-project</code>. The example below uses a pre-built Docker container designed specifically for testing called <a href="https://github.com/txn2/ok">txn2/ok</a>. If you are curious about how to automate subsequent deployments using the free and open source <a href="https://about.gitlab.com/features/gitlab-ci-cd/">GitlabCI</a>, check out <a href="/gitlabci-golang-microservices/">A Microservices Workflow with Golang and Gitlab CI</a>.</p>

<p>We don&rsquo;t automate the initial configuration, and so the following steps are part of the setup stage of any new project. It is easy to automate this process with the Kubernetes package manager <a href="https://helm.sh/">Helm</a>, but that would be overkill for most of our projects and abstract away some welcome verbosity. <a href="https://helm.sh/">Helm</a> is a great tool but better-used adjacent to our initial development process. In fact, we use <a href="https://helm.sh/">Helm</a> to create charts from our initial development configurations, but that is outside the scope of this article.</p>

<h4 id="namespace">Namespace</h4>

<p>I use the term <code>the-project</code> as a fictional <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a> for the examples going forward. If you want to follow along, use the following configuration to create the example <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a>.</p>

<p><code>00-namespace.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Namespace
metadata:
  name: the-project
  labels:
    client: mk.imti.co
    env: dev
</code></pre>

<p>The filename is not important. I use a numeric value to represent a suggested order in which to apply the configuration, followed by the <code>kind</code> of the kubernetes object to create. However, this is not a rigid rule across all projects and only the [namespace[</p>

<p>The <code>labels</code> section is optional and only used to give additional sections capabilities to command-line and automated tools.</p>

<p>Create the <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a> kubernetes object:</p>

<pre><code class="language-bash">kubectl create -f 00-namespace.yml
</code></pre>

<h4 id="deployment">Deployment</h4>

<p>After adding the <code>the-project</code> <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a> above, create a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> in <code>the-project</code> to manage <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">pods</a> running <a href="https://github.com/txn2/ok">txn2/ok</a> Docker containers.</p>

<p><code>10-deployment-ok.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: ok
  namespace: the-project
  labels:
    app: ok
    client: mk.imti.co
    env: dev
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ok
  template:
    metadata:
      namespace: the-project
      labels:
        app: ok
        client: mk.imti.co
        env: dev
    spec:
      containers:
        - name: ok
          image: txn2/ok
          imagePullPolicy: Always
          env:
            - name: NODE_NAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: POD_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
            - name: SERVICE_ACCOUNT
              valueFrom:
                fieldRef:
                  fieldPath: spec.serviceAccountName
          ports:
            - name: ok-port
              containerPort: 8080
</code></pre>

<p>Create the Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> object:</p>

<pre><code class="language-bash">kubectl create -f 10-deployment-ok.yml
</code></pre>

<h4 id="service">Service</h4>

<p>Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a>s manage <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pods</a>. Consider <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pods</a> ephemeral, being moved from one node to another, destroyed or re-created at any time. <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a>s are persistent and give us a point to attach our network <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">ingress</a>. If you don&rsquo;t already have ingress setup, you might want to read my article <a href="/web-cluster-ingress/">Ingress on Custom Kubernetes</a> to get started. <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> needs a <a href="https://kubernetes.io/docs/concepts/services-networking/service/">service</a> to attach to; however you don&rsquo;t need ingress to set up a service.</p>

<p><code>50-service-ok.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: ok
  namespace: the-project
  labels:
    app: ok
    client: mk.imti.co
    env: dev
spec:
  selector:
    app: ok
  ports:
    - protocol: &quot;TCP&quot;
      port: 8080
      targetPort: 8080
  type: ClusterIP
</code></pre>

<p>Create the Kubernetes <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a> object:</p>

<pre><code class="language-bash">kubectl create -f 50-service-ok.yml
</code></pre>

<h4 id="ingress">Ingress</h4>

<p>Setting up <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">ingress</a> for the <a href="https://github.com/txn2/ok">txn2/ok</a> service for the sake of completeness. We will configure <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">ingress</a> to send HTTP requests for the domain <a href="http://ok.d4ldev.txn2.com/">ok.d4ldev.txn2.com</a> to the <a href="https://github.com/txn2/ok">txn2/ok</a> service running in <code>the-project</code> <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a>.</p>

<p><code>80-ingress-ok.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: ok
  namespace: the-project
  labels:
    app: ok
    client: mk.imti.co
    env: dev
spec:
  rules:
  - host: ok.d4ldev.txn2.com
    http:
      paths:
      - backend:
          serviceName: ok
          servicePort: 8080
        path: /
</code></pre>

<p>Create the <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">ingress</a>:</p>

<pre><code class="language-bash">kubectl create -f 80-ingress-ok.yml
</code></pre>

<p>Adding TLS support is easy but out the scope of this article. If you are interested in setting up free, automated TLS certificate using <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a> on Kubernetes, check out my article: <a href="/lets-encrypt-kubernetes/">Let&rsquo;s Encrypt, Kubernetes</a>. Setting up <a href="/lets-encrypt-kubernetes/">Let&rsquo;s Encrypt, Kubernetes</a> should only have to be done once and take only about twenty minutes.</p>

<p>We now have a fully functional test API service answering at <a href="http://ok.d4ldev.txn2.com/">http://ok.d4ldev.txn2.com/</a>. In the next few steps, we create Kubernetes <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a> tokens for deployment and ready-only developer access.</p>

<h3 id="setup-remote-access">Setup Remote Access</h3>

<p>If you skipped setting up the <a href="#example-microservice">Example Microservice</a> this example limits access to the namespace <code>the-project</code> exclusively, you could do the same with the <code>default</code> <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a> by simply not providing a <code>namespace</code> key in the configuration or setting it to <code>default</code>.</p>

<h4 id="serviceaccount">ServiceAccount</h4>

<p>Namespaces are the principal delimiter for our security model. We create deployer and developer <a href="https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/">ServiceAccount</a> for each <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a>, along with <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings">Role</a> and <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings">RoleBinding</a> objects used by them. <strong>Deployer</strong> has write access and used for a <a href="https://kubernetes.io/docs/reference/kubectl/kubectl/">kubectl</a> executed from a Docker container operating GitlabCI <a href="https://docs.gitlab.com/runner/">runner</a>. <strong>Developer</strong> has read access to the namespace.</p>

<p>Use <a href="https://kubernetes.io/docs/reference/kubectl/kubectl/">kubectl</a> to create a <a href="https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/">ServiceAccount</a>; this will not only configure the ServiceAccount object but also generate the Kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> containing a <strong>token</strong> used to setup <a href="https://kubernetes.io/docs/reference/kubectl/kubectl/">kubectl</a> with remote access.</p>

<pre><code class="language-bash"># create the deployer ServiceAccount
kubectl create serviceaccount sa-deployer -n the-project

# create the developer ServiceAccount
kubectl create serviceaccount sa-developer -n the-project
</code></pre>

<p>You should see three service accounts, default, sa-deployer and sa-developer. Kubernetes automatically created the default ServiceAccount when we created the namespace.</p>

<pre><code class="language-bash">kubectl get serviceaccounts -n the-project

NAME           SECRETS   AGE
default        1         30m
sa-deployer    1         3m
sa-developer   1         2m
</code></pre>

<p>You now have three secrets, assuming this is the new <code>the-project</code> namespace.</p>

<pre><code class="language-bash">kubectl get secrets -n the-project

NAME                       TYPE                                  DATA      AGE
default-token-8t2z6        kubernetes.io/service-account-token   3         30m
sa-deployer-token-qxfsq    kubernetes.io/service-account-token   3         3m
sa-developer-token-pg7m7   kubernetes.io/service-account-token   3         3m
</code></pre>

<p>You need the tokens generated for <code>sa-deployer-token-qxfsq</code> and <code>sa-developer-token-pg7m7</code>, of course, your secrets end in different random characters.</p>

<pre><code class="language-bash">kubectl describe secret sa-deployer-token-qxfsq -n the-project
Name:         sa-deployer-token-qxfsq
Namespace:    the-project
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name=sa-deployer
              kubernetes.io/service-account.uid=c2bb12cc-84b5-11e8-9c96-00163ec25389

Type:  kubernetes.io/service-account-token

Data
====
ca.crt:     1025 bytes
namespace:  11 bytes
token:      eyYhbfEf7XaMa...REDACTED...
</code></pre>

<p>In the result above I truncated the token for security and brevity, the unedited token is much longer. Copy this token someplace safe as it is needed later; however you can always fetch it again with <code>kubectl describe secret</code>. Retrieve the tokens from sa-deployer-token-&hellip; and sa-developer-token-&hellip;</p>

<h4 id="role-and-rolebinding">Role and RoleBinding</h4>

<p>Next, we create four Kubernetes objects at one time, two <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings">Role</a>s and two <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings">RoleBinding</a>s. One Role and RoleBinding set for <strong>deployer</strong> and one set for <strong>developer</strong>.</p>

<p><code>90-RBAC.yml</code>:</p>

<pre><code class="language-yaml">apiVersion: rbac.authorization.k8s.io/v1beta1
kind: Role
metadata:
  namespace: the-project
  name: deployer
rules:
- apiGroups: [&quot;apps&quot;,&quot;extensions&quot;]
  resources: [&quot;deployments&quot;,&quot;configmaps&quot;,&quot;pods&quot;,&quot;secrets&quot;,&quot;ingresses&quot;]
  verbs: [&quot;create&quot;,&quot;get&quot;,&quot;delete&quot;,&quot;list&quot;,&quot;update&quot;,&quot;edit&quot;,&quot;watch&quot;,&quot;exec&quot;,&quot;patch&quot;]
---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: Role
metadata:
  namespace: the-project
  name: developer
rules:
- apiGroups: [&quot;*&quot;]
  resources: [&quot;*&quot;]
  verbs: [&quot;get&quot;,&quot;describe&quot;,&quot;list&quot;,&quot;watch&quot;,&quot;exec&quot;]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: deployer
  namespace: the-project
roleRef:
  kind: Role
  name: deployer
  apiGroup: rbac.authorization.k8s.io
subjects:
- kind: ServiceAccount
  namespace: the-project
  name: sa-deployer
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: developer
  namespace: the-project
roleRef:
  kind: Role
  name: developer
  apiGroup: rbac.authorization.k8s.io
subjects:
- kind: ServiceAccount
  namespace: the-project
  name: sa-developer

</code></pre>

<p>If you want to give your team even more access, you can enable the ability to port-forward a service or pod directly to their local workstation. Add the following to the end of the <strong>developer</strong> role.</p>

<pre><code class="language-yaml">- apiGroups:
  - '*'
  resources:
  - 'pods/exec'
  - 'pods/portforward'
  - 'services/portforward'
  verbs:
  - create
</code></pre>

<p>Example <code>kubectl port-forward</code> to an <code>elasticsearch</code> service running in <code>the-project</code> namespace:</p>

<pre><code class="language-bash">kubectl port-forward svc/elasticsearch 9200:9200 -n the-project
</code></pre>

<p>Create the new <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings">Role</a>s and the RoleBindings that connect them to the ServiceAccounts <a href="#serviceaccount">created with kubectl a bit earlier</a>.</p>

<p>Create the <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings">Role</a>s and RoleBindings:</p>

<pre><code class="language-bash">kubectl create -f 90-RBAC.yml
</code></pre>

<h2 id="accessing-a-remote-kubernetes-cluster">Accessing a Remote Kubernetes Cluster</h2>

<p><code>kubectl</code> is a command-line tool for interacting with Kubernetes. If you work on MacOs and use <a href="https://brew.sh/">homebrew</a>, issue the following command:</p>

<pre><code class="language-bash">brew install kubernetes-cli
</code></pre>

<p>Once installed you have the command <code>kubectl</code>. If you are on another platform, you need to follow the official documentation, <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">Install and Set Up kubectl</a>.</p>

<p>Configuring remote access requires a <strong>token</strong>. If you followed along with the <a href="#example-microservice">Example Microservice</a> or <a href="#setup-remote-access">Setup Remote Access</a> for an existing Kubernetes <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a> you find the <strong>token</strong> by running <code>kubectl describe</code> on the <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> associated an appropriate ServiceAccount.</p>

<p>You also need the IP address of a server running Kubernetes, and the ability to communicate to that IP. Some networks require remote users to first connect to a VPN.</p>

<p>Next, you create a <strong>context</strong>. A <code>kubectl</code> <strong>context</strong> is an association between a user and a cluster. Start with setting up the user and cluster in the steps below.</p>

<h3 id="add-a-cluster-to-kubectl">Add a Cluster to <code>kubectl</code></h3>

<p>Give your cluster a descriptive name; this cluster configuration is available for use in multiple contexts, so it&rsquo;s best to name it after it&rsquo;s purpose. In this fictional example world the IP 1.1.1.1 is a development cluster, so <strong>dev</strong> is a pretty good name.</p>

<pre><code class="language-bash">kubectl config set-cluster dev --server=https://1.1.1.1:6443 --insecure-skip-tls-verify=true
</code></pre>

<h3 id="add-user-credentials-to-kubectl">Add User (credentials) to <code>kubectl</code></h3>

<p>The user configuration holds the <strong>token</strong> and therefore should have a name descriptive of the access provided by the token. In the case of instructions above to <a href="#setup-remote-access">Setup Remote Access</a>, this token is for a namespace on dev called <code>the-project</code> so a good descriptive name would be <strong>the-project-dev</strong>*. In the example below replace <strong>THETOKEN</strong> with the one retrieved in the example above or received from your administrator.</p>

<pre><code class="language-bash">kubectl config set-credentials the-project-dev --token=THETOKEN
</code></pre>

<h3 id="add-a-context-to-kubectl">Add a Context to <code>kubectl</code></h3>

<p>Finally, you tie the new <strong>dev</strong> cluster with the new <strong>the-project-dev</strong> user (credentials.) In the case of our example, the token is joined to a <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespace</a>, specifically <code>the-project</code>, so it makes sense here to use the <strong>&ndash;namespace</strong> flag to tell <code>kubectl</code> to always use that namespace with this new context. However, providing a namespace is optional.</p>

<p>Name the context with the cluster and access it provides. I find it useful to give it the same name as the user (credentials.)</p>

<pre><code class="language-bash">kubectl config set-context the-project-dev --cluster=dev --user=the-project-dev --namespace the-project
</code></pre>

<p>To use the new context, issue the command:</p>

<pre><code class="language-bash">kubectl config use-context the-project-dev
</code></pre>

<p>Get a list of all your configured contexts along with an indicator of the current context you are in:</p>

<pre><code class="language-bash">kubectl config get-contexts
</code></pre>

<p>You now have access to <strong>the-project</strong> namespace on the <strong>dev</strong> cluster. Check out the <a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/#viewing-finding-resources">kubectl Cheat Sheet</a> for a quick list of useful commands.</p>

<h2 id="resources">Resources</h2>

<ul>
<li><a href="https://kubernetes.io/docs/reference/kubectl/kubectl/">kubectl</a> is the essential Kubernetes command line administration utility.</li>
<li><a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/#viewing-finding-resources">kubectl Cheat Sheet</a></li>
<li><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a> on Kubernetes for role-based access control</li>
<li>Setup a <a href="/hobby-cluster/">Production Hobby Cluster</a>, a production capable kubernetes on the cheap.</li>
<li><a href="/gitlabci-golang-microservices/">A Microservices Workflow with Golang and Gitlab CI</a></li>
<li><a href="https://about.gitlab.com/features/gitlab-ci-cd/">GitlabCI</a> for Continuous Integration &amp; Deployment</li>
</ul>


                
                <hr>
                <h5>SHARE</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_share_toolbox"></div></li>
                </ul>

                <h5>FOLLOW</h5>
                <ul class="list-inline">
                    <li><div class="addthis_inline_follow_toolbox"></div></li>
                </ul>

            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/blockchain" title="Blockchain">
                        Blockchain
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/data" title="Data">
                        Data
                        </a>
                        
                        
                        
                        <a href="/tags/data-science" title="Data Science">
                        Data Science
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/devops" title="DevOps">
                        DevOps
                        </a>
                        
                        
                        
                        <a href="/tags/development" title="Development">
                        Development
                        </a>
                        
                        
                        
                        <a href="/tags/docker" title="Docker">
                        Docker
                        </a>
                        
                        
                        
                        <a href="/tags/elasticsearch" title="Elasticsearch">
                        Elasticsearch
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/equasions" title="Equasions">
                        Equasions
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/golang" title="Golang">
                        Golang
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/ingress" title="Ingress">
                        Ingress
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kubernetes" title="Kubernetes">
                        Kubernetes
                        </a>
                        
                        
                        
                        <a href="/tags/linear-algebra" title="Linear Algebra">
                        Linear Algebra
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/math" title="Math">
                        Math
                        </a>
                        
                        
                        
                        <a href="/tags/matlab" title="Matlab">
                        Matlab
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/microservices" title="Microservices">
                        Microservices
                        </a>
                        
                        
                        
                        <a href="/tags/octave" title="Octave">
                        Octave
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/python" title="Python">
                        Python
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/raspberry-pi" title="Raspberry Pi">
                        Raspberry Pi
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/security" title="Security">
                        Security
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/utils" title="Utils">
                        Utils
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kubectl" title="kubectl">
                        kubectl
                        </a>
                        
                        
                        
                        
                        
                        
                    </div>
                </section>

                
                <hr>
                <h5>RELATED</h5>
                <ul class="list-inline">
                    
                </ul>
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="IMTI" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:cjimti@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a href="https://twitter.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/cjimti/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                </ul>
		<p class="copyright text-muted">
            Copyright &copy; <a href="https://www.linkedin.com/in/cjimti/">Craig Johnston</a> , 2018
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b905a667cf4d77c"></script>



    
        
        
    





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-78786435-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
