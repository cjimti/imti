<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta name="msvalidate.01" content="DBC34551F2DD1BA3DC0D62EE46D7448F" />
    <meta name="google-site-verification" content="DrtKc88u9uc7iptd4LyURAKBmFcOn7Kuk6HcRk_kNmo" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    
    <script>
        (function() {
            var savedTheme = localStorage.getItem('theme');
            var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            var theme = savedTheme || (prefersDark ? 'dark' : 'light');
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Visualize your Elasticsearch data.">
    
    <meta name="keyword"  content="Go, Kubernetes, Elasticsearch, Python, Docker, Big Data, Artificial Intelligence, Machine Learning">
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Kibana on Kubernetes - IMTI - Craig Johnston</title>

    <link rel="canonical" href="https://imti.co/kibana-kubernetes/">

    
    <link rel="stylesheet" href="../css/bootstrap.min.css">

    
    <link rel="stylesheet" href="../css/hux-blog.min.css">

    
    <link rel="stylesheet" href="../css/syntax.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <link rel="stylesheet" href="../css/imti.css">

    
    <script src="../js/jquery.min.js"></script>

    
    <script src="../js/bootstrap.min.js"></script>

    
    <script src="../js/hux-blog.min.js"></script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-5984764595236029",
            enable_page_level_ads: true
        });
    </script>

    <meta name="twitter:site" content="@cjimti">
<meta name="twitter:creator" content="@cjimti">

<meta name="twitter:description" content="Visualize your Elasticsearch data." />
<meta name="twitter:title" content="Kibana on Kubernetes" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://imti.co/img/post/k_876_438.jpg" />
<meta property="og:image" content="https://imti.co/img/post/k_876_438.jpg" />



    

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/imti.co\/kibana-kubernetes\/"
  },
  "headline": "Kibana on Kubernetes",
  "image": ["https:\/\/imti.co\/img\/post\/k_876_438.jpg"],
  "datePublished": "2018-07-15T00:00:00Z",
  "dateModified": "2018-07-15T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Craig Johnston",
    "url": "https://imti.co/about/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "imti.co",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/imti.co\/img\/avatar-cj.jpg"
    }
  },
  "description": "This guide walks through a process for setting up Kibana within a namespace on a Kubernetes cluster. If you followed along with Production Grade Elasticsearch â€¦"
}
</script>


</head>
</head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../">IMTI</a>
        </div>

        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="../">Home</a>
                    </li>
                    <li>
                        <a href="../about/">About</a>
                    </li>
                    <li>
                        <a href="https://twitter.com/cjimti">Follow</a>
                    </li>
                    

                    
                    <li>
                        <a href="javascript:void(0)" class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark/light mode">
                            <i class="fa fa-moon-o" id="theme-icon"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
            $navbar.className = " ";
            setTimeout(function(){
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header{
        background-image: url('https://imti.co/img/post/k.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="../tags/kubernetes" title="Kubernetes">
                        Kubernetes
                        </a>
                        
                        <a class="tag" href="../tags/elasticsearch" title="Elasticsearch">
                        Elasticsearch
                        </a>
                        
                        <a class="tag" href="../tags/data" title="Data">
                        Data
                        </a>
                        
                        <a class="tag" href="../tags/kibana" title="Kibana">
                        Kibana
                        </a>
                        
                    </div>
                    <h1>Kibana on Kubernetes</h1>
                    <h2 class="subheading">Visualize your Elasticsearch data.</h2>
                    <span  class="meta">Posted by <a href="https://twitter.com/cjimti">Craig Johnston</a> on Sunday, July 15, 2018
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>This guide walks through a process for setting up <a href="https://www.elastic.co/products/kibana">Kibana</a> within a <a href="../kubernetes-production-elasticsearch/#project-namespace">namespace</a> on a Kubernetes cluster. If you followed along with <a href="../kubernetes-production-elasticsearch/">Production Grade Elasticsearch on Kubernetes</a> then aside from personal or corporate preferences, little modifications are necessary for the configurations below.</p>
<aside class="toc">
    <header>
        <h2>Contents</h2>
    </header>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#project-namespace">Project Namespace</a></li>
    <li><a href="#service">Service</a></li>
    <li><a href="#kibana-configmap">Kibana ConfigMap</a></li>
    <li><a href="#deployment">Deployment</a></li>
    <li><a href="#basic-auth-optional">Basic Auth (Optional)</a></li>
    <li><a href="#tls-certificate-optional">TLS Certificate (Optional)</a></li>
    <li><a href="#ingress">Ingress</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#port-forwarding--local-development">Port Forwarding / Local Development</a></li>
    <li><a href="#resources">Resources</a></li>
  </ul>
</nav>
</aside>


<h2 id="project-namespace">Project <a href="../kubernetes-production-elasticsearch/#project-namespace">Namespace</a></h2>
<p>I use <code>the-project</code> as a namespace for all my examples and testing. <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Kubernetes Namespaces</a> are the main delimiter I use for security and organization. Configuration files are organized by project, and in Kubernetes, these projects are separated by namespace; therefore I always include a namespace configuration. There is no harm in asking Kubernetes to create a namespace that already exists; an error is returned confirming its existence.</p>
<p><code>00-namespace.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">the-project</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
</span></span></code></pre></div><p>Create the namespace:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f 00-namespace.yml
</span></span></code></pre></div><h2 id="service"><a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a></h2>
<p>I prefer setting up a <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a> early on in the process of configuring up a new application. In Kubernetes, <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a>s persist where many other components can come and go. Microservices in Kubernetes communicate through services rather than having to discover or rely on <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/">Pods</a> directly. The service name and port automatically route traffic to Pods found with their selector.</p>
<p><code>20-service.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">protocol</span>: <span style="color:#e6db74">&#34;TCP&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">5601</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span></code></pre></div><p>Create the service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f 20-service.yml
</span></span></code></pre></div><p>In the configuration above, communicating within the Kubernetes cluster and in <code>the-project</code> namespace, the url http://kibana:80 uses the new service to route traffic to any pods with the <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">label</a> <strong>app: kibana</strong> listening on port 5601.</p>
<p>The ports are internal to the service and the Pods and can be assigned any legal value. Kibana listens on port 5601 by default, so we leave that as is. Port 80 on the <a href="https://kubernetes.io/docs/concepts/services-networking/service/">service</a> is to remind us that this is an HTTP web service, but can easily be any legal port value. We use <a href="../web-cluster-ingress/">ingress</a> in later steps to direct external traffic to the new <a href="#service">kibana service</a>.</p>
<h2 id="kibana-configmap">Kibana <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/#create-a-configmap">ConfigMap</a></h2>
<p>Kibana uses the configuration file <strong><a href="https://github.com/elastic/kibana/blob/master/config/kibana.yml">kibana.yml</a></strong>. Pods running Kibana are set up in the deployment further down this guide. The deployment instructs the Pods to mount this <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/#create-a-configmap">ConfigMap</a> as a file system from which Kibana accesses the data key <code>kibana.yml:</code> as a file.</p>
<p><code>30-configmap.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># kibana.yml is mounted into the Kibana container</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># see https://github.com/elastic/kibana/blob/master/config/kibana.yml</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Kubernetes Ingress is used to route kib.the-project.d4ldev.txn2.com</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kibana.yml</span>: |-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server.name: kib.the-project.d4ldev.txn2.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server.host: &#34;0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    elasticsearch.url: http://elasticsearch:9200</span>
</span></span></code></pre></div><p>Create the configmap:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f 30-configmap.yml
</span></span></code></pre></div><h2 id="deployment">Deployment</h2>
<p>The Kubernetes Kibana deployment below is set to create one replica, that is one Pod in the <a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">ReplicaSet</a> automatically created by the Deployment. The Deployment and can be scaled as needed by changing <strong>replicas: 1</strong> to a suitable value.</p>
<p>The volume <strong>kibana-config-volume</strong> is configured as part of the <strong>spec:</strong> for the Pod template in the Deployment. <strong>kibana-config-volume</strong> attaches to the <a href="#kibana-configmap">Kibana ConfigMap</a> created above. Later, in the containers section, the <strong>volumeMounts:</strong> this <strong>kibana-config-volume</strong> to the directory <strong>/usr/share/kibana/config</strong> inside the Kibana container. By default Kibana looks in <strong>/usr/share/kibana/config</strong> to find the <a href="https://github.com/elastic/kibana/blob/master/config/kibana.yml">kibana.yml</a> configuration file.</p>
<p>Elastic maintains an official set of Docker containers for Kibana at <a href="https://www.docker.elastic.co/#kibana">www.docker.elastic.co</a>. If you followed along with the previous article <a href="../kubernetes-production-elasticsearch/">Production Grade Elasticsearch on Kubernetes</a>, you might remember setting <strong>CLUSTER_NAME</strong> to <strong>elasticsearch</strong> in the StatefulSet and Deployments.</p>
<p>The <strong>containerPort: 5601</strong> is exposed as Kibana listens on 5601 by default unless changed in the <a href="#kibana-configmap">Kibana ConfigMap</a> above.</p>
<p><code>40-deployment.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kibana-config-volume</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMap</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">docker.elastic.co/kibana/kibana-oss:6.2.4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">Always</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kibana-config-volume</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/share/kibana/config</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">CLUSTER_NAME</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">elasticsearch</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">http</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">5601</span>
</span></span></code></pre></div><p>Create the deployment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f 40-deployment.yml
</span></span></code></pre></div><h2 id="basic-auth-optional"><a href="../kubernetes-ingress-basic-auth/">Basic Auth</a> (Optional)</h2>
<p>Described below are a few commands to get you started, however, for a more in-depth review check out my article <a href="../kubernetes-ingress-basic-auth/">Basic Auth on Kubernetes Ingress</a>.</p>
<p>The <a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/">kubectl</a> makes it easy to create a Kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> we can use for Basic Auth on our <a href="../web-cluster-ingress/">Ingress Nginx</a> we set up further down this guide.</p>
<p>Begin with using the <a href="https://httpd.apache.org/docs/2.4/programs/htpasswd.html">htpasswd</a> command to generate the file <code>auth</code> with a user named <strong>kibop</strong> and a password specified when prompted. <a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/">kubectl</a> uses this file as-generated to create the appropriate <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> needed for Basic Auth.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>htpasswd -c ./auth kibop
</span></span></code></pre></div><p>In this example, I create a user named <strong>kibop</strong> for Basic Auth, kubectl pulls the user and password combination for <strong>kibop</strong> from the <strong>auth</strong> file created above and uses the filename as the key. It is essential to name the file <strong>auth</strong> since this is a necessary key for Ingress to find the Basic Auth credentials.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create secret generic kibop-basic-auth --from-file auth -n the-project
</span></span></code></pre></div><p>Our namespace <code>the-project</code> now has the secret <strong>kibop-basic-auth</strong> we use to password-protect Kibana in the <a href="../web-cluster-ingress/">ingress</a> configuration further down.</p>
<h2 id="tls-certificate-optional">TLS Certificate (Optional)</h2>
<p>It is highly recommended to encrypt all traffic to and from Kibana with TLS (HTTPS). I recommend configuring your Kubernetes cluster to use <a href="../lets-encrypt-kubernetes/">Let&rsquo;s Encrypt</a>, it&rsquo;s secure, free and takes about 15 minutes to set up. After setting up <a href="../lets-encrypt-kubernetes/">Let&rsquo;s Encrypt</a>, you can generate and renew certificates automatically.</p>
<p><code>50-cert.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">certmanager.k8s.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Certificate</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kib-dev-cert</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">kib-dev-production-tls</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">issuerRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">letsencrypt-production</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterIssuer</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">commonName</span>: <span style="color:#ae81ff">kib.the-project.d4ldev.txn2.com</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dnsNames</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">kib.the-project.d4ldev.txn2.com</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">acme</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">http01</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ingressClass</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">domains</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">kib.the-project.d4ldev.txn2.com</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">http01</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ingressClass</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">domains</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">kib.the-project.d4ldev.txn2.com</span>
</span></span></code></pre></div><p>Create the certificate:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f 50-cert.yml
</span></span></code></pre></div><h2 id="ingress"><a href="../web-cluster-ingress/">Ingress</a></h2>
<p><a href="../web-cluster-ingress/">Ingress</a> on Kubernetes routes outside traffic to a <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a> inside the cluster. You need an Ingress controller for this step. In this example, we configure the <a href="../web-cluster-ingress/">Ingress Nginx</a> controller. If you are using a different Ingress controller, you need to consult the appropriate documentation. If you do not already have an Ingress controller, then I recommend reading <a href="../web-cluster-ingress/">Ingress on Custom Kubernetes</a> for a quick guide on setting up <a href="../web-cluster-ingress/">Ingress Nginx</a>.</p>
<p><code>60-ingress.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">extensions/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Ingress</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">the-project</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nginx.ingress.kubernetes.io/auth-type</span>: <span style="color:#ae81ff">basic</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nginx.ingress.kubernetes.io/auth-secret</span>: <span style="color:#ae81ff">kibop-basic-auth</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nginx.ingress.kubernetes.io/auth-realm</span>: <span style="color:#e6db74">&#34;Authentication Required&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">host</span>: <span style="color:#ae81ff">kib.the-project.d4ldev.txn2.com</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">http</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">backend</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">kibana</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">servicePort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tls</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">hosts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">kib.the-project.d4ldev.txn2.com</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">kib-dev-production-tls</span>
</span></span></code></pre></div><p>If you are not using <strong>Basic Auth</strong> or <strong>TLS</strong> certificates you need to omit the <strong>annotations</strong> and <strong>tls</strong> sections. However, setting up <a href="../lets-encrypt-kubernetes/">Let&rsquo;s Encrypt</a> and <a href="#basic-auth-optional">Basic Auth</a> is quick and relatively simple.</p>
<p>Create the ingress:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f 60-ingress.yml
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>You now have <a href="https://www.elastic.co/products/kibana">Kibana</a> up and running in Kubernetes and pointed to your <a href="../kubernetes-production-elasticsearch/">Production Grade Elasticsearch on Kubernetes</a>. Check out the official <a href="https://www.elastic.co/guide/en/kibana/current/index.html">Kibana Documentation</a>.</p>
<h2 id="port-forwarding--local-development">Port Forwarding / Local Development</h2>
<p>Check out <a href="https://github.com/txn2/kubefwd">kubefwd</a> for a simple command line utility that bulk forwards services of one or more namespaces to your local workstation.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="../kubernetes-production-elasticsearch/">Production Grade Elasticsearch on Kubernetes</a></li>
<li><a href="https://www.elastic.co/products/kibana">Kibana</a></li>
<li><a href="../kubernetes-ingress-basic-auth/">Basic Auth on Kubernetes Ingress</a></li>
<li>Setting up <a href="../lets-encrypt-kubernetes/">Let&rsquo;s Encrypt</a> on Kubernetes</li>
</ul>


                <p>
                   This blog post, titled: "<span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Kibana on Kubernetes: Visualize your Elasticsearch data.</span>" by <a xmlns:cc="http://creativecommons.org/ns#" href="https://twitter.com/cjimti" property="cc:attributionName" rel="cc:attributionURL">Craig Johnston</a>, is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
                </p>

            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="../tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="../tags/ai" title="ai">
                        ai
                        </a>
                        
                        
                        
                        <a href="../tags/blockchain" title="blockchain">
                        blockchain
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/data" title="data">
                        data
                        </a>
                        
                        
                        
                        <a href="../tags/data-science" title="data science">
                        data science
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/development" title="development">
                        development
                        </a>
                        
                        
                        
                        <a href="../tags/devops" title="devops">
                        devops
                        </a>
                        
                        
                        
                        
                        
                        <a href="../tags/docker" title="docker">
                        docker
                        </a>
                        
                        
                        
                        <a href="../tags/elasticsearch" title="elasticsearch">
                        elasticsearch
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/golang" title="golang">
                        golang
                        </a>
                        
                        
                        
                        
                        
                        <a href="../tags/ingress" title="ingress">
                        ingress
                        </a>
                        
                        
                        
                        <a href="../tags/iot" title="iot">
                        iot
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/kubectl" title="kubectl">
                        kubectl
                        </a>
                        
                        
                        
                        <a href="../tags/kubefwd" title="kubefwd">
                        kubefwd
                        </a>
                        
                        
                        
                        <a href="../tags/kubernetes" title="kubernetes">
                        kubernetes
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/mcp" title="mcp">
                        mcp
                        </a>
                        
                        
                        
                        
                        
                        <a href="../tags/microservices" title="microservices">
                        microservices
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/python" title="python">
                        python
                        </a>
                        
                        
                        
                        <a href="../tags/raspberry-pi" title="raspberry pi">
                        raspberry pi
                        </a>
                        
                        
                        
                        <a href="../tags/security" title="security">
                        security
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="../tags/utils" title="utils">
                        utils
                        </a>
                        
                        
                        
                        
                        
                        
                    </div>
                </section>

                
                <hr>
                <h5>RELATED</h5>
                <ul class="list-inline">
                    
                </ul>
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="../index.xml" rel="alternate" type="application/rss+xml" title="IMTI" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:cjimti@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a href="https://twitter.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/cjimti">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/cjimti/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                </ul>
            </div>
        </div>
    </div>
</footer>


<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<script>
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-R56SP4WLS2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R56SP4WLS2');
</script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({ theme: 'neutral' });
  mermaid.run();
</script>


<script>
(function() {
    var themeToggle = document.getElementById('theme-toggle');
    var themeIcon = document.getElementById('theme-icon');

    function getCurrentTheme() {
        return document.documentElement.getAttribute('data-theme') || 'light';
    }

    function updateIcon() {
        var currentTheme = getCurrentTheme();
        if (themeIcon) {
            if (currentTheme === 'dark') {
                themeIcon.className = 'fa fa-sun-o';
            } else {
                themeIcon.className = 'fa fa-moon-o';
            }
        }
    }

    function toggleTheme() {
        var currentTheme = getCurrentTheme();
        var newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        if (newTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        } else {
            document.documentElement.removeAttribute('data-theme');
        }

        localStorage.setItem('theme', newTheme);
        updateIcon();
    }

    updateIcon();

    if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
    }

    if (window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            if (!localStorage.getItem('theme')) {
                if (e.matches) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                }
                updateIcon();
            }
        });
    }
})();
</script>

</body>
</html>
